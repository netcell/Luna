"use strict";function getDaysOfMonth(a,b){return new Date(a,b+1,0).getDate()}function getGioHoangDao_Duong(a,b,c){for(var d=jdFromDate(a,b,c),e=(d+1)%12,f=GIO_HD[e%6],g="",h=0,i=0;12>i;i++)"1"==f.charAt(i)&&(g+=CHI[i],g+=" ("+(2*i+23)%24+"-"+(2*i+1)%24+")",h++<5&&(g+=", "),3==h&&(g+="\n"));return g}function getGioHoangDao_Am(a,b,c,d){for(var e=getSolarDateFromLunarDate(a,b,c,d,7),f=jdFromDate(e[0],e[1],e[2]),g=(f+1)%12,h=GIO_HD[g%6],i="",j=0,k=0;12>k;k++)"1"==h.charAt(k)&&(i+=CHI[k],i+=" ("+(2*k+23)%24+"-"+(2*k+1)%24+")",j++<5&&(i+=", "),3==j&&(i+="\n"));return i}function jdFromDate(a,b,c){var d,e,f,g;return d=INT((14-b)/12),e=c+4800-d,f=b+12*d-3,g=a+INT((153*f+2)/5)+365*e+INT(e/4)-INT(e/100)+INT(e/400)-32045,2299161>g&&(g=a+INT((153*f+2)/5)+365*e+INT(e/4)-32083),g}function jdToDate(a){var b,c,d,e,f,g,h,i,j;return a>2299160?(b=a+32044,c=INT((4*b+3)/146097),d=b-INT(146097*c/4)):(c=0,d=a+32082),e=INT((4*d+3)/1461),f=d-INT(1461*e/4),g=INT((5*f+2)/153),h=f-INT((153*g+2)/5)+1,i=g+3-12*INT(g/10),j=100*c+e-4800+INT(g/10),new Array(h,i,j)}function INT(a){return Math.floor(a)}function getNewMoonDay(a,b){var c,d,e,f,g,h,i,j,k,l,m;return c=a/1236.85,d=c*c,e=d*c,f=PI/180,g=2415020.75933+29.53058868*a+1178e-7*d-1.55e-7*e,g+=33e-5*Math.sin((166.56+132.87*c-.009173*d)*f),h=359.2242+29.10535608*a-333e-7*d-347e-8*e,i=306.0253+385.81691806*a+.0107306*d+1236e-8*e,j=21.2964+390.67050646*a-.0016528*d-239e-8*e,k=(.1734-393e-6*c)*Math.sin(h*f)+.0021*Math.sin(2*f*h),k=k-.4068*Math.sin(i*f)+.0161*Math.sin(2*f*i),k-=4e-4*Math.sin(3*f*i),k=k+.0104*Math.sin(2*f*j)-.0051*Math.sin(f*(h+i)),k=k-.0074*Math.sin(f*(h-i))+4e-4*Math.sin(f*(2*j+h)),k=k-4e-4*Math.sin(f*(2*j-h))-6e-4*Math.sin(f*(2*j+i)),k=k+.001*Math.sin(f*(2*j-i))+5e-4*Math.sin(f*(2*i+h)),l=-11>c?.001+839e-6*c+2261e-7*d-845e-8*e-8.1e-8*c*e:-278e-6+265e-6*c+262e-6*d,m=g+k-l,INT(m+.5+b/24)}function getSunLongitude(a,b){var c,d,e,f,g,h,i;return c=(a-2451545.5-b/24)/36525,d=c*c,e=PI/180,f=357.5291+35999.0503*c-1559e-7*d-4.8e-7*c*d,g=280.46645+36000.76983*c+3032e-7*d,h=(1.9146-.004817*c-14e-6*d)*Math.sin(e*f),h=h+(.019993-101e-6*c)*Math.sin(2*e*f)+29e-5*Math.sin(3*e*f),i=g+h,i*=e,i-=2*PI*INT(i/(2*PI)),INT(i/PI*6)}function getLunarMonth11(a,b){var c,d,e,f;return d=jdFromDate(31,12,a)-2415021,c=INT(d/29.530588853),e=getNewMoonDay(c,b),f=getSunLongitude(e,b),f>=9&&(e=getNewMoonDay(c-1,b)),e}function getLeapMonthOffset(a,b){var c,d,e,f;c=INT((a-2415021.076998695)/29.530588853+.5),d=0,f=1,e=getSunLongitude(getNewMoonDay(c+f,b),b);do d=e,f++,e=getSunLongitude(getNewMoonDay(c+f,b),b);while(e!=d&&14>f);return f-1}function convertSolar2Lunar(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;return h=jdFromDate(a,b,c),g=INT((h-2415021.076998695)/29.530588853),i=getNewMoonDay(g+1,d),i>h&&(i=getNewMoonDay(g,d)),j=getLunarMonth11(c,d),k=j,j>=i?(n=c,j=getLunarMonth11(c-1,d)):(n=c+1,k=getLunarMonth11(c+1,d)),l=h-i+1,e=INT((i-j)/29),o=0,m=e+11,k-j>365&&(f=getLeapMonthOffset(j,d),e>=f&&(m=e+10,e==f&&(o=1))),m>12&&(m-=12),m>=11&&4>e&&(n-=1),new Array(l,m,n,o)}function convertLunar2Solar(a,b,c,d,e){var f,g,h,i,j,k,l;if(11>b?(g=getLunarMonth11(c-1,e),h=getLunarMonth11(c,e)):(g=getLunarMonth11(c,e),h=getLunarMonth11(c+1,e)),f=INT(.5+(g-2415021.076998695)/29.530588853),i=b-11,0>i&&(i+=12),h-g>365){if(j=getLeapMonthOffset(g,e),k=j-2,0>k&&(k+=12),0!=d&&b!=k)return new Array(0,0,0);(0!=d||i>=j)&&(i+=1)}return l=getNewMoonDay(f+i,e),jdToDate(l+a-1)}angular.module("lunaApp",["ngCookies","ngRoute","ngAnimate","monospaced.elastic","ngTouch","ngStorage"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/quick-create",{templateUrl:"views/quick-create.html",controller:"QuickcreateCtrl"}).when("/under-construction",{templateUrl:"views/under-construction.html"}).when("/create",{templateUrl:"views/create.html",controller:"CreateCtrl"}).when("/confirmation/:action",{templateUrl:"views/confirmation.html",controller:"ConfirmationCtrl"}).when("/account-over-used",{templateUrl:"views/account-over-used.html"}).when("/has/:action",{templateUrl:"views/has.html",controller:"HasCtrl"}).when("/delete",{templateUrl:"views/delete.html",controller:"DeleteCtrl"}).when("/sign-in",{templateUrl:"views/sign-in.html",controller:"SignInCtrl"}).when("/event-list",{templateUrl:"views/event-list.html",controller:"EventlistCtrl"}).when("/confirm-sign-up",{templateUrl:"views/confirm-sign-up.html",controller:"ConfirmSignUpCtrl"}).when("/update-email",{templateUrl:"views/update-email.html",controller:"UpdateEmailCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).when("/feedback",{templateUrl:"views/feedback.html",controller:"FeedbackCtrl"}).otherwise({redirectTo:"/"})}]).constant("Strings",{CONNECTION_ERROR:["Hệ thống đang bận, hoặc kết nối internet của bạn có vấn đề.","Xin hãy kiểm tra và thử lại sau ít phút."]}).run(["$rootScope","$templateCache",function(a,b){b.removeAll()}]),angular.module("lunaApp").controller("LoadingscreenCtrl",["$scope","$window","$q","$timeout","$http",function(a,b,c,d,e){for(var f=[e.get("views/account-over-used.html"),e.get("views/confirmation.html"),e.get("views/home.html"),e.get("views/create.html"),e.get("views/quick-create.html"),e.get("views/under-construction.html"),e.get("views/has.html")],g=0,h=f.length-1;h>=0;h--)f[h].then(function(){g++,$(".loader").animate({width:g/f.length*100+"%"},50)});c.all(f).then(function(){$(".loader").stop(),$(".loader").animate({width:g/f.length*100+"%"},{duration:500,complete:function(){$(".loading-screen").fadeOut(500)}})})}]),angular.module("lunaApp").controller("MainCtrl",["$location","$scope","User","amduonglich","$window","DateTime","$timeout",function(a,b,c,d,e,f){c.signIn(function(){b.username=c.getInfo().name,b.accountMenu=function(){a.path("/account")},b.feedback=function(){a.path("/feedback")}},!0),b.time={},b.time.current_day=f.getCurrentDay(!0);var g=d.getCurrentLunarDate();b.time.current_date=g[0],b.time.current_month=g[1],b.footer={},b.footer.buttons=[],b.hasPopup=!1,b.main={};var h=function(){b.hasPopup=!1,b.hasPopup=!0};b.main.createPopup=function(a,c){b.popupTexts="[object Array]"===Object.prototype.toString.call(a)?a:[a],b.popupButtons=[];for(var d in c)b.popupButtons.push({text:d,action:c[d]});h()},b.main.alert=function(a,c){c||(c="OK");var d={};d[c]=b.main.closePopup,b.main.createPopup(a,d)},b.main.pauseup=function(a,c){b.main.createPopup(a,{OK:function(){b.main.closePopup(),c()},Cancel:b.main.closePopup})},b.main.closePopup=function(){b.hasPopup=!1},b.main.back=function(){e.history.back()}}]),angular.module("lunaApp").directive("appDirective",function(){return{restrict:"A",link:function(a,b){var c=$(b[0]),d=c.find(".time"),e=c.find(".module");a.$watch("grid.value",function(){1==a.grid.value?(d.removeClass("full-left"),e.removeClass("full-left"),d.removeClass("near-left"),e.removeClass("near-left")):3==a.grid.value?(d.removeClass("full-left"),e.removeClass("full-left"),d.addClass("near-left"),e.addClass("near-left")):(d.addClass("full-left"),e.addClass("full-left"))})}}}),angular.module("lunaApp").directive("textarea",function(){return{restrict:"E",link:function(a,b){b.focus()}}}),angular.module("lunaApp").directive("quickCreateHome",["$window","$location",function(a,b){return{restrict:"C",link:function(c,d){d.find("textarea").blur(function(a){$(a.currentTarget).focus()});var e=function(c){switch(c.keyCode){case 27:a.removeEventListener("keydown",e),a.history.back();break;case 13:a.removeEventListener("keydown",e),b.path("/")}};a.addEventListener("keydown",e),d.bind("$destroy",function(){a.removeEventListener("keydown",e)})}}}]),angular.module("lunaApp").controller("QuickcreateCtrl",["$scope",function(a){a.input}]),angular.module("lunaApp").directive("afterLoading",function(){return{restrict:"C",link:function(a,b){b.removeClass("hidden")}}}),angular.module("lunaApp").directive("moduleContent",function(){return{restrict:"C",link:function(a,b,c){a.grid.value=c.grid}}}),angular.module("lunaApp").controller("CreateCtrl",["Strings","$scope","$http","$location","Share","Validate","DateTime","User",function(a,b,c,d,e,f,g,h){b.User=h.getInfo(),b.selection={},b.options={},b.options.hours=g.hours,b.options.pre_kind=[{value:"tiếng",index:0},{value:"ngày",index:1}];var i=[["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["00","01","02","03","04","05"]];b.options.minutes=g.minutes,b.options.dates=g.dates,b.options.months=g.months,b.options.repeats=g.repeats;var j=e.receive("event-to-edit");b.selection.desc=j.message?j.message:"";var k=!1,l=!1;if(j.hour){var m=g.convert24to12(j.hour);k=m.hour,l=m.period}j.pre&&(j.pre=parseInt(j.pre)<10?"0"+j.pre:""+j.pre),b.selection.hour=k?k:g.getCurrentHour(!0),b.options.periods=g.periods[b.selection.hour.periods],b.selection.period=l?l:g.getCurrentPeriod(!0),b.selection.pre_kind=b.options.pre_kind[j.pre?parseInt(j.pre_kind):1],b.options.pre=i[b.selection.pre_kind.index],b.selection.pre=j.pre?j.pre:"00",b.selection.minute=j.minute?j.minute:g.getCurrentMinute(!0),b.selection.date=j.date?g.objectLunarDate(parseInt(j.date)):g.getCurrentLunarDate(!0),b.selection.month=j.month?g.objectLunarMonth(parseInt(j.month)):g.getCurrentLunarMonth(!0),b.selection.repeat=b.options.repeats[j.repeatType?parseInt(j.repeatType):0],b.selection.email=h.getEmail();var n=4;b.$watch("selection.pre_kind",function(a){n?n--:(b.options.pre=i[a.index],b.selection.pre="00")}),b.$watch("selection.hour",function(a){if(n)n--;else{var c=b.selection.period.index;b.options.periods=g.periods[a.periods],b.selection.period=b.options.periods[c]}}),b.$watch("selection.date",function(){n?n--:0==b.selection.repeat.index&&(b.selection.repeat=b.options.repeats[1])}),b.$watch("selection.month",function(){n?n--:2!=b.selection.repeat.index&&(b.selection.repeat=b.options.repeats[2])}),b.data=j,b.submitText=j?"cập nhật":"tạo nhắc nhở",b.deleteText="xóa nhắc nhở",b.activeText=j.status?"tắt nhắc nhở":"bật nhắc nhở",b.delete=function(){j.delete()},b.switchStatus=function(){j.switchStatus()},b.submit=function(){function g(){switch(i.repeat||(i.pre="00"),i.date){case"30":i.date=100}h.setEmail(b.selection.email);var f=function(){b.main.createPopup("Đang xử lý"),j?c.post("/account/edit-event/"+j.id,i).then(function(){b.main.closePopup(),d.path("/event-list")},function(){b.main.alert(a.CONNECTION_ERROR)}):b.User.signedIn?c.post("/account/create-event/",i).then(function(){b.main.closePopup(),d.path("/event-list")},function(){b.main.alert(a.CONNECTION_ERROR)}):c.post("/user/quick-create",i).then(function(){b.main.closePopup(),e.send("form-create",i),d.path("/confirmation/create")},function(){b.main.alert(a.CONNECTION_ERROR)})};j||i.desc&&!/^\s*$/.test(i.desc)?f():(i.desc="",b.main.pauseup(["Bạn chưa điền nội dung nhắc nhở.","Bạn có chắc muốn tiếp tục tạo nhắc nhở không có nội dung không?"],f))}var i={udid:Date.now()+"-"+(65536*(1+Math.random())|0).toString(16),desc:b.selection.desc,hour:b.selection.hour.value,minute:b.selection.minute,period:b.selection.period.standard,date:b.selection.date,month:b.selection.month.standard,repeat:b.selection.repeat.index,email:b.selection.email,pre:b.selection.pre,pre_kind:b.selection.pre_kind};b.User.signedIn?g():!b.selection.email||/^\s*$/.test(b.selection.email)?b.main.alert("Bạn cần nhập địa chỉ email"):f.validateEmail(b.selection.email)?g():b.main.alert("Bạn cần nhập đúng địa chỉ email")},b.footer.buttons=[{name:b.submitText,action:b.submit}],j&&(b.footer.buttons.push({name:b.deleteText,action:b.delete}),b.footer.buttons.push({name:b.activeText,action:b.switchStatus})),b.footer.buttons.push({name:"quay lại",action:function(){b.main.back()}}),b.$on("$destroy",function(){b.footer.buttons=[]})}]),angular.module("lunaApp").directive("create",function(){return{restrict:"A",link:function(a,b){a.$watch("selection.date",function(a,c,d){switch(a){case"rằm":b.find("#create-date").removeClass("size-2").addClass("size-3"),2!=d.selection.repeat.index&&b.find("#create-month-label").addClass("disabled");break;case"cuối":b.find("#create-date").removeClass("size-2").addClass("size-3"),b.find("#create-month-label").removeClass("disabled");break;default:b.find("#create-date").removeClass("size-3").addClass("size-2"),2!=d.selection.repeat.index&&b.find("#create-month-label").addClass("disabled")}}),a.$watch("selection.repeat",function(a,c,d){switch(a.index){case 0:b.find("#create-date,#create-date-label,#create-month,#create-month-label").addClass("disabled");break;case 1:b.find("#create-month").addClass("disabled"),"cuối"==d.selection.date?b.find("#create-month-label").removeClass("disabled"):b.find("#create-month-label").addClass("disabled"),b.find("#create-date,#create-date-label").removeClass("disabled");break;case 2:b.find("#create-date,#create-date-label,#create-month,#create-month-label").removeClass("disabled")}})}}}),angular.module("lunaApp").factory("amduonglich",function(){function a(a,b,c,d,e){this.day=a,this.month=b,this.year=c,this.leap=d,this.jd=e}function b(a,b,c){var d=h((14-b)/12),e=c+4800-d,f=b+12*d-3,g=a+h((153*f+2)/5)+365*e+h(e/4)-h(e/100)+h(e/400)-32045;return g}function c(c,d){var e,f,g,h,i,j,k,l,m,n=new Array;e=new Array(29,30),f=new Array(12),g=d>>17,h=15&d,i=e[d>>16&1],j=b(1,1,c),k=j+g,l=d>>4;for(var o=0;12>o;o++)f[12-o-1]=e[1&l],l>>=1;if(0==h)for(m=1;12>=m;m++)n.push(new a(1,m,c,0,k)),k+=f[m-1];else{for(m=1;h>=m;m++)n.push(new a(1,m,c,0,k)),k+=f[m-1];for(n.push(new a(1,h,c,1,k)),k+=i,m=h+1;12>=m;m++)n.push(new a(1,m,c,0,k)),k+=f[m-1]}return n}function d(a){var b;return b=1900>a?q[a-1800]:2e3>a?r[a-1900]:2100>a?s[a-2e3]:t[a-2100],c(a,b)}function e(b,c){if(b>w||v>b||c[0].jd>b)return new a(0,0,0,0,b);for(var d=c.length-1;b<c[d].jd;)d--;var e=b-c[d].jd;return new a(c[d].day+e,c[d].month,c[d].year,c[d].leap,b)}function f(a,c,f){var g,h;return g=d(f),h=b(a,c,f),h<g[0].jd&&(g=d(f-1)),e(h,g)}function g(){this.fontSize="13pt",this.tableWidth="420px"}function h(a){return Math.floor(a)}function i(a,b,c){var d,e,f,g;return d=h((14-b)/12),e=c+4800-d,f=b+12*d-3,g=a+h((153*f+2)/5)+365*e+h(e/4)-h(e/100)+h(e/400)-32045,2299161>g&&(g=a+h((153*f+2)/5)+365*e+h(e/4)-32083),g}function j(a){var b,c,d,e,f,g,h,i,j,k,l;return b=a/1236.85,c=b*b,d=c*b,e=u/180,f=2415020.75933+29.53058868*a+1178e-7*c-1.55e-7*d,f+=33e-5*Math.sin((166.56+132.87*b-.009173*c)*e),g=359.2242+29.10535608*a-333e-7*c-347e-8*d,h=306.0253+385.81691806*a+.0107306*c+1236e-8*d,i=21.2964+390.67050646*a-.0016528*c-239e-8*d,j=(.1734-393e-6*b)*Math.sin(g*e)+.0021*Math.sin(2*e*g),j=j-.4068*Math.sin(h*e)+.0161*Math.sin(2*e*h),j-=4e-4*Math.sin(3*e*h),j=j+.0104*Math.sin(2*e*i)-.0051*Math.sin(e*(g+h)),j=j-.0074*Math.sin(e*(g-h))+4e-4*Math.sin(e*(2*i+g)),j=j-4e-4*Math.sin(e*(2*i-g))-6e-4*Math.sin(e*(2*i+h)),j=j+.001*Math.sin(e*(2*i-h))+5e-4*Math.sin(e*(2*h+g)),k=-11>b?.001+839e-6*b+2261e-7*c-845e-8*d-8.1e-8*b*d:-278e-6+265e-6*b+262e-6*c,l=f+j-k}function k(a){var b,c,d,e,f,g,i;return b=(a-2451545)/36525,c=b*b,d=u/180,e=357.5291+35999.0503*b-1559e-7*c-4.8e-7*b*c,f=280.46645+36000.76983*b+3032e-7*c,g=(1.9146-.004817*b-14e-6*c)*Math.sin(d*e),g=g+(.019993-101e-6*b)*Math.sin(2*d*e)+29e-5*Math.sin(3*d*e),i=f+g,i*=d,i-=2*u*h(i/(2*u))}function l(a,b){return h(k(a-.5-b/24)/u*6)}function m(a,b){return h(j(a)+.5+b/24)}function n(a,b){var c,d,e,f;return d=i(31,12,a)-2415021,c=h(d/29.530588853),e=m(c,b),f=l(e,b),f>=9&&(e=m(c-1,b)),e}function o(a,b){var c,d,e,f;c=h((a-2415021.076998695)/29.530588853+.5),d=0,f=1,e=l(m(c+f,b),b);do d=e,f++,e=l(m(c+f,b),b);while(e!=d&&14>f);return f-1}function p(a,b,c,d){var e,f,g,j,k,l,p,q,r;f=i(a,b,c),e=h((f-2415021.076998695)/29.530588853),g=m(e+1,d),g>f&&(g=m(e,d)),j=n(c,d),k=j,j>=g?(q=c,j=n(c-1,d)):(q=c+1,k=n(c+1,d)),l=f-g+1;var s=h((g-j)/29);if(r=0,p=s+11,k-j>365){var t=o(j,d);s>=t&&(p=s+10,s==t&&(r=1))}return p>12&&(p-=12),p>=11&&4>s&&(q-=1),new Array(l,p,q,r)}var q=new Array(3193507,5679952,4336544,2927457,5415792,3953128,6345056,4908208,3631398,5823136,4479824,3217106,5647072,4104928,2679506,5163344,3724630,6075680,4634256,3300772,5789136,4335056,2926003,5415600,4040887,6334800,4895904,3519141,5942608,4478384,3156852,5645680,4215545,6574768,5138768,3698006,6183584,4631376,3299028,5786336,4367728,2966867,5296800,3926183,6346064,4872864,3452325,5936592,4606688,3058356,5547216,4117176,6599312,5027152,3692375,6172064,4756944,3296629,5786032,4367536,2991283,5270160,3845528,6318928,4991840,3511141,5935984,4606320,3172708,5432480,3992170,6478480,5135056,3746518,6171360,4756192,3328725,5687632,4248736,2872483,5289616,3823527,6313392,4990416,3577269,5935792,4499792,3070292,5551264,3978576,2648914,5133744,3811190,6169968,4739760,3320485,5695824,4221600,2800291,5286736),r=new Array(3951576,6441696,5023088,3691733,6083168,4512080,3233108,5658272,4233936,2774482,5262048,3843510,6333648,4772432,3396181,5813568,4380320,2928034,5412272,4147575,6572400,5022896,3585205,6056528,4615504,3222356,5647200,4232560,2904818,5261680,3827046,6214816,4778576,3369621,5790416,4467552,3114723,5411552,4049111,6474064,5035168,3528870,5944656,4609696,3253684,5645776,4231888,2806450,5286224,3716439,6188192,4765008,3494741,5787040,4367792,3097971,5526192,3975592,6351184,5008032,3583654,5942096,4606816,3189476,5678448,4215392,2683491,5167424,3726151,6084256,4757200,3427797,5917392,4367568,2938036,5419600,3986776,6337856,4896160,3626406,6067632,4606384,3189108,5678256,4237904,2730578,5139744,3779911,6204256,4756336,3427061,5917040,4482224,2913443,5302864,4024920,6444704,4893392,3577557,6066912),s=new Array(4639072,3070292,5559456,4119120,2782546,5133984,3712935,6202832,4887216,3320501,5810512,4371616,2931364,5287248,3954137,6441888,5023152,3625334,6050416,4614448,3176756,5532320,4107600,2775890,5262176,3712742,6202592,4772448,3336805,5690656,4250272,2971299,5396176,3951355,6441424,5022928,3657910,5943888,4502816,3071269,5551520,4085200,2774450,5261744,3843447,6202544,4762192,3387989,5795104,4238688,2968419,5395312,4082152,6343024,5002416,3631270,5954128,4479648,3122852,5548752,4215520,2675427,5163344,3724631,6214816,4643152,3300693,5789344,4368080,2905556,5395120,3975608,6465840,4895888,3454630,5942608,4609440,3058532,5547376,4215472,2797939,5138736,3697463,6187680,4762960,3353301,5778272,4367728,3035876,5296480,3860824,6346016,4905616,3496614,5920464,4598496,3189204,5546704,4116816,2681170),t=new Array(5158176,3725095,6204832,4871600,3550645,5916080,4498096,3060404,5548368,3978585,6449952,5025104,3692390,6050672,4736368,3302772,5788336,4221264,2783571,5266080,3910311,6203088,4868832,3515109,5940560,4379296,3007140,5428560,4086459,6444704,5019344,3754422,6179504,4630736,3200181,5681808,4240720,2780498,5262752,3904871,6329712,4868528,3451253,5924016,4483728,2931348,5401424,4074336,2665313,5018992,3689190,6082912,4646048,3075365,5560976,4217680,2897619,5253856,3838935,6329040,4901200,3331414,5813408,4372112,3038612,5395888,4072954,6563248,5149360,3582646,6056272,4617376,3256997,5549392,4216224,2796403,5383536,3822455,6312624,4876624,3435862,5790368,4369232,3036884,5524192,3974512,2647250,5034592,3599014,5952848,4610720,3190181,5674448,4213456,2795955,5285072,3855031,6206032,4764992,3396950),u=Math.PI,v=b(25,1,1800),w=b(31,12,2199),x=new Date,u=(f(x.getDate(),x.getMonth()+1,x.getFullYear()),x.getMonth()+1,x.getFullYear(),new Array("CN","T2","T3","T4","T5","T6","T7"),new g,new Array("9pt","13pt","17pt"),new Array("180px","420px","600px"),Math.PI);return{getCurrentLunarDate:function(){var a=new Date;return p(a.getDate(),a.getMonth()+1,a.getFullYear(),7)}}}),angular.module("lunaApp").controller("HasCtrl",["$scope","$timeout","$location","$routeParams",function(a,b,c,d){function e(){j=b(function(){a.timer<=0?a.goNow():(a.timer-=1,e())},1e3)}var f={created:"Nhắc nhở của bạn đã được tạo",deleted:"Nhắc nhở của bạn đã được xóa","auth-fail-create":"Nhắc nhở của bạn chưa được tạo vì đường link xác nhận đã quá cũ, không còn hiệu lực","auth-fail-delete":"Nhắc nhở của bạn chưa được xóa vì đường link xác nhận đã quá cũ, không còn hiệu lực"},g={created:"trang chủ",deleted:"trang chủ","auth-fail-create":"trang tạo nhắc nhở","auth-fail-delete":"trang xóa nhắc nhở"},h={created:"trang chủ",deleted:"trang chủ","auth-fail-create":"tạo nhắc nhở","auth-fail-delete":"xóa nhắc nhở"},i={created:"/",deleted:"/","auth-fail-create":"/create","auth-fail-delete":"/delete"};a.redirect=g[d.action],a.announce=f[d.action],a.path=i[d.action],a.goDelete=function(){a.path="/delete",a.goNow()},a.goNow=function(){"/"!=a.path?(c.path("/"),b(function(){c.path(a.path)},100)):c.path(a.path)},a.created="created"==d.action,a.footer.buttons=[{name:h[d.action],action:function(){a.goNow()}}],a.$on("$destroy",function(){a.footer.buttons=[]}),a.timer=10;var j;e(),a.$on("$destroy",function(){b.cancel(j)})}]),angular.module("lunaApp").controller("HomeCtrl",["$scope","$location","User",function(a,b,c){c.signIn(function(){c.getInfo().signedIn&&b.path("/event-list")},!0),a.footer.buttons=[{name:"xóa nhắc nhở",action:function(){b.path("/delete")}},{name:"hướng dẫn",action:function(){window.open("http://www.youtube.com/watch?v=M_QQeoUetPQ&feature=youtu.be","_blank").focus()}}],a.$on("$destroy",function(){a.footer.buttons=[]})}]),angular.module("lunaApp").controller("DeleteCtrl",["$scope","$http","$location","Validate","User",function(a,b,c,d,e){a.email=e.getEmail(),a.footer.buttons=[{name:"yêu cầu xóa",action:function(){a.submit()}},{name:"quay lại",action:function(){a.main.back()}}],a.$on("$destroy",function(){a.footer.buttons=[]}),a.submit=function(){a.email&&!/^\s*$/.test(a.email)?d.validateEmail(a.email)?(e.setEmail(a.email),a.main.createPopup("Đang xử lý"),b.get("/user/delete-event/"+a.email).then(function(b){a.main.closePopup(),"0"==b.data?a.main.alert("Bạn không có nhắc nhở nào."):c.path("/confirmation/delete")},function(){a.main.alert("hệ thống đang bận, xin thử lại sau ít phút")})):a.main.alert("Bạn cần nhập đúng địa chỉ email."):a.main.alert("Bạn cần nhập địa chỉ email.")}}]),angular.module("lunaApp").factory("Validate",function(){return{validateEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}}}),angular.module("lunaApp").directive("footer",function(){return{restrict:"A",link:function(a){a.footer.buttons.length||$(".more").height(20),a.$watch("footer.buttons.length",function(a){a?$(".more").height(50):$(".more").height(20)})}}}),angular.module("lunaApp").factory("DateTime",["amduonglich",function(a){var b=["chủ nhật","thứ hai","thứ ba","thứ tư","thứ năm","thứ sáu","thứ bảy"];return{getCurrentDay:function(a){var c=(new Date).getDay();return a?b[c]:c},getCurrentLunarDate:function(){return this.dates[a.getCurrentLunarDate()[0]-1]},objectLunarDate:function(a){return this.dates[a-1]},getCurrentLunarMonth:function(){return this.months[a.getCurrentLunarDate()[1]-1]},objectLunarMonth:function(a){return this.months[a-1]},getCurrentHour:function(){var a=(new Date).getHours()||24;return this.hours[(a-1)%12]},convert24to12:function(a){a=parseInt(a);var b=this.hours[(a-1)%12];return{hour:b,period:this.periods[b.periods][13>a?0:1]}},getCurrentMinute:function(){return this.minutes[(new Date).getMinutes()]},getCurrentPeriod:function(){var a=(new Date).getHours()||24;return this.periods[this.getCurrentHour().periods][13>a?0:1]},periods:[[{value:"sáng",index:0,standard:"am"},{value:"chiều",index:1,standard:"pm"}],[{value:"sáng",index:0,standard:"am"},{value:"tối",index:1,standard:"pm"}],[{value:"trưa",index:0,standard:"am"},{value:"đêm",index:1,standard:"pm"}]],hours:[{value:"01",periods:0},{value:"02",periods:0},{value:"03",periods:0},{value:"04",periods:0},{value:"05",periods:0},{value:"06",periods:0},{value:"07",periods:1},{value:"08",periods:1},{value:"09",periods:1},{value:"10",periods:1},{value:"11",periods:2},{value:"12",periods:2}],minutes:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],dates:["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],months:[{value:"giêng",index:0,standard:"01"},{value:"hai",index:1,standard:"02"},{value:"ba",index:2,standard:"03"},{value:"bốn",index:3,standard:"04"},{value:"năm",index:4,standard:"05"},{value:"sáu",index:5,standard:"06"},{value:"bảy",index:6,standard:"07"},{value:"tám",index:7,standard:"08"},{value:"chín",index:8,standard:"09"},{value:"mười",index:9,standard:"10"},{value:"mười một",index:10,standard:"11"},{value:"chạp",index:11,standard:"12"}],repeats:[{value:"ngày",index:0},{value:"tháng",index:1},{value:"năm",index:2}]}}]),angular.module("lunaApp").controller("ConfirmationCtrl",["$scope","$routeParams","User","$http","$location","Share",function(a,b,c,d,e,f){a.email=c.getEmail();var g={create:"tạo nhắc nhở","delete":"xóa nhắc nhở",email:"cập nhật email"};a.action=g[b.action];var h={"delete":{text:"tạo thêm nhắc nhở mới",link:"/create"},create:{text:"xóa nhắc nhở đã tạo",link:"/delete"}};a.subaction=h[b.action];var i={"delete":"images/confirmation_delete.png",create:"images/confirmation_create.png"};a.image=i[b.action],a.submit=function(){if(a.main.createPopup("Đang xử lý"),"create"===b.action){var c=f.receive("form-create");d.post("/user/try-create",c).then(function(b){"1"!==b.data?a.main.alert(Strings.CONNECTION_ERROR):a.main.alert("Chúng tôi đã gửi lại email cho bạn")},function(){a.main.alert(Strings.CONNECTION_ERROR)})}else"delete"===b.action?d.get("/user/delete-event/"+a.email).then(function(b){a.main.closePopup(),"1"!==b.data?a.main.alert("Bạn không có nhắc nhở nào."):a.main.alert("Chúng tôi đã gửi lại email cho bạn")},function(){a.main.alert(Strings.CONNECTION_ERROR)}):d.get("/account/update-email/"+a.email).then(function(b){"1"!==b.data?a.main.alert(Strings.CONNECTION_ERROR):a.main.alert("Chúng tôi đã gửi lại email cho bạn")},function(){a.main.alert(Strings.CONNECTION_ERROR)})},a.subaction&&(a.footer.buttons=[{name:a.subaction.text,action:function(){e.path(a.subaction.link)}}]),a.$on("$destroy",function(){a.footer.buttons=[]})}]),angular.module("lunaApp").factory("User",["$location","$sessionStorage","$http",function(a,b,c){function d(){b.User.signedIn=!1,b.User.name="",b.User.email=""}function e(e,f){d(),c.get("/account/user").then(function(c){var g=c.data;"0"===g?(console.log(g),d(),f||a.path("/sign-in"),e(0)):(b.User.signedIn=!0,b.User.name=g.name,b.User.email=g.email,e(1))},function(){d(),f||a.path("/sign-in"),e(0)})}function f(){b.User.signedIn=!1,b.User.name="",b.User.email="",c.get("/logout").then(function(){return 1},function(){return 2})}return b.User||(b.User={}),{getEmail:function(){var a=b.User;return a.email?a.email:""},setEmail:function(a){return b.User.email=a,this},signIn:function(a,b){e(a,b)},signOut:function(){f()},getInfo:function(){var a=b.User;return a}}}]),angular.module("lunaApp").directive("submitInput",function(){return{restrict:"A",link:function(a,b){b.bind("keydown keypress",function(b){13===b.which&&(a.submit(),b.preventDefault())})}}}),angular.module("lunaApp").directive("form",["$timeout",function(a){return{restrict:"C",link:function(b){$("html, body").animate({scrollTop:$(".app").offset().top},500),a(function(){$(window).scrollTop()+$(window).height()>$(document).height()-60?$(".more").height(10):$(".more").height(50)},100);var c=$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-60?$(".more").height(10):$(".more").height(50)});b.$on("$destroy",function(){$(".more").height(50),c.off("scroll")})}}}]),angular.module("lunaApp").factory("Share",function(){var a={};return{send:function(b,c){a[b]=c},receive:function(b){var c=a[b]||!1;return delete a[b],c}}}),angular.module("lunaApp").directive("select",function(){return{restrict:"E",link:function(a,b,c){c.ngModel&&a.$watch(c.ngModel,function(){$("#tmp option").text($(b).children("option:selected").text()),$(b).width($("#tmp").width())})}}}),angular.module("lunaApp").directive("switcher",function(){return{templateUrl:"views/switcher.html",restrict:"E"}}),angular.module("lunaApp").directive("checker",function(){return{templateUrl:"views/checker.html",restrict:"E",scope:!0,link:function(a){a.$watch("checked",function(b){b?a.counter.checked++:a.counter.checked&&a.counter.checked--})}}}),angular.module("lunaApp").controller("EventlistCtrl",["$http","$scope","User","$location","Share","Events","Strings",function(a,b,c,d,e,f,g){b.main.createPopup("Đang xử lý"),c.signIn(function(){f.getEventList(function(c,f){if(c){b.events=[];for(var h=f.length-1;h>=0;h--){var i=f[h];"100"==i.date&&(i.date="30"),i.minute=parseInt(i.minute)<10?"0"+i.minute:""+i.minute;var j="Không có nội dung";i.message&&(j=i.message.length>25?i.message.substr(0,23)+"...":i.message);var k={row:JSON.parse(JSON.stringify(i)),id:i.id,checked:!1,desc:j,repeat:["Ngày","Tháng","Năm"][i.repeatType],time:("24"==i.hour?"00":i.hour<10?"0"+i.hour:i.hour)+":"+i.minute,pre:i.pre?i.pre+" "+["tiếng","ngày"][i.pre_kind]:"Không",status:i.status,switchStatus:function(){console.log(this),this.status=1-this.status;console.log(""),b.main.createPopup("Đang xử lý"),a.get("/account/status-event/"+this.id+"/"+this.status).then(function(a){"0"===a.data?(this.status=1-this.status,b.main.alert(g.CONNECTION_ERROR)):b.main.closePopup()},function(){this.status=1-this.status,b.main.alert(g.CONNECTION_ERROR)})},edit:function(){console.log(""),this.row.switchStatus=this.switchStatus,this.row.delete=function(){var c=this.id;b.main.pauseup("Bạn có chắc muốn xóa nhắc nhở này chọn không?",function(){b.main.createPopup("Đang xử lý"),a.post("/account/delete-event",[c]).then(function(a){"0"===a.data?b.main.alert(g.CONNECTION_ERROR):(b.main.closePopup(),d.path("/event-list"))},function(){b.main.alert(g.CONNECTION_ERROR)})})},e.send("event-to-edit",this.row),d.path("/create")}};1===i.repeatType?k.time+=" ngày "+i.date:2===i.repeatType&&(k.time+=" "+i.date+"/"+i.month),b.events.push(k)}$("html, body").animate({scrollTop:$(".app").offset().top},500),b.main.closePopup()}else b.main.alert(g.CONNECTION_ERROR)})}),b.deleteList=[];var h=[];b.countChecker=function(){b.deleteList=[],h=[];for(var a=b.events.length-1;a>=0;a--)b.events[a].checked&&(b.deleteList.push(b.events[a].id),h.push(a));return b.deleteList},b.create=function(){d.path("/create")},b.delete=function(){b.main.pauseup("Bạn có chắc muốn xóa các nhắc nhở đã chọn không?",function(){for(var c=JSON.parse(JSON.stringify(b.events)),d=0,e=h.length;e>d;d++)b.events.splice(h[d],1);b.deleteList=[],h=[],a.post("/account/delete-event",b.deleteList).then(function(a){c=[],"1"===a.data?b.main.closePopup():b.main.alert(g.CONNECTION_ERROR)},function(){b.events=JSON.parse(JSON.stringify(c)),c=[],b.main.alert(g.CONNECTION_ERROR)})})}}]),angular.module("lunaApp").directive("eventListItem",function(){return{restrict:"E",link:function(){}}}),function(){CAAT.MyCalendar=function(){return CAAT.MyCalendar.superclass.constructor.call(this),this},CAAT.MyCalendar.prototype={FrameDate:[],currentMonth:null,currentYear:null,currentDate:null,isPaint:!1,styleFont:"Source Sans Pro",initialize:function(a,b){this.director=a,this.scene=b,this.setBounds(0,0,this.director.width,this.director.height).setFillStyle("white"),this.Today=new Date,this.currentMonth=this.Today.getMonth(),this.currentYear=this.Today.getFullYear(),this.currentDate=this.Today,this.CreateContainerFrameDate(1,this.Today);var c=this.getIndexMonthGoto(0);this.CreateContainerFrameDate(0,c);var c=this.getIndexMonthGoto(2);return this.CreateContainerFrameDate(2,c),this.ContainerFrameDate[0].x=-this.width,this.ContainerFrameDate[2].x=this.width,this.ContainerFrameDate[0].setVisible(!1),this.ContainerFrameDate[2].setVisible(!1),this.CreateButtonNext(),this.CreateButtonPrev(),this.currentLunar=convertSolar2Lunar(this.Today.getDate(),this.Today.getMonth()+1,this.Today.getFullYear(),7),this.CreateButtonToday(),this
},ContainerFrameDate:[],indexFrameDate:1,backPageTOday:function(){for(var a=0;a<this.ContainerFrameDate.length;a++)this.removeChild(this.ContainerFrameDate[a]);this.currentMonth=this.Today.getMonth(),this.currentYear=this.Today.getFullYear(),this.currentDate=this.Today,this.CreateContainerFrameDate(1,this.Today);var b=this.getIndexMonthGoto(0);this.CreateContainerFrameDate(0,b);var b=this.getIndexMonthGoto(2);this.CreateContainerFrameDate(2,b),this.ContainerFrameDate[0].x=-this.width,this.ContainerFrameDate[2].x=this.width,this.ContainerFrameDate[0].setVisible(!1),this.ContainerFrameDate[2].setVisible(!1)},CreateContainerFrameDate:function(a,b){this.ContainerFrameDate[a]=(new CAAT.ContainerFrameDate).initialize(this.director,this.scene,this.width,476,b),this.addChild(this.ContainerFrameDate[a])},setIsMoveDirection:function(a,b){return this.direction=b,this.isMove=a,this},removeContainerFrameDateMinusIndex:function(a){for(var b=0;b<this.ContainerFrameDate.length;b++)b!=a&&this.removeChild(this.ContainerFrameDate[b]);this.ContainerFrameDate[1]=this.ContainerFrameDate[a],this.currentMonth=this.ContainerFrameDate[1].myDate.getMonth(),this.currentYear=this.ContainerFrameDate[1].myDate.getFullYear();var c=this.getIndexMonthGoto(0);this.CreateContainerFrameDate(0,c);var c=this.getIndexMonthGoto(2);this.CreateContainerFrameDate(2,c),this.ContainerFrameDate[0].x=-this.width,this.ContainerFrameDate[2].x=this.width,this.ContainerFrameDate[0].setVisible(!1),this.ContainerFrameDate[2].setVisible(!1),this.rePaint()},isMove:!1,direction:0,StartMoveTime:0,endDuringTime:.5,SpaceSWent:100,paint:function(a,b){var c=a.ctx;if(CAAT.MyCalendar.superclass.paint.call(this,a,b),this.isMove){var d=this.director.time/1e3-this.StartMoveTime/1e3,e=d*(this.width-Math.abs(this.x))/this.endDuringTime-this.SpaceSWent>>0;this.SpaceSWent=d*(this.width-Math.abs(this.x))/this.endDuringTime>>0,this.ContainerFrameDate[0].setVisible(!0),this.ContainerFrameDate[2].setVisible(!0),this.ContainerFrameDate[0].x+=this.direction*e,this.ContainerFrameDate[1].x+=this.direction*e,this.ContainerFrameDate[2].x+=this.direction*e,(this.ContainerFrameDate[0].x>=0||this.ContainerFrameDate[2].x<=0)&&(this.isMove=!1,this.SpaceSWent=0,this.ContainerFrameDate[0].x>=0?this.removeContainerFrameDateMinusIndex(0):this.removeContainerFrameDateMinusIndex(2),this.ContainerFrameDate[1].x=0)}if(1>b&&this.isPaint){c.globalAlpha=.3,c.beginPath(),c.font="200 90px "+this.styleFont,c.rect(0,0,this.width,this.height),c.fillStyle="#f6f6f6",c.fill(),c.lineWidth=1,c.lineJoin="round",c.strokeStyle="black",c.stroke(),c.closePath(),c.globalAlpha=1,c.beginPath(),c.rect(0,0,this.width,50),c.rect(0,476,this.width,80),c.fillStyle="#444750",c.fill(),c.closePath(),c.beginPath();for(var f=0;3>f;f++)c.beginPath(),c.rect(0,71*f*2+121,this.width,71),c.fillStyle="#f6f6f6",c.fill(),c.strokeStyle="#d6d6d6",c.stroke(),c.closePath();c.beginPath();for(var f=0;7>f;f++)c.font="200 23px "+this.styleFont,c.fillStyle="white",c.fillText(this.getStringDayFromIndex(f),f*this.width/7+20>>0,35);c.font="200 23px "+this.styleFont;var g=this.currentMonth+1+"/"+this.currentYear;c.fillStyle="white",c.fillText(g,this.width/2-c.measureText(g).width/2+80,510),c.closePath()}this.isPaint||(this.isPaint=!0,this.cacheAsBitmap(0,CAAT.Foundation.ActorContainer.CACHE_DEEP))},setCurrentLunar:function(a){var b=convertSolar2Lunar(a.getDate(),a.getMonth()+1,a.getFullYear(),7);return this.currentDate=a,this.currentLunar=b,this.rePaint(),this},setCurrentDate:function(a){this.currentDate=a},getStringDayFromIndex:function(a){switch(a){case 0:return"CN";case 1:return"T2";case 2:return"T3";case 3:return"T4";case 4:return"T5";case 5:return"T6";case 6:return"T7"}},getStringMonthFromIndex:function(a){switch(a){case 1:return"tháng một";case 2:return"tháng hai";case 3:return"tháng ba";case 4:return"tháng tư";case 5:return"tháng năm";case 6:return"tháng sáu";case 7:return"tháng bảy";case 8:return"tháng tám";case 9:return"tháng chín";case 10:return"tháng mười";case 11:return"tháng mười một";case 12:return"tháng mười hai"}},calculateCanChi:function(a){var b=["canh","tân","nhâm","quý","giáp","ất","bính","đinh","mậu","kỷ"],c=["thân","dậu","tuất","hợi","tý","sửu","dần","mão","thìn","tỵ","ngọ","mùi"],d=" năm "+b[a%10]+" "+c[a%12];return d},CreateButtonNext:function(){var a=this;this.Next=(new CAAT.Foundation.ActorContainer).setBounds(0,0,50,50).setPosition(this.width-50,476).setFillStyle("red"),this.Next.paint=function(a){var b=a.ctx;b.beginPath(),b.moveTo(18,13),b.lineTo(35,25),b.lineTo(18,37),b.fillStyle="white",b.fill(),b.closePath()},this.Next.mouseEnter=function(){document.body.style.cursor="pointer"},this.Next.mouseExit=function(){document.body.style.cursor="default"},this.Next.mouseDown=function(){a.StartMoveTime=a.director.time,a.SpaceSWent=100,a.setIsMoveDirection(!0,-1),a.rePaint()},this.addChild(this.Next)},getIndexMonthGoto:function(a){var b=this,c=b.currentYear,d=b.currentMonth;if(2==a){d=b.currentMonth+1,d>=12&&(d=0,c+=1);var e=new Date(c,d,1)}if(0==a){d=b.currentMonth-1,0>d&&(d=11,c-=1);var e=new Date(c,d,1)}return e},CreateButtonPrev:function(){var a=this;this.Prev=(new CAAT.Foundation.ActorContainer).setBounds(0,0,50,50).setPosition(0,476).setFillStyle("red"),this.Prev.paint=function(a){var b=a.ctx;b.beginPath(),b.moveTo(32,13),b.lineTo(15,25),b.lineTo(32,37),b.fillStyle="white",b.fill(),b.closePath()},this.Prev.mouseEnter=function(){document.body.style.cursor="pointer"},this.Prev.mouseExit=function(){document.body.style.cursor="default"},this.Prev.mouseDown=function(){a.StartMoveTime=a.director.time,a.SpaceSWent=100,a.setIsMoveDirection(!0,1),a.rePaint()},this.addChild(this.Prev)},rePaint:function(){this.stopCacheAsBitmap(),this.cacheAsBitmap(0)},CreateButtonToday:function(){var a=this;this.ButtonToday=(new CAAT.Foundation.ActorContainer).setBounds(0,0,155,50).setPosition(120,470),this.ButtonToday.isPaint=!1,this.ButtonToday.paint=function(b,c){if(CAAT.MyCalendar.superclass.paint.call(this,b,c),1>c&&this.isPaint){var d=b.ctx;d.beginPath(),d.font="200 23px "+a.styleFont,d.fillStyle="white",d.fillText("Hôm nay",5,40),d.closePath()}this.isPaint||(this.isPaint=!0,this.cacheAsBitmap(0,CAAT.Foundation.ActorContainer.CACHE_DEEP))},this.ButtonToday.mouseEnter=function(){document.body.style.cursor="pointer"},this.ButtonToday.mouseExit=function(){document.body.style.cursor="default"},this.ButtonToday.mouseDown=function(){a.backPageTOday(),a.currentLunar=convertSolar2Lunar(a.Today.getDate(),a.Today.getMonth()+1,a.Today.getFullYear(),7),a.rePaint()},this.addChild(this.ButtonToday)}},extend(CAAT.MyCalendar,CAAT.Foundation.ActorContainer)}(),function(){CAAT.ContainerFrameDate=function(){return CAAT.ContainerFrameDate.superclass.constructor.call(this),this},CAAT.ContainerFrameDate.prototype={isPaint:!1,isPress:!1,startX:[],ch:0,cw:0,initialize:function(a,b,c,d,e){this.director=a,this.scene=b,this.setBounds(0,0,c,d),this.myDate=e,this.CreateFrameDate(e),this.cy=a.y,this.cx=a.x;var f=this;return document.onmousemove=function(a){a=a||window.event;var b=a.target||a.srcElement,c=b.nodeName.toLowerCase();"canvas"==c||f.mouseExit()},this},_move:function(a,b,c){for(var d="default",e=1;e<this.FrameDate.length;e++)this.FrameDate[e].x+70>b&&this.FrameDate[e].x<b&&this.FrameDate[e].y+70>c&&this.FrameDate[e].y<c?(d="pointer",this.FrameDate[e].setIsMouseDown(!0)):this.FrameDate[e].isMouseDown&&this.FrameDate[e].setIsMouseDown(!1);document.body.style.cursor=d},_down:function(a,b){var c=this.parent.isMove;this.isPress||c||(this.isPress=!0,this.startX=b,this.startXX=this.x,CAAT.chooseDate&&(lunnarDate=convertSolar2Lunar(this.myDate.getDate(),this.myDate.getMonth()+1,this.myDate.getFullYear(),7),CAAT.chooseDate(lunnarDate)))},_up:function(a,b,c){this.isPress=!1;var d=this.x-this.startXX;Math.abs(d)<=100&&(this.x=this.startXX,this.parent.ContainerFrameDate[0].setVisible(!1),this.parent.ContainerFrameDate[2].setVisible(!1),this.parent.ContainerFrameDate[0].x=-this.width,this.parent.ContainerFrameDate[2].x=this.width);for(var e=getDaysOfMonth(this.myDate.getFullYear(),this.myDate.getMonth()),f=1;e>=f;f++){var g=this.FrameDate[f];g.AABB.contains(b,c)&&g.setCurrentLunar()}},_drag:function(a,b){if(this.parent&&this.parent.isMove)var c=this.parent.isMove;if(this.isPress&&!c){this.x=b-this.startX,this.parent.ContainerFrameDate[0].setVisible(!0),this.parent.ContainerFrameDate[2].setVisible(!0),this.parent.ContainerFrameDate[0].x=this.x-this.width,this.parent.ContainerFrameDate[2].x=this.x+this.width;var d=this.x-this.startXX;Math.abs(d)>100&&(this.parent.StartMoveTime=this.director.time,this.parent.SpaceSWent=100,this.isPress=!1,0>d?this.parent.setIsMoveDirection(!0,-1):this.parent.setIsMoveDirection(!0,1))}},touchStart:function(a){var b=this;touch=a.changedTouches[0],b._down(b,touch.pageX,touch.pageY)},touchMove:function(a){var b=this;touch=a.getSourceEvent().changedTouches[0],b._drag(b,touch.pageX,touch.pageY)},touchEnd:function(a){var b=this;touch=a.getSourceEvent().changedTouches[0],b._up(b,touch.pageX,touch.pageY)},mouseDown:function(a){var b=this;b._down(b,a.screenPoint.x,a.screenPoint.y)},mouseUp:function(a){var b=this;b._up(b,a.screenPoint.x,a.screenPoint.y)},mouseDrag:function(a){var b=this;b._drag(b,a.screenPoint.x,a.screenPoint.y)},mouseMove:function(a){var b=this;b._move(b,a.screenPoint.x,a.screenPoint.y)},mouseExit:function(){for(var a=1;a<this.FrameDate.length;a++)this.FrameDate[a].setIsMouseDown(!1);document.body.style.cursor="default"},CreateFrameDate:function(a){this.FrameDate=[],this.removeFrameDate();for(var b=getDaysOfMonth(a.getFullYear(),a.getMonth()),c=new Date(a.getFullYear(),a.getMonth(),1),d=c.getDay(),e=0,f=71,g=1;b>=g;g++)this.FrameDate[g]=(new CAAT.MyDate).initialize(this.director,this.scene,new Date(a.getFullYear(),a.getMonth(),g),f,f).setPosition(f*d,f*e+50),this.addChild(this.FrameDate[g]),d++,d>=7&&(d=0,e++)},removeFrameDate:function(){for(var a=1;a<=this.FrameDate.length;a++)this.removeChild(this.FrameDate[a])}},extend(CAAT.ContainerFrameDate,CAAT.Foundation.ActorContainer)}(),function(){CAAT.MyDate=function(){return CAAT.MyDate.superclass.constructor.call(this),this},CAAT.MyDate.prototype={styleFont:"Source Sans Pro",isPaint:!1,FillStyleColor:"#dcdcdc",initialize:function(a,b,c,d,e){return this.director=a,this.scene=b,this.setBounds(0,0,d,e),this.date=c,this.today=new Date,this.enableEvents(!1),this},paint:function(a,b){CAAT.MyDate.superclass.paint.call(this,a,b);var c=a.ctx;if(1>b&&this.isPaint){var d=convertSolar2Lunar(this.date.getDate(),this.date.getMonth()+1,this.date.getFullYear(),7);this.today.getMonth()==this.date.getMonth()&&this.today.getFullYear()==this.date.getFullYear()&&this.today.getDate()==this.date.getDate()&&(c.globalAlpha=.8,c.beginPath(),c.arc(this.width/2,this.height/2,this.width/2,0,2*Math.PI,!1),c.fillStyle="#dcdcdc",c.fill(),c.closePath(),c.globalAlpha=1),this.isMouseDown&&(c.globalAlpha=1,c.beginPath(),c.arc(this.width/2,this.height/2,this.width/2-4,0,2*Math.PI,!1),c.lineWidth=5,c.strokeStyle="#444750",c.stroke(),c.closePath(),c.globalAlpha=1);var e="#525252";6==this.date.getDay()&&(e="green"),0==this.date.getDay()&&(e="red"),c.beginPath(),c.font="200 30px "+this.styleFont,c.fillStyle=e,c.fillText(this.date.getDate(),-c.measureText(this.date.getDate()+"").width/2+this.width/2,35),c.closePath(),c.beginPath(),c.font="200 15px "+this.styleFont,1==d[0]?(c.fillStyle="red",c.fillText(d[0]+"/"+d[1],-c.measureText(d[0]+"/"+d[1]).width/2+this.width/2,this.height-10)):(c.fillStyle="#525252",c.fillText(d[0],-c.measureText(d[0]).width/2+this.width/2,this.height-10)),c.closePath()}this.isPaint||(this.isPaint=!0,this.cacheAsBitmap(0,CAAT.Foundation.ActorContainer.CACHE_DEEP))},isMouseDown:!1,rePaint:function(){this.stopCacheAsBitmap(),this.cacheAsBitmap(0)},setIsMouseDown:function(a){this.isMouseDown=a,this.rePaint()},setCurrentLunar:function(){this.parent.parent&&this.parent.parent.setCurrentLunar(this.date),this.rePaint()}},extend(CAAT.MyDate,CAAT.Foundation.ActorContainer)}();var GIO_HD=new Array("110100101100","001101001011","110011010010","101100110100","001011001101","010010110011"),CHI=new Array("Tý","Sửu","Dần","Mão","Thìn","Tỵ","Ngọ","Mùi","Thân","Dậu","Tuất","Hợi"),CANVAS_WIDTH=498,CANVAS_HEIGHT=527;window.onload=function(){function a(){(new CAAT.Module.Preloader.Preloader).addElement("add","images/picture1.jpg").addElement("minioic","images/minioic.jpg").load(function(a){setTimeout(function(){b(a)},100)})}function b(a){var b=(new CAAT.Director).initialize(CANVAS_WIDTH,CANVAS_HEIGHT,document.getElementById("canvas"));b.setImagesCache(a);var c=b.createScene(),d=(new CAAT.MyCalendar).initialize(b,c);c.addChild(d);var e,f,g;e=129,f=129,g=129;var h="#"+e.toString(16)+f.toString(16)+g.toString(16);console.log(" co lor la:"+h),CAAT.loop(1)}a()};var PI=Math.PI;angular.module("lunaApp").controller("SignInCtrl",["$scope","$location","User",function(a,b){a.footer.buttons=[{name:"quay lại",action:function(){b.path("/")}}],a.$on("$destroy",function(){a.footer.buttons=[]})}]),angular.module("lunaApp").controller("UpdateEmailCtrl",["$location","$http","$scope","Strings","User","Validate",function(a,b,c,d,e,f){c.footer.buttons=[{name:"cập nhật",action:function(){c.submit()}},{name:"quay lại",action:function(){c.main.back()}}],c.$on("$destroy",function(){c.footer.buttons=[]}),c.submit=function(){c.email?f.validateEmail(c.email)?(c.main.createPopup("Đang xử lý"),b.get("/account/update-email/"+c.email).then(function(b){"1"!==b.data?c.main.alert(d.CONNECTION_ERROR):(e.setEmail(c.email),c.main.closePopup(),a.path("/confirmation/email"))},function(){c.main.alert(d.CONNECTION_ERROR)})):c.main.alert("Bạn cần nhập đúng địa chỉ email."):c.main.alert("Bạn cần nhập địa chỉ email.")}}]),angular.module("lunaApp").controller("ConfirmSignUpCtrl",["$http","$scope","$location","User","Validate",function(a,b,c,d,e){b.main.createPopup("Đang xử lý"),d.signIn(function(a){a?(b.originalEmail=d.getEmail(),b.email=d.getEmail(),b.main.closePopup()):(c.path("/sign-in"),b.main.alert("Có lỗi trong quá trình đăng nhập. Xin hãy thử lại sau."))}),b.footer.buttons=[{name:"cập nhật",action:function(){b.submit()}}],b.$on("$destroy",function(){b.footer.buttons=[]}),b.submit=function(){b.email=b.email.replace(" ",""),b.email!=b.originalEmail&&b.email&&!/^\s*$/.test(b.email)?e.validateEmail(b.email)?(b.main.createPopup("Đang xử lý"),a.get("/account/update-email/"+b.email).then(function(){d.setEmail(b.email),b.main.closePopup(),c.path("/event-list")},function(){b.main.alert("hệ thống đang bận, xin thử lại sau ít phút")})):b.main.alert("Bạn cần nhập đúng địa chỉ email."):c.path("/event-list")}}]),angular.module("lunaApp").factory("Events",["$sessionStorage","$http",function(a,b){function c(c){b.get("/account/event-list").then(function(b){a.Events=b.data,c(1,b.data)},function(){c(0)})}return a.Events||(a.Events=[]),{getEventList:function(a){c(a)}}}]),angular.module("lunaApp").controller("AccountCtrl",["$scope","$location",function(a,b){a.footer.buttons=[{name:"danh sách nhắc nhở",action:function(){b.path("/event-list")}},{name:"quay lại",action:function(){a.main.back()}}],a.$on("$destroy",function(){a.footer.buttons=[]})}]),angular.module("lunaApp").controller("FeedbackCtrl",["$scope",function(a){a.footer.buttons=[{name:"quay lại",action:function(){a.main.back()}}],a.$on("$destroy",function(){a.footer.buttons=[]})}]),angular.module("lunaApp").directive("autoscroll",function(){return{restrict:"A",link:function(){$("html, body").animate({scrollTop:$(".app").offset().top},500)}}});