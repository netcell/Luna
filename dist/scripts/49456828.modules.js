function proxyFunction(a,b,c,d,e){return function(){var f=Array.prototype.slice.call(arguments);c&&c({object:a,method:b,arguments:f});var g=null;try{if(g=a[b].apply(a,f),d){var h=d({object:a,method:b,arguments:f});h&&(g=h)}}catch(i){if(!e)throw i;g=e({object:a,method:b,arguments:f,exception:i})}return g}}function proxyAttribute(a,b,c,d,e){a.__defineGetter__(c,function(){return d&&d(b,c),b[c]}),a.__defineSetter__(c,function(a){b[c]=a,e&&e(b,c,a)})}function proxyObject(a,b,c,d,e,f){if("object"!=typeof a||isArray(a)||isString(a)||a.$proxy)return a;var g={$proxy:!0};g.$proxy_delegate=a;for(var h in a)"constructor"!==h&&("function"==typeof a[h]?g[h]=proxyFunction(a,h,b,c,d):proxyAttribute(g,a,h,e,f));return g}!function(a,b,c){"use strict";b.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(a,d){function e(){var a,e,f,i;for(a in h)k(g[a])&&d.cookies(a,c);for(a in g)e=g[a],b.isString(e)?e!==h[a]&&(d.cookies(a,e),i=!0):b.isDefined(h[a])?g[a]=h[a]:delete g[a];if(i){i=!1,f=d.cookies();for(a in g)g[a]!==f[a]&&(k(f[a])?delete g[a]:g[a]=f[a],i=!0)}}var f,g={},h={},i=!1,j=b.copy,k=b.isUndefined;return d.addPollFn(function(){var b=d.cookies();f!=b&&(f=b,j(b,h),j(b,g),i&&a.$apply())})(),i=!0,a.$watch(e),g}]).factory("$cookieStore",["$cookies",function(a){return{get:function(c){var d=a[c];return d?b.fromJson(d):d},put:function(c,d){a[c]=b.toJson(d)},remove:function(b){delete a[b]}}}])}(window,window.angular),function(a,b){"use strict";function c(){function a(a,c){return b.extend(new(b.extend(function(){},{prototype:a})),c)}function c(a,b){var c=b.caseInsensitiveMatch,d={originalPath:a,regexp:a},e=d.keys=[];return a=a.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?|\*])?/g,function(a,b,c,d){var f="?"===d?d:null,g="*"===d?d:null;return e.push({name:c,optional:!!f}),b=b||"",""+(f?"":b)+"(?:"+(f?b:"")+(g&&"(.+?)"||"([^/]+)")+(f||"")+")"+(f||"")}).replace(/([\/$\*])/g,"\\$1"),d.regexp=new RegExp("^"+a+"$",c?"i":""),d}var d={};this.when=function(a,e){if(d[a]=b.extend({reloadOnSearch:!0},e,a&&c(a,e)),a){var f="/"==a[a.length-1]?a.substr(0,a.length-1):a+"/";d[f]=b.extend({redirectTo:a},c(f,e))}return this},this.otherwise=function(a){return this.when(null,a),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(c,e,f,g,h,i,j,k){function l(a,b){var c=b.keys,d={};if(!b.regexp)return null;var e=b.regexp.exec(a);if(!e)return null;for(var f=1,g=e.length;g>f;++f){var h=c[f-1],i="string"==typeof e[f]?decodeURIComponent(e[f]):e[f];h&&i&&(d[h.name]=i)}return d}function m(){var a=n(),d=q.current;a&&d&&a.$$route===d.$$route&&b.equals(a.pathParams,d.pathParams)&&!a.reloadOnSearch&&!p?(d.params=a.params,b.copy(d.params,f),c.$broadcast("$routeUpdate",d)):(a||d)&&(p=!1,c.$broadcast("$routeChangeStart",a,d),q.current=a,a&&a.redirectTo&&(b.isString(a.redirectTo)?e.path(o(a.redirectTo,a.params)).search(a.params).replace():e.url(a.redirectTo(a.pathParams,e.path(),e.search())).replace()),g.when(a).then(function(){if(a){var c,d,e=b.extend({},a.resolve);return b.forEach(e,function(a,c){e[c]=b.isString(a)?h.get(a):h.invoke(a)}),b.isDefined(c=a.template)?b.isFunction(c)&&(c=c(a.params)):b.isDefined(d=a.templateUrl)&&(b.isFunction(d)&&(d=d(a.params)),d=k.getTrustedResourceUrl(d),b.isDefined(d)&&(a.loadedTemplateUrl=d,c=i.get(d,{cache:j}).then(function(a){return a.data}))),b.isDefined(c)&&(e.$template=c),g.all(e)}}).then(function(e){a==q.current&&(a&&(a.locals=e,b.copy(a.params,f)),c.$broadcast("$routeChangeSuccess",a,d))},function(b){a==q.current&&c.$broadcast("$routeChangeError",a,d,b)}))}function n(){var c,f;return b.forEach(d,function(d){!f&&(c=l(e.path(),d))&&(f=a(d,{params:b.extend({},e.search(),c),pathParams:c}),f.$$route=d)}),f||d[null]&&a(d[null],{params:{},pathParams:{}})}function o(a,c){var d=[];return b.forEach((a||"").split(":"),function(a,b){if(0===b)d.push(a);else{var e=a.match(/(\w+)(.*)/),f=e[1];d.push(c[f]),d.push(e[2]||""),delete c[f]}}),d.join("")}var p=!1,q={routes:d,reload:function(){p=!0,c.$evalAsync(m)}};return c.$on("$locationChangeSuccess",m),q}]}function d(){this.$get=function(){return{}}}function e(a,c,d,e,f){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(g,h,i,j,k){function l(){n&&(n.$destroy(),n=null),o&&(f.leave(o),o=null)}function m(){var i=a.current&&a.current.locals,j=i&&i.$template;if(j){var m=g.$new();k(m,function(k){k.html(j),f.enter(k,null,o||h,function(){!b.isDefined(p)||p&&!g.$eval(p)||c()}),l();var r=d(k.contents()),s=a.current;if(n=s.scope=m,o=k,s.controller){i.$scope=n;var t=e(s.controller,i);s.controllerAs&&(n[s.controllerAs]=t),k.data("$ngControllerController",t),k.children().data("$ngControllerController",t)}r(n),n.$emit("$viewContentLoaded"),n.$eval(q)})}else l()}var n,o,p=i.autoscroll,q=i.onload||"";g.$on("$routeChangeSuccess",m),m()}}}var f=b.module("ngRoute",["ng"]).provider("$route",c);f.provider("$routeParams",d),f.directive("ngView",e),e.$inject=["$route","$anchorScroll","$compile","$controller","$animate"]}(window,window.angular),function(a,b,c){"use strict";b.module("ngAnimate",["ng"]).config(["$provide","$animateProvider",function(d,e){var f=b.noop,g=b.forEach,h=e.$$selectors,i=1,j="$$ngAnimateState",k="ng-animate",l={running:!0};d.decorator("$animate",["$delegate","$injector","$sniffer","$rootElement","$timeout","$rootScope","$document",function(a,c,d,e,m,n){function o(a){if(a){var b=[],e={},f=a.substr(1).split(".");(d.transitions||d.animations)&&f.push("");for(var g=0;g<f.length;g++){var i=f[g],j=h[i];j&&!e[i]&&(b.push(c.get(j)),e[i]=!0)}return b}}function p(a,b,c,d,e,h,i){function l(a){if(q(),a===!0)return u(),void 0;var b=c.data(j);b&&(b.done=u,c.data(j,b)),n(B,"after",u)}function n(d,e,h){function i(a,b){var c=b+"Complete",e=d[a];e[c]=!0,(e[j]||f)();for(var g=0;g<d.length;g++)if(!d[g][c])return;h()}var j=e+"End";g(d,function(d,f){var g=function(){i(f,e)};return"before"!=e||"enter"!=a&&"move"!=a?(d[e]?d[j]=z?d[e](c,b,g):d[e](c,g):g(),void 0):(g(),void 0)})}function p(){i&&m(i,0,!1)}function q(){q.hasBeenRun||(q.hasBeenRun=!0,h())}function u(){if(!u.hasBeenRun){u.hasBeenRun=!0;var a=c.data(j);a&&(z?s(c):(a.closeAnimationTimeout=m(function(){s(c)},0,!1),c.data(j,a))),p()}}var v=c.attr("class")||"",w=v+" "+b,x=(" "+w).replace(/\s+/g,".");d||(d=e?e.parent():c.parent());var y=o(x),z="addClass"==a||"removeClass"==a,A=c.data(j)||{};if(t(c,d)||0===y.length)return q(),u(),void 0;var B=[];if(A.running&&z&&A.structural||g(y,function(d){if(!d.allowCancel||d.allowCancel(c,a,b)){var e,f=d[a];"leave"==a?(e=f,f=null):e=d["before"+a.charAt(0).toUpperCase()+a.substr(1)],B.push({before:e,after:f})}}),0===B.length)return q(),p(),void 0;var C=" "+v+" ";A.running&&(m.cancel(A.closeAnimationTimeout),s(c),r(A.animations),A.beforeComplete?(A.done||f)(!0):z&&!A.structural&&(C="removeClass"==A.event?C.replace(A.className,""):C+A.className+" "));var D=" "+b+" ";return"addClass"==a&&C.indexOf(D)>=0||"removeClass"==a&&-1==C.indexOf(D)?(q(),p(),void 0):(c.addClass(k),c.data(j,{running:!0,event:a,className:b,structural:!z,animations:B,done:l}),n(B,"before",l),void 0)}function q(a){var c=a[0];c.nodeType==i&&g(c.querySelectorAll("."+k),function(a){a=b.element(a);var c=a.data(j);c&&(r(c.animations),s(a))})}function r(a){var b=!0;g(a,function(c){a.beforeComplete||(c.beforeEnd||f)(b),a.afterComplete||(c.afterEnd||f)(b)})}function s(a){a[0]==e[0]?l.disabled||(l.running=!1,l.structural=!1):(a.removeClass(k),a.removeData(j))}function t(a,b){if(l.disabled)return!0;if(a[0]==e[0])return l.disabled||l.running;do{if(0===b.length)break;var c=b[0]==e[0],d=c?l:b.data(j),f=d&&(!!d.disabled||!!d.running);if(c||f)return f;if(c)return!0}while(b=b.parent());return!0}return e.data(j,l),n.$$postDigest(function(){l.running=!1}),{enter:function(b,c,d,e){this.enabled(!1,b),a.enter(b,c,d),n.$$postDigest(function(){p("enter","ng-enter",b,c,d,f,e)})},leave:function(b,c){q(b),this.enabled(!1,b),n.$$postDigest(function(){p("leave","ng-leave",b,null,null,function(){a.leave(b)},c)})},move:function(b,c,d,e){q(b),this.enabled(!1,b),a.move(b,c,d),n.$$postDigest(function(){p("move","ng-move",b,c,d,f,e)})},addClass:function(b,c,d){p("addClass",c,b,null,null,function(){a.addClass(b,c)},d)},removeClass:function(b,c,d){p("removeClass",c,b,null,null,function(){a.removeClass(b,c)},d)},enabled:function(a,b){switch(arguments.length){case 2:if(a)s(b);else{var c=b.data(j)||{};c.disabled=!0,b.data(j,c)}break;case 1:l.disabled=!a;break;default:a=!l.disabled}return!!a}}}]),e.register("",["$window","$sniffer","$timeout",function(d,e,h){function j(a){P.push(a),h.cancel(E),E=h(function(){g(P,function(a){a()}),P=[],E=null,N={}},10,!1)}function k(a,b){var c=b?N[b]:null;if(!c){var e,f,h,j,k=0,m=0,n=0,o=0;g(a,function(a){if(a.nodeType==i){var b=d.getComputedStyle(a)||{};h=b[z+F],k=Math.max(l(h),k),j=b[z+G],e=b[z+H],m=Math.max(l(e),m),f=b[B+H],o=Math.max(l(f),o);var c=l(b[B+F]);c>0&&(c*=parseInt(b[B+I],10)||1),n=Math.max(c,n)}}),c={total:0,transitionPropertyStyle:j,transitionDurationStyle:h,transitionDelayStyle:e,transitionDelay:m,transitionDuration:k,animationDelayStyle:f,animationDelay:o,animationDuration:n},b&&(N[b]=c)}return c}function l(a){var c=0,d=b.isString(a)?a.split(/\s*,\s*/):[];return g(d,function(a){c=Math.max(parseFloat(a)||0,c)}),c}function m(a){var b=a.parent(),c=b.data(J);return c||(b.data(J,++O),c=O),c+"-"+a[0].className}function n(a,b){var c=m(a),d=c+" "+b,e={},f=N[d]?++N[d].total:0;if(f>0){var h=b+"-stagger",i=c+" "+h,j=!N[i];j&&a.addClass(h),e=k(a,i),j&&a.removeClass(h)}a.addClass(b);var l=k(a,d),n=Math.max(l.transitionDuration,l.animationDuration);if(0===n)return a.removeClass(b),!1;var q=(a[0],"");return l.transitionDuration>0?(a.addClass(L),q+=M+" ",o(a)):p(a),g(b.split(" "),function(a,b){q+=(b>0?" ":"")+a+"-active"}),a.data(K,{className:b,activeClassName:q,maxDuration:n,classes:b+" "+q,timings:l,stagger:e,ii:f}),!0}function o(a){a[0].style[z+G]="none"}function p(a){a[0].style[B]="none 0s"}function q(a){var b=a[0],c=z+G;b.style[c]&&b.style[c].length>0&&(b.style[c]="")}function r(a){a[0].style[B]=""}function s(a,b,c){function d(a){a.stopPropagation();var b=a.originalEvent||a,d=b.$manualTimeStamp||b.timeStamp||Date.now();Math.max(d-n,0)>=m&&b.elapsedTime>=k&&c()}var f=a.data(K);if(!a.hasClass(b)||!f)return c(),void 0;var g,h=a[0],i=f.timings,j=f.stagger,k=f.maxDuration,l=f.activeClassName,m=1e3*Math.max(i.transitionDelay,i.animationDelay),n=Date.now(),o=C+" "+A,p=f.ii,q="",s=[];if(i.transitionDuration>0){var u=i.transitionPropertyStyle;if(-1==u.indexOf("all")){g=!0;var v=e.msie?"-ms-zoom":"border-spacing";q+=D+"transition-property: "+u+", "+v+"; ",q+=D+"transition-duration: "+i.transitionDurationStyle+", "+i.transitionDuration+"s; ",s.push(D+"transition-property"),s.push(D+"transition-duration")}}else r(a);if(p>0){if(j.transitionDelay>0&&0===j.transitionDuration){var w=i.transitionDelayStyle;g&&(w+=", "+i.transitionDelay+"s"),q+=D+"transition-delay: "+t(w,j.transitionDelay,p)+"; ",s.push(D+"transition-delay")}j.animationDelay>0&&0===j.animationDuration&&(q+=D+"animation-delay: "+t(i.animationDelayStyle,j.animationDelay,p)+"; ",s.push(D+"animation-delay"))}if(s.length>0){var y=h.getAttribute("style")||"";h.setAttribute("style",y+" "+q)}return a.on(o,d),a.addClass(l),function(){a.off(o,d),a.removeClass(l),x(a,b);for(var c in s)h.style.removeProperty(s[c])}}function t(a,b,c){var d="";return g(a.split(","),function(a,e){d+=(e>0?",":"")+(c*b+parseInt(a,10))+"s"}),d}function u(a,b){return n(a,b)?function(c){c&&x(a,b)}:void 0}function v(a,b,c){return a.data(K)?s(a,b,c):(x(a,b),c(),void 0)}function w(a,b,c){var d=u(a,b);if(!d)return c(),void 0;var e=d;return j(function(){q(a),e=v(a,b,c)}),function(a){(e||f)(a)}}function x(a,b){a.removeClass(b),a.removeClass(L),a.removeData(K)}function y(a,c){var d="";return a=b.isArray(a)?a:a.split(/\s+/),g(a,function(a,b){a&&a.length>0&&(d+=(b>0?" ":"")+a+c)}),d}var z,A,B,C,D="";a.ontransitionend===c&&a.onwebkittransitionend!==c?(D="-webkit-",z="WebkitTransition",A="webkitTransitionEnd transitionend"):(z="transition",A="transitionend"),a.onanimationend===c&&a.onwebkitanimationend!==c?(D="-webkit-",B="WebkitAnimation",C="webkitAnimationEnd animationend"):(B="animation",C="animationend");var E,F="Duration",G="Property",H="Delay",I="IterationCount",J="$$ngAnimateKey",K="$$ngAnimateCSS3Data",L="ng-animate-start",M="ng-animate-active",N={},O=0,P=[];return{allowCancel:function(a,c,d){var e=(a.data(K)||{}).classes;if(!e||["enter","leave","move"].indexOf(c)>=0)return!0;var f=a.parent(),h=b.element(a[0].cloneNode());h.attr("style","position:absolute; top:-9999px; left:-9999px"),h.removeAttr("id"),h.html(""),g(e.split(" "),function(a){h.removeClass(a)});var i="addClass"==c?"-add":"-remove";h.addClass(y(d,i)),f.append(h);var j=k(h);return h.remove(),Math.max(j.transitionDuration,j.animationDuration)>0},enter:function(a,b){return w(a,"ng-enter",b)},leave:function(a,b){return w(a,"ng-leave",b)},move:function(a,b){return w(a,"ng-move",b)},beforeAddClass:function(a,b,c){var d=u(a,y(b,"-add"));return d?(j(function(){q(a),c()}),d):(c(),void 0)},addClass:function(a,b,c){return v(a,y(b,"-add"),c)},beforeRemoveClass:function(a,b,c){var d=u(a,y(b,"-remove"));return d?(j(function(){q(a),c()}),d):(c(),void 0)},removeClass:function(a,b,c){return v(a,y(b,"-remove"),c)}}}])}])}(window,window.angular),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(a,b,c){"use strict";return{require:"ngModel",restrict:"A, C",link:function(d,e,f,g){function h(){n=k,v=getComputedStyle(k),angular.forEach(D,function(a){s+=a+":"+v.getPropertyValue(a)+";"}),u.setAttribute("style",s)}function i(){var b,c,d,e;n!==k&&h(),o||(o=!0,u.value=k.value+q,u.style.overflowY=k.style.overflowY,b=""===k.style.height?"auto":parseInt(k.style.height,10),d=parseInt(getComputedStyle(k).getPropertyValue("width"),10)-y.width,u.style.width=d+"px",c=u.scrollHeight,c>C?(c=C,e="scroll"):B>c&&(c=B),c+=y.height,k.style.overflowY=e||"hidden",b!==c&&(k.style.height=c+"px"),a(function(){o=!1},1))}function j(){o=!1,i()}var k=e[0],l=e;if("TEXTAREA"===k.nodeName&&b.getComputedStyle){l.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var m=k.value;k.value="",k.value=m;var n,o,p=f.msdElastic||c.append,q="\\n"===p?"\n":p,r=angular.element(b),s="position: absolute; top: -999px; right: auto; bottom: auto; left: 0 ;overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",t=angular.element('<textarea tabindex="-1" style="'+s+'"/>').data("elastic",!0),u=t[0],v=getComputedStyle(k),w=v.getPropertyValue("resize"),x="border-box"===v.getPropertyValue("box-sizing")||"border-box"===v.getPropertyValue("-moz-box-sizing")||"border-box"===v.getPropertyValue("-webkit-box-sizing"),y=x?{width:parseInt(v.getPropertyValue("border-right-width"),10)+parseInt(v.getPropertyValue("padding-right"),10)+parseInt(v.getPropertyValue("padding-left"),10)+parseInt(v.getPropertyValue("border-left-width"),10),height:parseInt(v.getPropertyValue("border-top-width"),10)+parseInt(v.getPropertyValue("padding-top"),10)+parseInt(v.getPropertyValue("padding-bottom"),10)+parseInt(v.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},z=parseInt(v.getPropertyValue("min-height"),10),A=parseInt(v.getPropertyValue("height"),10),B=Math.max(z,A)-y.height,C=parseInt(v.getPropertyValue("max-height"),10),D=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];l.data("elastic")||(C=C&&C>0?C:9e4,u.parentNode!==document.body&&angular.element(document.body).append(u),l.css({resize:"none"===w||"vertical"===w?"none":"horizontal"}).data("elastic",!0),k.oninput="onpropertychange"in k&&"oninput"in k?k.onkeyup=i:i,r.bind("resize",j),d.$watch(function(){return g.$modelValue},function(){j()}),d.$on("$destroy",function(){t.remove(),r.unbind("resize",j)}))}}}}]),function(a,b){"use strict";function c(a,b,c){d.directive(a,["$parse","$swipe",function(d,e){var f=75,g=.3,h=30;return function(i,j,k){function l(a){if(!m)return!1;var c=Math.abs(a.y-m.y),d=(a.x-m.x)*b;return n&&f>c&&d>0&&d>h&&g>c/d}var m,n,o=d(k[a]);e.bind(j,{start:function(a){m=a,n=!0},cancel:function(){n=!1},end:function(a,b){l(a)&&i.$apply(function(){j.triggerHandler(c),o(i,{$event:b})})}})}}])}var d=b.module("ngTouch",[]);d.factory("$swipe",[function(){function a(a){var b=a.touches&&a.touches.length?a.touches:[a],c=a.changedTouches&&a.changedTouches[0]||a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]||b[0].originalEvent||b[0];return{x:c.clientX,y:c.clientY}}var b=10;return{bind:function(c,d){var e,f,g,h,i=!1;c.on("touchstart mousedown",function(b){g=a(b),i=!0,e=0,f=0,h=g,d.start&&d.start(g,b)}),c.on("touchcancel",function(a){i=!1,d.cancel&&d.cancel(a)}),c.on("touchmove mousemove",function(c){if(i&&g){var j=a(c);if(e+=Math.abs(j.x-h.x),f+=Math.abs(j.y-h.y),h=j,!(b>e&&b>f))return f>e?(i=!1,d.cancel&&d.cancel(c),void 0):(c.preventDefault(),d.move&&d.move(j,c),void 0)}}),c.on("touchend mouseup",function(b){i&&(i=!1,d.end&&d.end(a(b),b))})}}}]),d.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){return a.shift(),a}])}]),d.directive("ngClick",["$parse","$timeout","$rootElement",function(a,c,d){function e(a,b,c,d){return Math.abs(a-c)<o&&Math.abs(b-d)<o}function f(a,b,c){for(var d=0;d<a.length;d+=2)if(e(a[d],a[d+1],b,c))return a.splice(d,d+2),!0;return!1}function g(a){if(!(Date.now()-j>n)){var b=a.touches&&a.touches.length?a.touches:[a],c=b[0].clientX,d=b[0].clientY;1>c&&1>d||f(k,c,d)||(a.stopPropagation(),a.preventDefault(),a.target&&a.target.blur())}}function h(a){var b=a.touches&&a.touches.length?a.touches:[a],d=b[0].clientX,e=b[0].clientY;k.push(d,e),c(function(){for(var a=0;a<k.length;a+=2)if(k[a]==d&&k[a+1]==e)return k.splice(a,a+2),void 0},n,!1)}function i(a,b){k||(d[0].addEventListener("click",g,!0),d[0].addEventListener("touchstart",h,!0),k=[]),j=Date.now(),f(k,a,b)}var j,k,l=750,m=12,n=2500,o=25,p="ng-click-active";return function(c,d,e){function f(){o=!1,d.removeClass(p)}var g,h,j,k,n=a(e.ngClick),o=!1;d.on("touchstart",function(a){o=!0,g=a.target?a.target:a.srcElement,3==g.nodeType&&(g=g.parentNode),d.addClass(p),h=Date.now();var b=a.touches&&a.touches.length?a.touches:[a],c=b[0].originalEvent||b[0];j=c.clientX,k=c.clientY}),d.on("touchmove",function(){f()}),d.on("touchcancel",function(){f()}),d.on("touchend",function(a){var c=Date.now()-h,n=a.changedTouches&&a.changedTouches.length?a.changedTouches:a.touches&&a.touches.length?a.touches:[a],p=n[0].originalEvent||n[0],q=p.clientX,r=p.clientY,s=Math.sqrt(Math.pow(q-j,2)+Math.pow(r-k,2));o&&l>c&&m>s&&(i(q,r),g&&g.blur(),b.isDefined(e.disabled)&&e.disabled!==!1||d.triggerHandler("click",[a])),f()}),d.onclick=function(){},d.on("click",function(a,b){c.$apply(function(){n(c,{$event:b||a})})}),d.on("mousedown",function(){d.addClass(p)}),d.on("mousemove mouseup",function(){d.removeClass(p)})}}]),c("ngSwipeLeft",-1,"swipeleft"),c("ngSwipeRight",1,"swiperight")}(window,window.angular),function(){function a(a){return["$rootScope","$window",function(b,c){for(var d,e,f,g=c[a]||(console.warn("This browser does not support Web Storage!"),{}),h={$default:function(a){for(var b in a)angular.isDefined(h[b])||(h[b]=a[b]);return h},$reset:function(a){for(var b in h)"$"===b[0]||delete h[b];return h.$default(a)}},i=0;i<g.length;i++)(f=g.key(i))&&"ngStorage-"===f.slice(0,10)&&(h[f.slice(10)]=angular.fromJson(g.getItem(f)));return d=angular.copy(h),b.$watch(function(){e||(e=setTimeout(function(){if(e=null,!angular.equals(h,d)){angular.forEach(h,function(a,b){angular.isDefined(a)&&"$"!==b[0]&&g.setItem("ngStorage-"+b,angular.toJson(a)),delete d[b]});for(var a in d)g.removeItem("ngStorage-"+a);d=angular.copy(h)}},100))}),"localStorage"===a&&c.addEventListener&&c.addEventListener("storage",function(a){"ngStorage-"===a.key.slice(0,10)&&(a.newValue?h[a.key.slice(10)]=angular.fromJson(a.newValue):delete h[a.key.slice(10)],d=angular.copy(h),b.$apply())}),h}]}angular.module("ngStorage",[]).factory("$localStorage",a("localStorage")).factory("$sessionStorage",a("sessionStorage"))}(),function(a,b){function c(b){b=b.split(".");for(var c=a,d=null,e=0;e<b.length-1;e++)c[b[e]]||(c[b[e]]={}),d=c=c[b[e]];return d}function d(b,c){for(var d=b.split("."),e=a,f=0;f<d.length-1;f++){if(!e[d[f]])return console.log("    Error assigning value to namespace :"+b+". '"+d[f]+"' does not exist."),null;e=e[d[f]]}return e[d[d.length-1]]=c,e[d[d.length-1]]}String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},Function.prototype.bind=Function.prototype.bind||function(){var a=this,b=Array.prototype.slice.call(arguments),c=b.shift();return function(){return a.apply(c,b.concat(Array.prototype.slice.call(arguments)))}},a.isArray=function(a){return"object"==typeof a&&a instanceof Array},a.isString=function(a){return"string"==typeof a},a.isFunction=function(a){return"function"==typeof a};var e=!1,f=function(){};f.__CLASS="Class",f.extend=function(a,b,g,h,i){function j(){!e&&this.__init&&this.__init.apply(this,arguments)}var k=this.prototype;e=!0;var l=new this;if(e=!1,j.prototype=l,j.prototype.constructor=j,j.superclass=k,j.extend=f.extend,d(g,j),b){b=isFunction(b)?b():b;for(var m in b)b.hasOwnProperty(m)&&(j[m]=b[m])}if(j.__CLASS=g,h)for(isArray(h)||(h=[h]),g=0;g<h.length;g++){c(h[g]);var n=d(h[g],j);if(b)for(m in b)b.hasOwnProperty(m)&&(n[m]=b[m])}a=isFunction(a)?a():a;for(var o in a)l[o]=("__init"===o||i&&i.decorated)&&isFunction(a[o])&&isFunction(k[o])?function(a,b){return function(){var c=this.__super;this.__super=k[a];var d=b.apply(this,arguments);return this.__super=c,d}}(o,a[o]):a[o];return j};var g=function(a){return this.name=a.defines,this.extendWith=a.extendsWith,this.callback=a.onCreate,this.callbackPreCreation=a.onPreCreate,this.dependencies=a.depends,this.baseClass=a.extendsClass,this.aliases=a.aliases,this.constants=a.constants,this.decorated=a.decorated,this.children=[],this};g.prototype={children:null,name:null,extendWith:null,callback:null,dependencies:null,baseClass:null,aliases:null,constants:null,decorated:!1,solved:!1,visited:!1,status:function(){console.log("  Module: "+this.name+(this.dependencies.length?" unsolved_deps:["+this.dependencies+"]":" no dependencies.")+(this.solved?" solved":" ------> NOT solved."))},removeDependency:function(a){for(var b=0;b<this.dependencies.length;b++)if(this.dependencies[b]===a){this.dependencies.splice(b,1);break}},assignDependency:function(a){var b;for(b=0;b<this.dependencies.length;b++)if(this.dependencies[b]===a.name){this.children.push(a),this.dependencies.splice(b,1);break}},isSolved:function(){return this.solved},solveDeep:function(){if(this.visited)return!0;if(this.visited=!0,this.solved)return!0;if(0!==this.dependencies.length)return!1;for(var a=0;a<this.children.length;a++)if(!this.children[a].solveDeep())return!1;return this.__initModule(),this.solved=!0,j.solved(this),!0},__initModule:function(){var b=null;if(this.baseClass){a:{for(var b=this.baseClass.split("."),c=a,d=0;d<b.length;d++){if(!c[b[d]]){b=null;break a}c=c[b[d]]}b=c}if(!b)return console.log("  "+this.name+" -> Can't extend non-existant class: "+this.baseClass),void 0}else b=f;b.extend(this.extendWith,this.constants,this.name,this.aliases,{decorated:this.decorated}),console.log("Created module: "+this.name),this.callback&&this.callback()}};var h=function(a,b){return this.path=a,this.module=b,this};h.prototype={path:null,processed:!1,module:null,setProcessed:function(){this.processed=!0},isProcessed:function(){return this.processed}};var i=function(){return this.nodes=[],this.loadedFiles=[],this.path={},this.solveListener=[],this.orderedSolvedModules=[],this.readyListener=[],this};i.baseURL="",i.modulePath={},i.sortedModulePath=[],i.symbol={},i.prototype={nodes:null,loadedFiles:null,solveListener:null,readyListener:null,orderedSolvedModules:null,addSolvedListener:function(a,b){this.solveListener.push({name:a,callback:b})},solved:function(a){var b;for(b=0;b<this.solveListener.length;b++)this.solveListener[b].name===a.name&&this.solveListener[b].callback();this.orderedSolvedModules.push(a),this.notifyReady()},notifyReady:function(){var a;for(a=0;a<this.nodes.length;a++)if(!this.nodes[a].isSolved())return;for(a=0;a<this.loadedFiles.length;a++)if(!this.loadedFiles[a].isProcessed())return;var b=Array.prototype.slice.call(this.readyListener);setTimeout(function(){for(var a=0;a<b.length;a++)b[a]()},0),this.readyListener=[]},status:function(){for(var a=0;a<this.nodes.length;a++)this.nodes[a].status()},module:function(a){var b,c;if(this.isModuleScheduledToSolve(a.defines))return this;if(a.onPreCreate)try{a.onPreCreate()}catch(d){console.log("  -> catched "+d+" on module "+a.defines+" preCreation.")}for(a.depends||(a.depends=[]),(b=a.depends)&&!isArray(b)&&(b=[b],a.depends=b),c=0;c<b.length;)this.alreadySolved(b[c])?b.splice(c,1):c++;for(b=new g(a),c=0;c<this.nodes.length;c++)this.nodes[c].assignDependency(b);for(this.nodes.push(b),c=0;c<a.depends.length;)if(this.isModuleScheduledToSolve(a.depends[c])){var e=this.findNode(a.depends[c]);null!==e?b.assignDependency(e):(alert("Module loaded and does not exist in loaded modules nodes. "+a.depends[c]),c++)}else c+=1;return function(a,b){setTimeout(function(){for(c=0;c<b.depends.length;c++)a.loadFile(b.depends[c])},0)}(this,a),this},findNode:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a)return this.nodes[b];return null},alreadySolved:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a&&this.nodes[b].isSolved())return!0;return!1},exists:function(b){b=b.split(".");for(var c=a,d=0;d<b.length;d++){if(!c[b[d]])return!1;c=c[b[d]]}return!0},loadFile:function(a){if(!this.exists(a)){for(var b=this.getPath(a),c=0;c<this.loadedFiles.length;c++)if(this.loadedFiles[c].path===b)return;c=new h(b,a),this.loadedFiles.push(c),c=document.createElement("script"),c.type="text/javascript",c.charset="utf-8",c.async=!0,c.addEventListener("load",this.moduleLoaded.bind(this),!1),c.addEventListener("error",this.moduleErrored.bind(this),!1),c.setAttribute("module-name",a),c.src=b+(k?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(c)}},getPath:function(a){if(a.endsWith(".js"))return a="/"!==a.charAt(0)?i.baseURL+a:a.substring(1);var b,c;for(c in i.symbol)if(a===c)return i.baseURL+i.symbol[c];for(b=0;b<i.sortedModulePath.length;b++){var d=i.sortedModulePath[b];if(i.modulePath.hasOwnProperty(d)&&(c=i.modulePath[d],0===a.indexOf(d)))return a=a.substring(d.length+1),a=a.replace(/\./g,"/"),a=c+a+".js",i.baseURL+a}return i.baseURL+a.replace(/\./g,"/")+".js"},isModuleScheduledToSolve:function(a){for(var b=0;b<this.nodes.length;b++)if(this.nodes[b].name===a)return!0;return!1},moduleLoaded:function(a){if("load"===a.type){var b=(a.currentTarget||a.srcElement||a.target).getAttribute("module-name");for(a=0;a<this.loadedFiles.length;a++)if(this.loadedFiles[a].module===b){this.loadedFiles[a].setProcessed();break}for(a=0;a<this.nodes.length;a++)this.nodes[a].removeDependency(b);for(a=0;a<this.nodes.length;a++){for(b=0;b<this.nodes.length;b++)this.nodes[b].visited=!1;this.nodes[a].solveDeep()}var c=this;setTimeout(function(){c.notifyReady()},0)}},moduleErrored:function(a){console.log("Error loading module: "+(a.currentTarget||a.srcElement).getAttribute("module-name"))},solvedInOrder:function(){for(var a=0;a<this.orderedSolvedModules.length;a++)console.log(this.orderedSolvedModules[a].name)},solveAll:function(){for(var a=0;a<this.nodes.length;a++)this.nodes[a].solveDeep()},onReady:function(a){this.readyListener.push(a)}};var j=new i,k=!1;"undefined"==typeof b&&(b=window.CAAT=window.CAAT||{}),NS=b,NS.Module=function(a){a.defines?(c(a.defines),j.module(a)):console.error("Bad module definition: "+a)},NS.ModuleManager={},NS.ModuleManager.baseURL=function(a){return a?(a.endsWith("/")||(a+="/"),i.baseURL=a,NS.ModuleManager):NS.Module},NS.ModuleManager.setModulePath=function(a,b){return b.endsWith("/")||(b+="/"),i.modulePath[a]||(i.modulePath[a]=b,i.sortedModulePath.push(a),i.sortedModulePath.sort(function(a,b){return a==b?0:b>a?1:-1})),NS.ModuleManager},NS.ModuleManager.symbol=function(a,b){return i.symbol[a]||(i.symbol[a]=b),NS.ModuleManager},NS.ModuleManager.bring=function(a){isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)j.loadFile(a[b]);return NS.ModuleManager},NS.ModuleManager.status=function(){j.status()},NS.ModuleManager.addModuleSolvedListener=function(a,b){return j.addSolveListener(a,b),NS.ModuleManager},NS.ModuleManager.load=function(a,b,c){var d=document.createElement("script");d.type="text/javascript",d.charset="utf-8",d.async=!0,b&&d.addEventListener("load",b,!1),c&&d.addEventListener("error",c,!1),d.addEventListener("load",function(){j.solveAll()},!1),d.src=a+(k?"":"?"+(new Date).getTime()),document.getElementsByTagName("head")[0].appendChild(d)},NS.ModuleManager.solvedInOrder=function(){j.solvedInOrder()},NS.ModuleManager.onReady=function(a){return j.onReady(a),NS.ModuleManager},NS.ModuleManager.solveAll=function(){j.solveAll()},NS.ModuleManager.debug=function(a){return k=a,NS.ModuleManager},NS.Class=f}(this,void 0),CAAT.Module({defines:"CAAT.Core.Constants",depends:["CAAT.Math.Matrix"],extendsWith:function(){return CAAT.CLAMP=!1,CAAT.setCoordinateClamping=function(a){CAAT.CLAMP=a,CAAT.Math.Matrix.setCoordinateClamping(a)},CAAT.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},CAAT.CSS_TEXT_METRICS=0,CAAT.GLRENDER=!1,CAAT.DEBUG=!1,CAAT.DEBUGBB=!1,CAAT.DEBUGBBBCOLOR="#00f",CAAT.DEBUGAABB=!1,CAAT.DEBUGAABBCOLOR="#f00",CAAT.DEBUG_DIRTYRECTS=!1,CAAT.DRAG_THRESHOLD_X=5,CAAT.DRAG_THRESHOLD_Y=5,CAAT.CACHE_SCENE_ON_CHANGE=!0,{}}}),extend=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.superclass=b.prototype,a.prototype.constructor=a,b.prototype.constructor===Object.prototype.constructor&&(b.prototype.constructor=b);for(var e in c)c.hasOwnProperty(e)&&(a.prototype[e]=c[e])},extendWith=function(a,b,c){var d=function(){};if(d.prototype=a.prototype,b.prototype=new d,b.superclass=a.prototype,b.prototype.constructor=b,a.prototype.constructor===Object.prototype.constructor&&(a.prototype.constructor=a),c)for(var e in c)c.hasOwnProperty(e)&&(b.prototype[e]=c[e])},CAAT.Module({defines:"CAAT.Core.Class",extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Math.Bezier",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.Bezier"],extendsWith:function(){return{cubic:!1,applyAsPath:function(a){var b=this.coordlist;return this.cubic?a.ctx.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y):a.ctx.quadraticCurveTo(b[1].x,b[1].y,b[2].x,b[2].y),this},isQuadric:function(){return!this.cubic},isCubic:function(){return this.cubic},setCubic:function(a,b,c,d,e,f,g,h){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(a,b)),this.coordlist.push((new CAAT.Math.Point).set(c,d)),this.coordlist.push((new CAAT.Math.Point).set(e,f)),this.coordlist.push((new CAAT.Math.Point).set(g,h)),this.cubic=!0,this.update(),this},setQuadric:function(a,b,c,d,e,f){return this.coordlist=[],this.coordlist.push((new CAAT.Math.Point).set(a,b)),this.coordlist.push((new CAAT.Math.Point).set(c,d)),this.coordlist.push((new CAAT.Math.Point).set(e,f)),this.cubic=!1,this.update(),this},setPoints:function(a){if(3===a.length)this.coordlist=a,this.cubic=!1,this.update();else{if(4!==a.length)throw"points must be an array of 3 or 4 CAAT.Point instances.";this.coordlist=a,this.cubic=!0,this.update()}return this},paint:function(a){this.cubic?this.paintCubic(a):this.paintCuadric(a),CAAT.Math.Bezier.superclass.paint.call(this,a)},paintCuadric:function(a){var b,c;for(b=this.coordlist[0].x,c=this.coordlist[0].y,a=a.ctx,a.save(),a.beginPath(),a.moveTo(b,c),b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,b.y);
a.stroke(),a.restore()},paintCubic:function(a){var b,c;for(b=this.coordlist[0].x,c=this.coordlist[0].y,a=a.ctx,a.save(),a.beginPath(),a.moveTo(b,c),b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,b.y);a.stroke(),a.restore()},solve:function(a,b){return this.cubic?this.solveCubic(a,b):this.solveQuadric(a,b)},solveCubic:function(a,b){var c=b*b,d=b*c,e=this.coordlist,f=e[0],g=e[1],h=e[2],e=e[3];return a.x=f.x+b*(3*-f.x+b*(3*f.x-f.x*b))+b*(3*g.x+b*(-6*g.x+3*g.x*b))+c*(3*h.x-3*h.x*b)+e.x*d,a.y=f.y+b*(3*-f.y+b*(3*f.y-f.y*b))+b*(3*g.y+b*(-6*g.y+3*g.y*b))+c*(3*h.y-3*h.y*b)+e.y*d,a},solveQuadric:function(a,b){var c=this.coordlist,d=c[0],e=c[1],c=c[2],f=1-b;return a.x=f*f*d.x+2*f*b*e.x+b*b*c.x,a.y=f*f*d.y+2*f*b*e.y+b*b*c.y,a}}}}),CAAT.Module({defines:"CAAT.Math.CatmullRom",depends:["CAAT.Math.Curve"],extendsClass:"CAAT.Math.Curve",aliases:["CAAT.CatmullRom"],extendsWith:function(){return{setCurve:function(a,b,c,d){return this.coordlist=[],this.coordlist.push(a),this.coordlist.push(b),this.coordlist.push(c),this.coordlist.push(d),this.update(),this},paint:function(a){var b,c;b=this.coordlist[1].x,c=this.coordlist[1].y;var d=a.ctx;for(d.save(),d.beginPath(),d.moveTo(b,c),b=new CAAT.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),d.lineTo(b.x,b.y);d.stroke(),d.restore(),CAAT.Math.CatmullRom.superclass.paint.call(this,a)},solve:function(a,b){var c=this.coordlist,d=((-b+2)*b-1)*b*.5,e=.5*((3*b-5)*b*b+2),f=((-3*b+4)*b+1)*b*.5,g=(b-1)*b*b*.5;return a.x=c[0].x*d+c[1].x*e+c[2].x*f+c[3].x*g,a.y=c[0].y*d+c[1].y*e+c[2].y*f+c[3].y*g,a},applyAsPath:function(a){a=a.ctx;for(var b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.lineTo(b.x,b.y);return this},endCurvePosition:function(){return this.coordlist[this.coordlist.length-2]},startCurvePosition:function(){return this.coordlist[1]}}}}),CAAT.Module({defines:"CAAT.Math.Curve",depends:["CAAT.Math.Point"],extendsWith:function(){return{coordlist:null,k:.05,length:-1,HANDLE_SIZE:20,drawHandles:!0,paint:function(a){if(!1!==this.drawHandles){var b=this.coordlist;a=a.ctx,a.save(),a.beginPath(),a.strokeStyle="#a0a0a0",a.moveTo(b[0].x,b[0].y),a.lineTo(b[1].x,b[1].y),a.stroke(),this.cubic&&(a.moveTo(b[2].x,b[2].y),a.lineTo(b[3].x,b[3].y),a.stroke()),a.globalAlpha=.5;for(var c=0;c<this.coordlist.length;c++){a.fillStyle="#7f7f00";var d=this.HANDLE_SIZE/2;a.beginPath(),a.arc(b[c].x,b[c].y,d,0,2*Math.PI,!1),a.fill()}a.restore()}},update:function(){this.calcLength()},solve:function(){},getContour:function(a){var b,c=[];for(b=0;a>=b;b++){var d=new CAAT.Math.Point;this.solve(d,b/a),c.push(d)}return c},getBoundingBox:function(a){a||(a=new CAAT.Math.Rectangle),a.setEmpty(),a.union(this.coordlist[0].x,this.coordlist[0].y);for(var b=new CAAT.Math.Point,c=this.k;c<=1+this.k;c+=this.k)this.solve(b,c),a.union(b.x,b.y);return a},calcLength:function(){var a,b;a=this.coordlist[0].x,b=this.coordlist[0].y;for(var c=0,d=new CAAT.Math.Point,e=this.k;e<=1+this.k;e+=this.k)this.solve(d,e),c+=Math.sqrt((d.x-a)*(d.x-a)+(d.y-b)*(d.y-b)),a=d.x,b=d.y;return this.length=c},getLength:function(){return this.length},endCurvePosition:function(){return this.coordlist[this.coordlist.length-1]},startCurvePosition:function(){return this.coordlist[0]},setPoints:function(){},setPoint:function(a,b){b>=0&&b<this.coordlist.length&&(this.coordlist[b]=a)},applyAsPath:function(){}}}}),CAAT.Module({defines:"CAAT.Math.Dimension",aliases:["CAAT.Dimension"],extendsWith:function(){return{width:0,height:0,__init:function(a,b){return this.width=a,this.height=b,this}}}}),CAAT.Module({defines:"CAAT.Math.Matrix",depends:["CAAT.Math.Point"],aliases:["CAAT.Matrix"],onCreate:function(){CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Math.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Math.Matrix.prototype.transformRenderingContextSet_NoClamp},constants:{setCoordinateClamping:function(a){a?(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_Clamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_Clamp):(CAAT.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContext=CAAT.Matrix.prototype.transformRenderingContext_NoClamp,CAAT.Math.Matrix.prototype.transformRenderingContextSet=CAAT.Matrix.prototype.transformRenderingContextSet_NoClamp)},scale:function(a,b){var c=new CAAT.Math.Matrix;return c.matrix[0]=a,c.matrix[4]=b,c},rotate:function(a){var b=new CAAT.Math.Matrix;return b.setRotation(a),b},translate:function(a,b){var c=new CAAT.Math.Matrix;return c.matrix[2]=a,c.matrix[5]=b,c}},extendsWith:function(){return{matrix:null,__init:function(){return this.matrix=[1,0,0,0,1,0,0,0,1],"undefined"!=typeof Float32Array&&(this.matrix=new Float32Array(this.matrix)),this},transformCoord:function(a){var b=a.x,c=a.y,d=this.matrix;return a.x=b*d[0]+c*d[1]+d[2],a.y=b*d[3]+c*d[4]+d[5],a},setRotation:function(a){this.identity();var b=this.matrix,c=Math.cos(a);return a=Math.sin(a),b[0]=c,b[1]=-a,b[3]=a,b[4]=c,this},setScale:function(a,b){return this.identity(),this.matrix[0]=a,this.matrix[4]=b,this},setTranslate:function(a,b){return this.identity(),this.matrix[2]=a,this.matrix[5]=b,this},copy:function(a){a=a.matrix;var b=this.matrix;return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],this},identity:function(){var a=this.matrix;return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,this},multiply:function(a){var b=this.matrix,c=a.matrix;a=b[0];var d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=c[0],m=c[1],n=c[2],o=c[3],p=c[4],q=c[5],r=c[6],s=c[7],c=c[8];return b[0]=a*l+d*o+e*r,b[1]=a*m+d*p+e*s,b[2]=a*n+d*q+e*c,b[3]=f*l+g*o+h*r,b[4]=f*m+g*p+h*s,b[5]=f*n+g*q+h*c,b[6]=i*l+j*o+k*r,b[7]=i*m+j*p+k*s,b[8]=i*n+j*q+k*c,this},premultiply:function(a){var b=a.matrix[0]*this.matrix[1]+a.matrix[1]*this.matrix[4]+a.matrix[2]*this.matrix[7],c=a.matrix[0]*this.matrix[2]+a.matrix[1]*this.matrix[5]+a.matrix[2]*this.matrix[8],d=a.matrix[3]*this.matrix[0]+a.matrix[4]*this.matrix[3]+a.matrix[5]*this.matrix[6],e=a.matrix[3]*this.matrix[1]+a.matrix[4]*this.matrix[4]+a.matrix[5]*this.matrix[7],f=a.matrix[3]*this.matrix[2]+a.matrix[4]*this.matrix[5]+a.matrix[5]*this.matrix[8],g=a.matrix[6]*this.matrix[0]+a.matrix[7]*this.matrix[3]+a.matrix[8]*this.matrix[6],h=a.matrix[6]*this.matrix[1]+a.matrix[7]*this.matrix[4]+a.matrix[8]*this.matrix[7],i=a.matrix[6]*this.matrix[2]+a.matrix[7]*this.matrix[5]+a.matrix[8]*this.matrix[8];return this.matrix[0]=a.matrix[0]*this.matrix[0]+a.matrix[1]*this.matrix[3]+a.matrix[2]*this.matrix[6],this.matrix[1]=b,this.matrix[2]=c,this.matrix[3]=d,this.matrix[4]=e,this.matrix[5]=f,this.matrix[6]=g,this.matrix[7]=h,this.matrix[8]=i,this},getInverse:function(){var a=this.matrix,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],a=a[8],j=new CAAT.Math.Matrix,k=b*(f*a-i*g)-e*(c*a-i*d)+h*(c*g-f*d);if(0===k)return null;var l=j.matrix;return l[0]=f*a-g*i,l[1]=d*i-c*a,l[2]=c*g-d*f,l[3]=g*h-e*a,l[4]=b*a-d*h,l[5]=d*e-b*g,l[6]=e*i-f*h,l[7]=c*h-b*i,l[8]=b*f-c*e,j.multiplyScalar(1/k),j},multiplyScalar:function(a){var b;for(b=0;9>b;b++)this.matrix[b]*=a;return this},transformRenderingContextSet_NoClamp:function(a){var b=this.matrix;return a.setTransform(b[0],b[3],b[1],b[4],b[2],b[5]),this},transformRenderingContext_NoClamp:function(a){var b=this.matrix;return a.transform(b[0],b[3],b[1],b[4],b[2],b[5]),this},transformRenderingContextSet_Clamp:function(a){var b=this.matrix;return a.setTransform(b[0],b[3],b[1],b[4],b[2]>>0,b[5]>>0),this},transformRenderingContext_Clamp:function(a){var b=this.matrix;return a.transform(b[0],b[3],b[1],b[4],b[2]>>0,b[5]>>0),this},setModelViewMatrix:function(a,b,c,d,e){var f,g,h,i,j,k;k=this.matrix,d=1,j=g=0,i=1,c=Math.cos(e),e=Math.sin(e),f=d,h=j,d=(f*c+g*e)*this.scaleX,g=(-f*e+g*c)*this.scaleY,j=(h*c+i*e)*this.scaleX,i=(-h*e+i*c)*this.scaleY,k[0]=d,k[1]=g,k[2]=a,k[3]=j,k[4]=i,k[5]=b}}}}),CAAT.Module({defines:"CAAT.Math.Matrix3",aliases:["CAAT.Matrix3"],extendsWith:function(){return{matrix:null,fmatrix:null,__init:function(){return this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this.fmatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},transformCoord:function(a){var b=a.x,c=a.y,d=a.z;return a.x=b*this.matrix[0][0]+c*this.matrix[0][1]+d*this.matrix[0][2]+this.matrix[0][3],a.y=b*this.matrix[1][0]+c*this.matrix[1][1]+d*this.matrix[1][2]+this.matrix[1][3],a.z=b*this.matrix[2][0]+c*this.matrix[2][1]+d*this.matrix[2][2]+this.matrix[2][3],a},initialize:function(a,b,c,d,e,f,g,h,i){return this.identity(),this.matrix[0][0]=a,this.matrix[0][1]=b,this.matrix[0][2]=c,this.matrix[1][0]=d,this.matrix[1][1]=e,this.matrix[1][2]=f,this.matrix[2][0]=g,this.matrix[2][1]=h,this.matrix[2][2]=i,this},initWithMatrix:function(a){return this.matrix=a,this},flatten:function(){var a=this.fmatrix,b=this.matrix;return a[0]=b[0][0],a[1]=b[1][0],a[2]=b[2][0],a[3]=b[3][0],a[4]=b[0][1],a[5]=b[1][1],a[6]=b[2][1],a[7]=b[2][1],a[8]=b[0][2],a[9]=b[1][2],a[10]=b[2][2],a[11]=b[3][2],a[12]=b[0][3],a[13]=b[1][3],a[14]=b[2][3],a[15]=b[3][3],this.fmatrix},identity:function(){for(var a=0;4>a;a++)for(var b=0;4>b;b++)this.matrix[a][b]=a===b?1:0;return this},getMatrix:function(){return this.matrix},rotateXY:function(a){return this.rotate(a,0,0)},rotateXZ:function(a){return this.rotate(0,a,0)},rotateYZ:function(a){return this.rotate(0,0,a)},setRotate:function(a,b,c){return a=this.rotate(a,b,c),this.copy(a),this},rotate:function(a,b,c){var d,e,f=new CAAT.Math.Matrix3;return 0!==a&&(e=new CAAT.Math.Math.Matrix3,d=Math.sin(a),a=Math.cos(a),e.matrix[1][1]=a,e.matrix[1][2]=-d,e.matrix[2][1]=d,e.matrix[2][2]=a,f.multiply(e)),0!==b&&(e=new CAAT.Math.Matrix3,d=Math.sin(b),a=Math.cos(b),e.matrix[0][0]=a,e.matrix[0][2]=-d,e.matrix[2][0]=d,e.matrix[2][2]=a,f.multiply(e)),0!==c&&(e=new CAAT.Math.Matrix3,d=Math.sin(c),a=Math.cos(c),e.matrix[0][0]=a,e.matrix[0][1]=-d,e.matrix[1][0]=d,e.matrix[1][1]=a,f.multiply(e)),f},getClone:function(){var a=new CAAT.Math.Matrix3;return a.copy(this),a},multiply:function(a){var b=this.getClone().matrix,c=b[0][0],d=b[0][1],e=b[0][2],f=b[0][3],g=b[1][0],h=b[1][1],i=b[1][2],j=b[1][3],k=b[2][0],l=b[2][1],m=b[2][2],b=b[2][3],n=a.matrix;a=n[0][0];var o=n[0][1],p=n[0][2],q=n[0][3],r=n[1][0],s=n[1][1],t=n[1][2],u=n[1][3],v=n[2][0],w=n[2][1],x=n[2][2],y=n[2][3],z=n[3][0],A=n[3][1],B=n[3][2],n=n[3][3];return this.matrix[0][0]=c*a+d*r+e*v+f*z,this.matrix[0][1]=c*o+d*s+e*w+f*A,this.matrix[0][2]=c*p+d*t+e*x+f*B,this.matrix[0][3]=c*q+d*u+e*y+f*n,this.matrix[1][0]=g*a+h*r+i*v+j*z,this.matrix[1][1]=g*o+h*s+i*w+j*A,this.matrix[1][2]=g*p+h*t+i*x+j*B,this.matrix[1][3]=g*q+h*u+i*y+j*n,this.matrix[2][0]=k*a+l*r+m*v+b*z,this.matrix[2][1]=k*o+l*s+m*w+b*A,this.matrix[2][2]=k*p+l*t+m*x+b*B,this.matrix[2][3]=k*q+l*u+m*y+b*n,this},premultiply:function(a){var b=this.getClone().matrix,c=b[0][0],d=b[0][1],e=b[0][2],f=b[0][3],g=b[1][0],h=b[1][1],i=b[1][2],j=b[1][3],k=b[2][0],l=b[2][1],m=b[2][2],b=b[2][3],n=a.matrix;a=n[0][0];var o=n[0][1],p=n[0][2],q=n[0][3],r=n[1][0],s=n[1][1],t=n[1][2],u=n[1][3],v=n[2][0],w=n[2][1],x=n[2][2],n=n[2][3];return this.matrix[0][0]=c*a+d*r+e*v,this.matrix[0][1]=c*o+d*s+e*w,this.matrix[0][2]=c*p+d*t+e*x,this.matrix[0][3]=c*q+d*u+e*n+f,this.matrix[1][0]=g*a+h*r+i*v,this.matrix[1][1]=g*o+h*s+i*w,this.matrix[1][2]=g*p+h*t+i*x,this.matrix[1][3]=g*q+h*u+i*n+j,this.matrix[2][0]=k*a+l*r+m*v,this.matrix[2][1]=k*o+l*s+m*w,this.matrix[2][2]=k*p+l*t+m*x,this.matrix[2][3]=k*q+l*u+m*n+b,this},setTranslate:function(a,b,c){return this.identity(),this.matrix[0][3]=a,this.matrix[1][3]=b,this.matrix[2][3]=c,this},translate:function(a,b,c){var d=new CAAT.Math.Matrix3;return d.setTranslate(a,b,c),d},setScale:function(a,b,c){return this.identity(),this.matrix[0][0]=a,this.matrix[1][1]=b,this.matrix[2][2]=c,this},scale:function(a,b,c){var d=new CAAT.Math.Matrix3;return d.setScale(a,b,c),d},rotateModelView:function(a,b,c){var d=Math.sin(a),e=Math.sin(b),f=Math.sin(c);return a=Math.cos(a),b=Math.cos(b),c=Math.cos(c),this.matrix[0][0]=b*a,this.matrix[0][1]=-b*d,this.matrix[0][2]=e,this.matrix[0][3]=0,this.matrix[1][0]=f*e*a+d*c,this.matrix[1][1]=c*a-f*e*d,this.matrix[1][2]=-f*b,this.matrix[1][3]=0,this.matrix[2][0]=f*d-c*e*a,this.matrix[2][1]=c*e*d+f*a,this.matrix[2][2]=c*b,this.matrix[2][3]=0,this.matrix[3][0]=0,this.matrix[3][1]=0,this.matrix[3][2]=0,this.matrix[3][3]=1,this},copy:function(a){for(var b=0;4>b;b++)for(var c=0;4>c;c++)this.matrix[b][c]=a.matrix[b][c];return this},calculateDeterminant:function(){var a=this.matrix,b=a[0][0],c=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],l=a[2][2],m=a[2][3],n=a[3][0],o=a[3][1],p=a[3][2],a=a[3][3];return e*g*l*n+c*i*l*n+e*h*j*o+d*i*j*o+d*f*m*o+b*h*m*o+e*f*k*p+b*i*k*p+d*g*j*a+c*h*j*a+c*f*l*a+b*g*l*a+e*h*k*n-d*i*k*n-d*g*m*n-c*h*m*n-e*f*l*o-b*i*l*o-e*g*j*p-c*i*j*p-c*f*m*p-b*g*m*p-d*f*k*a-b*h*k*a},getInverse:function(){var a=this.matrix,b=a[0][0],c=a[0][1],d=a[0][2],e=a[0][3],f=a[1][0],g=a[1][1],h=a[1][2],i=a[1][3],j=a[2][0],k=a[2][1],l=a[2][2],m=a[2][3],n=a[3][0],o=a[3][1],p=a[3][2],a=a[3][3],q=new CAAT.Math.Matrix3;return q.matrix[0][0]=h*m*o+i*k*p+g*l*a-i*l*o-g*m*p-h*k*a,q.matrix[0][1]=e*l*o+c*m*p+d*k*a-c*l*a-d*m*o-e*k*p,q.matrix[0][2]=d*i*o+c*h*a+e*g*p-c*i*p-d*g*a-e*h*o,q.matrix[0][3]=e*h*k+c*i*l+d*g*m-d*i*k-e*g*l-c*h*m,q.matrix[1][0]=i*l*n+f*m*p+h*j*a-h*m*n-i*j*p-f*l*a,q.matrix[1][1]=d*m*n+e*j*p+b*l*a-e*l*n-b*m*p-d*j*a,q.matrix[1][2]=e*h*n+b*i*p+d*f*a-d*i*n-e*f*p-b*h*a,q.matrix[1][3]=d*i*j+e*f*l+b*h*m-e*h*j-b*i*l-d*f*m,q.matrix[2][0]=g*m*n+i*j*o+f*k*a-i*k*n-f*m*o-g*j*a,q.matrix[2][1]=e*k*n+b*m*o+c*j*a-b*k*a-c*m*n-e*j*o,q.matrix[2][2]=d*i*n+e*f*o+b*g*a-e*g*n-b*i*o-c*f*a,q.matrix[2][3]=e*g*j+b*i*k+c*f*m-b*g*m-c*i*j-e*f*k,q.matrix[3][0]=h*k*n+f*l*o+g*j*p-g*l*n-h*j*o-f*k*p,q.matrix[3][1]=c*l*n+d*j*o+b*k*p-d*k*n-b*l*o-c*j*p,q.matrix[3][2]=d*g*n+b*h*o+c*f*p-b*g*p-c*h*n-d*f*o,q.matrix[3][3]=c*h*j+d*f*k+b*g*l-d*g*j-b*h*k-c*f*l,q.multiplyScalar(1/this.calculateDeterminant())},multiplyScalar:function(a){var b,c;for(b=0;4>b;b++)for(c=0;4>c;c++)this.matrix[b][c]*=a;return this}}}}),CAAT.Module({defines:"CAAT.Math.Point",aliases:["CAAT.Point"],extendsWith:function(){return{x:0,y:0,z:0,__init:function(a,b,c){return this.x=a,this.y=b,this.z=c||0,this},set:function(a,b,c){return this.x=a,this.y=b,this.z=c||0,this},clone:function(){return new CAAT.Math.Point(this.x,this.y,this.z)},translate:function(a,b,c){return this.x+=a,this.y+=b,this.z+=c,this},translatePoint:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},subtract:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},multiply:function(a){return this.x*=a,this.y*=a,this.z*=a,this},rotate:function(a){var b=this.x,c=this.y;return this.x=b*Math.cos(a)-Math.sin(a)*c,this.y=b*Math.sin(a)+Math.cos(a)*c,this.z=0,this},setAngle:function(a){var b=this.getLength();return this.x=Math.cos(a)*b,this.y=Math.sin(a)*b,this.z=0,this},setLength:function(a){var b=this.getLength();return b?this.multiply(a/b):this.x=this.y=this.z=a,this},normalize:function(){var a=this.getLength();return this.x/=a,this.y/=a,this.z/=a,this},getAngle:function(){return Math.atan2(this.y,this.x)},limit:function(a){var b=this.getLengthSquared();return b+.01>a*a&&(b=Math.sqrt(b),this.x=this.x/b*a,this.y=this.y/b*a,this.z=this.z/b*a),this},getLength:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return.005>a&&a>-.005?1e-6:a},getLengthSquared:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;return.005>a&&a>-.005?0:a},getDistance:function(a){var b=this.x-a.x,c=this.y-a.y;return a=this.z-a.z,Math.sqrt(b*b+c*c+a*a)},getDistanceSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return a=this.z-a.z,b*b+c*c+a*a},toString:function(){return"(CAAT.Math.Point) x:"+String(Math.round(Math.floor(10*this.x))/10)+" y:"+String(Math.round(Math.floor(10*this.y))/10)+" z:"+String(Math.round(Math.floor(10*this.z))/10)}}}}),CAAT.Module({defines:"CAAT.Math.Rectangle",aliases:["CAAT.Rectangle"],extendsWith:function(){return{__init:function(a,b,c,d){4!==arguments.length?this.setEmpty():(this.setLocation(a,b),this.setDimension(c,d))},x:0,y:0,x1:0,y1:0,width:-1,height:-1,setEmpty:function(){return this.height=this.width=-1,this.y1=this.x1=this.y=this.x=0,this},setLocation:function(a,b){return this.x=a,this.y=b,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setDimension:function(a,b){return this.width=a,this.height=b,this.x1=this.x+this.width,this.y1=this.y+this.height,this},setBounds:function(a,b,c,d){return this.setLocation(a,b),this.setDimension(c,d),this},contains:function(a,b){return a>=this.x&&a<this.x1&&b>=this.y&&b<this.y1},isEmpty:function(){return-1===this.width&&-1===this.height},union:function(a,b){this.isEmpty()?(this.x1=this.x=a,this.y1=this.y=b,this.height=this.width=0):(this.x1=this.x+this.width,this.y1=this.y+this.height,b<this.y&&(this.y=b),a<this.x&&(this.x=a),b>this.y1&&(this.y1=b),a>this.x1&&(this.x1=a),this.width=this.x1-this.x,this.height=this.y1-this.y)},unionRectangle:function(a){return this.union(a.x,a.y),this.union(a.x1,a.y),this.union(a.x,a.y1),this.union(a.x1,a.y1),this},intersects:function(a){return a.isEmpty()||this.isEmpty()||a.x1<=this.x||a.x>=this.x1||a.y1<=this.y?!1:a.y<this.y1},intersectsRect:function(a,b,c,d){return-1===c||-1===d||a+c-1<this.x||a>this.x1||b+d-1<this.y?!1:b<=this.y1},intersect:function(a,b){return"undefined"==typeof b&&(b=new CAAT.Math.Rectangle),b.x=Math.max(this.x,a.x),b.y=Math.max(this.y,a.y),b.x1=Math.min(this.x1,a.x1),b.y1=Math.min(this.y1,a.y1),b.width=b.x1-b.x,b.height=b.y1-b.y,b}}}}),CAAT.Module({defines:"CAAT.Behavior.Interpolator",depends:["CAAT.Math.Point"],aliases:["CAAT.Interpolator"],constants:{enumerateInterpolators:function(){return[(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!1),"Linear pingpong=false, inverse=false",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!1),"Linear pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!1),"BackOut pingpong=true, inverse=false",(new CAAT.Behavior.Interpolator).createBackOutInterpolator(!0),"BackOut pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1,!0),"Linear pingpong=false, inverse=true",(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0,!0),"Linear pingpong=true, inverse=true",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!1),"ExponentialIn pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!1),"ExponentialOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!1),"ExponentialInOut pingpong=false, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(2,!0),"ExponentialIn pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2,!0),"ExponentialOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(2,!0),"ExponentialInOut pingpong=true, exponent=2",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!1),"ExponentialIn pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!1),"ExponentialOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!1),"ExponentialInOut pingpong=false, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(4,!0),"ExponentialIn pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4,!0),"ExponentialOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4,!0),"ExponentialInOut pingpong=true, exponent=4",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!1),"ExponentialIn pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!1),"ExponentialOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!1),"ExponentialInOut pingpong=false, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInInterpolator(6,!0),"ExponentialIn pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(6,!0),"ExponentialOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(6,!0),"ExponentialInOut pingpong=true, exponent=6",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!1),"BounceIn pingpong=false",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!1),"BounceOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!1),"BounceInOut pingpong=false",(new CAAT.Behavior.Interpolator).createBounceInInterpolator(!0),"BounceIn pingpong=true",(new CAAT.Behavior.Interpolator).createBounceOutInterpolator(!0),"BounceOut pingpong=true",(new CAAT.Behavior.Interpolator).createBounceInOutInterpolator(!0),"BounceInOut pingpong=true",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!1),"ElasticIn pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!1),"ElasticOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!1),"ElasticInOut pingpong=false, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1.1,.4,!0),"ElasticIn pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4,!0),"ElasticOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1.1,.4,!0),"ElasticInOut pingpong=true, amp=1.1, d=.4",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!1),"ElasticIn pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!1),"ElasticOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!1),"ElasticInOut pingpong=false, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInInterpolator(1,.2,!0),"ElasticIn pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1,.2,!0),"ElasticOut pingpong=true, amp=1.0, d=.2",(new CAAT.Behavior.Interpolator).createElasticInOutInterpolator(1,.2,!0),"ElasticInOut pingpong=true, amp=1.0, d=.2"]},parse:function(a){var b="create"+a.type+"Interpolator",c=new CAAT.Behavior.Interpolator;try{c[b].apply(c,a.params||[])}catch(d){c.createLinearInterpolator(!1,!1)}return c}},extendsWith:function(){return{interpolated:null,paintScale:90,__init:function(){return this.interpolated=new CAAT.Math.Point(0,0,0),this},createLinearInterpolator:function(a,b){return this.getPosition=function(c){var d=c;return a&&(c=.5>c?2*c:1-2*(c-.5)),null!==b&&b&&(c=1-c),this.interpolated.set(d,c)},this},createBackOutInterpolator:function(a){return this.getPosition=function(b){var c=b;return a&&(b=.5>b?2*b:1-2*(b-.5)),b-=1,this.interpolated.set(c,b*b*(2.70158*b+1.70158)+1)},this},createExponentialInInterpolator:function(a,b){return this.getPosition=function(c){var d=c;return b&&(c=.5>c?2*c:1-2*(c-.5)),this.interpolated.set(d,Math.pow(c,a))},this},createExponentialOutInterpolator:function(a,b){return this.getPosition=function(c){var d=c;return b&&(c=.5>c?2*c:1-2*(c-.5)),this.interpolated.set(d,1-Math.pow(1-c,a))},this},createExponentialInOutInterpolator:function(a,b){return this.getPosition=function(c){var d=c;return b&&(c=.5>c?2*c:1-2*(c-.5)),1>2*c?this.interpolated.set(d,Math.pow(2*c,a)/2):this.interpolated.set(d,1-Math.abs(Math.pow(2*c-2,a))/2)},this},createQuadricBezierInterpolator:function(a,b,c,d){return this.getPosition=function(e){var f=e;return d&&(e=.5>e?2*e:1-2*(e-.5)),e=(1-e)*(1-e)*a.y+2*(1-e)*e*b.y+e*e*c.y,this.interpolated.set(f,e)},this},createCubicBezierInterpolator:function(a,b,c,d,e){return this.getPosition=function(f){var g=f;e&&(f=.5>f?2*f:1-2*(f-.5));var h=f*f;return f=a.y+f*(3*-a.y+f*(3*a.y-a.y*f))+f*(3*b.y+f*(-6*b.y+3*b.y*f))+h*(3*c.y-3*c.y*f)+d.y*f*h,this.interpolated.set(g,f)},this},createElasticOutInterpolator:function(a,b,c){return this.getPosition=function(d){if(c&&(d=.5>d?2*d:1-2*(d-.5)),0===d)return{x:0,y:0};if(1===d)return{x:1,y:1};var e=b/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(d,a*Math.pow(2,-10*d)*Math.sin(2*(d-e)*Math.PI/b)+1)},this},createElasticInInterpolator:function(a,b,c){return this.getPosition=function(d){if(c&&(d=.5>d?2*d:1-2*(d-.5)),0===d)return{x:0,y:0};if(1===d)return{x:1,y:1};var e=b/(2*Math.PI)*Math.asin(1/a);return this.interpolated.set(d,-(a*Math.pow(2,10*(d-=1))*Math.sin(2*(d-e)*Math.PI/b)))},this},createElasticInOutInterpolator:function(a,b,c){return this.getPosition=function(d){c&&(d=.5>d?2*d:1-2*(d-.5));var e=b/(2*Math.PI)*Math.asin(1/a);return d*=2,1>=d?this.interpolated.set(d,-.5*a*Math.pow(2,10*(d-=1))*Math.sin(2*(d-e)*Math.PI/b)):this.interpolated.set(d,1+.5*a*Math.pow(2,-10*(d-=1))*Math.sin(2*(d-e)*Math.PI/b))},this},bounce:function(a){return(a/=1)<1/2.75?{x:a,y:7.5625*a*a}:2/2.75>a?{x:a,y:7.5625*(a-=1.5/2.75)*a+.75}:2.5/2.75>a?{x:a,y:7.5625*(a-=2.25/2.75)*a+.9375}:{x:a,y:7.5625*(a-=2.625/2.75)*a+.984375}},createBounceOutInterpolator:function(a){return this.getPosition=function(b){return a&&(b=.5>b?2*b:1-2*(b-.5)),this.bounce(b)},this},createBounceInInterpolator:function(a){return this.getPosition=function(b){return a&&(b=.5>b?2*b:1-2*(b-.5)),b=this.bounce(1-b),b.y=1-b.y,b},this},createBounceInOutInterpolator:function(a){return this.getPosition=function(b){return a&&(b=.5>b?2*b:1-2*(b-.5)),.5>b?(b=this.bounce(1-2*b),b.y=.5*(1-b.y),b):(b=this.bounce(2*b-1,a),b.y=.5*b.y+.5,b)},this},paint:function(a){a.save(),a.beginPath(),a.moveTo(0,this.getPosition(0).y*this.paintScale);for(var b=0;b<=this.paintScale;b++)a.lineTo(b,this.getPosition(b/this.paintScale).y*this.paintScale);a.strokeStyle="black",a.stroke(),a.restore()},getContour:function(a){for(var b=[],c=0;a>=c;c++)b.push({x:c/a,y:this.getPosition(c/a).y});return b}}}}),CAAT.Module({defines:"CAAT.Behavior.BaseBehavior",constants:{Status:{NOT_STARTED:0,STARTED:1,EXPIRED:2},parse:function(a){function b(a){a=a.split(".");for(var b=window,c=0;c<a.length;c++){if(!b[a[c]])return null;b=b[a[c]]}return b}try{var c=a.type.toLowerCase(),c="CAAT.Behavior."+c.substr(0,1).toUpperCase()+c.substr(1)+"Behavior",d=new(new b(c)());return d.parse(a),d}catch(e){console.log("Error parsing behavior: "+e)}return null}},depends:["CAAT.Behavior.Interpolator"],extendsWith:function(){var a=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!1),b=(new CAAT.Behavior.Interpolator).createLinearInterpolator(!0);return{__init:function(){return this.lifecycleListenerList=[],this.setDefaultInterpolator(),this},lifecycleListenerList:null,behaviorStartTime:-1,behaviorDuration:-1,cycleBehavior:!1,status:CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,interpolator:null,actor:null,id:0,timeOffset:0,doValueApplication:!0,solved:!0,discardable:!1,isRelative:!1,setRelative:function(a){return this.isRelative=a,this},setRelativeValues:function(){return this.isRelative=!0,this},parse:function(a){a.pingpong&&this.setPingPong(),a.cycle&&this.setCycle(!0),this.setDelayTime(a.delay||0,a.duration||1e3),a.interpolator&&this.setInterpolator(CAAT.Behavior.Interpolator.parse(a.interpolator))},setValueApplication:function(a){return this.doValueApplication=a,this},setTimeOffset:function(a){return this.timeOffset=a,this},setStatus:function(a){return this.status=a,this},setId:function(a){return this.id=a,this},setDefaultInterpolator:function(){return this.interpolator=a,this},setPingPong:function(){return this.interpolator=b,this},setFrameTime:function(a,b){return this.behaviorStartTime=a,this.behaviorDuration=b,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this},setDelayTime:function(a,b){return this.behaviorStartTime=a,this.behaviorDuration=b,this.status=CAAT.Behavior.BaseBehavior.Status.NOT_STARTED,this.expired=this.solved=!1,this},setOutOfFrameTime:function(){return this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.behaviorStartTime=Number.MAX_VALUE,this.behaviorDuration=0,this},setInterpolator:function(a){return this.interpolator=a,this},apply:function(a,b){this.solved||(this.behaviorStartTime+=a,this.solved=!0);var c=a+=this.timeOffset*this.behaviorDuration;this.isBehaviorInTime(a,b)&&(a=this.normalizeTime(a),this.fireBehaviorAppliedEvent(b,c,a,this.setForTime(a,b)))},setCycle:function(a){return this.cycleBehavior=a,this},isCycle:function(){return this.cycleBehavior},addListener:function(a){return this.lifecycleListenerList.push(a),this},emptyListenerList:function(){return this.lifecycleListenerList=[],this},getStartTime:function(){return this.behaviorStartTime},getDuration:function(){return this.behaviorDuration},isBehaviorInTime:function(a,b){var c=CAAT.Behavior.BaseBehavior.Status;return this.status===c.EXPIRED||0>this.behaviorStartTime?!1:(this.cycleBehavior&&a>=this.behaviorStartTime&&(a=(a-this.behaviorStartTime)%this.behaviorDuration+this.behaviorStartTime),a>this.behaviorStartTime+this.behaviorDuration?(this.status!==c.EXPIRED&&this.setExpired(b,a),!1):(this.status===c.NOT_STARTED&&(this.status=c.STARTED,this.fireBehaviorStartedEvent(b,a)),this.behaviorStartTime<=a))},fireBehaviorStartedEvent:function(a,b){for(var c=0,d=this.lifecycleListenerList.length;d>c;c++){var e=this.lifecycleListenerList[c];e.behaviorStarted&&e.behaviorStarted(this,b,a)}},fireBehaviorExpiredEvent:function(a,b){for(var c=0,d=this.lifecycleListenerList.length;d>c;c++){var e=this.lifecycleListenerList[c];e.behaviorExpired&&e.behaviorExpired(this,b,a)}},fireBehaviorAppliedEvent:function(a,b,c,d){for(var e=0,f=this.lifecycleListenerList.length;f>e;e++){var g=this.lifecycleListenerList[e];g.behaviorApplied&&g.behaviorApplied(this,b,c,a,d)}},normalizeTime:function(a){return a-=this.behaviorStartTime,this.cycleBehavior&&(a%=this.behaviorDuration),this.interpolator.getPosition(a/this.behaviorDuration).y},setExpired:function(a,b){this.status=CAAT.Behavior.BaseBehavior.Status.EXPIRED,this.setForTime(this.interpolator.getPosition(1).y,a),this.fireBehaviorExpiredEvent(a,b),this.discardable&&this.actor.removeBehavior(this)},setForTime:function(){},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this},getPropertyName:function(){return""},calculateKeyFrameData:function(){},getKeyFrameDataValues:function(){},calculateKeyFramesData:function(){}}}}),CAAT.Module({defines:"CAAT.Behavior.AlphaBehavior",aliases:["CAAT.AlphaBehavior"],depends:["CAAT.Behavior.BaseBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{startAlpha:0,endAlpha:0,parse:function(a){CAAT.Behavior.AlphaBehavior.superclass.parse.call(this,a),this.startAlpha=a.start||0,this.endAlpha=a.end||0},getPropertyName:function(){return"opacity"},setForTime:function(a,b){CAAT.Behavior.AlphaBehavior.superclass.setForTime.call(this,a,b);var c=this.startAlpha+a*(this.endAlpha-this.startAlpha);return this.doValueApplication&&b.setAlpha(c),c},setValues:function(a,b){return this.startAlpha=a,this.endAlpha=b,this},calculateKeyFrameData:function(a){return a=this.interpolator.getPosition(a).y,this.startAlpha+a*(this.endAlpha-this.startAlpha)},getKeyFrameDataValues:function(a){return a=this.interpolator.getPosition(a).y,{alpha:this.startAlpha+a*(this.endAlpha-this.startAlpha)}},calculateKeyFramesData:function(a,b,c){"undefined"==typeof c&&(c=100),c>>=0;var d="@-"+a+"-keyframes "+b+" {";for(a=0;c>=a;a++)b=""+a/c*100+"%{opacity: "+this.calculateKeyFrameData(a/c)+"}",d+=b;return d+"}"}}}}),CAAT.Module({defines:"CAAT.Behavior.ContainerBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Behavior.GenericBehavior"],aliases:["CAAT.ContainerBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(a){if(a.behaviors&&a.behaviors.length)for(var b=0;b<a.behaviors.length;b+=1)this.addBehavior(CAAT.Behavior.BaseBehavior.parse(a.behaviors[b]));
CAAT.Behavior.ContainerBehavior.superclass.parse.call(this,a)},behaviors:null,recursiveCycleBehavior:!1,conforming:!1,__init:function(a){return this.__super(),this.behaviors=[],a&&(this.conforming=!0),this},conformToDuration:function(a){this.duration=a,a/=this.duration;for(var b,c=0;c<this.behaviors.length;c++)b=this.behaviors[c],b.setFrameTime(b.getStartTime()*a,b.getDuration()*a);return this},getBehaviorById:function(a){for(var b=0;b<this.behaviors.length;b++)if(this.behaviors[b].id===a)return this.behaviors[b];return null},setCycle:function(a,b){if(CAAT.Behavior.ContainerBehavior.superclass.setCycle.call(this,a),b)for(var c=0;c<this.behaviors.length;c++)this.behaviors[c].setCycle(a);return this.recursiveCycleBehavior=b,this},addBehavior:function(a){if(this.behaviors.push(a),a.addListener(this),this.conforming){var b=a.behaviorDuration+a.behaviorStartTime;this.behaviorDuration<b&&(this.behaviorDuration=b,this.behaviorStartTime=0)}return this.recursiveCycleBehavior&&a.setCycle(this.isCycle()),this},apply:function(a,b){if(this.solved||(this.behaviorStartTime+=a,this.solved=!0),a+=this.timeOffset*this.behaviorDuration,this.isBehaviorInTime(a,b)){a-=this.behaviorStartTime,this.cycleBehavior&&(a%=this.behaviorDuration);for(var c=this.behaviors,d=0;d<c.length;d++)c[d].apply(a,b)}},behaviorExpired:function(a){this.cycleBehavior&&a.setStatus(CAAT.Behavior.BaseBehavior.Status.STARTED)},behaviorApplied:function(a,b,c,d,e){this.fireBehaviorAppliedEvent(d,b,c,e)},setForTime:function(a,b){for(var c=null,d=this.behaviors,e=0;e<d.length;e++)c=d[e].setForTime(a,b);return c},setExpired:function(a,b){for(var c=this.behaviors,d=0;d<c.length;d++){var e=c[d];e.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&e.setExpired(a,b-this.behaviorStartTime)}return CAAT.Behavior.ContainerBehavior.superclass.setExpired.call(this,a,b),this},setFrameTime:function(a,b){CAAT.Behavior.ContainerBehavior.superclass.setFrameTime.call(this,a,b);for(var c=this.behaviors,d=0;d<c.length;d++)c[d].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},setDelayTime:function(a,b){CAAT.Behavior.ContainerBehavior.superclass.setDelayTime.call(this,a,b);for(var c=this.behaviors,d=0;d<c.length;d++)c[d].setStatus(CAAT.Behavior.BaseBehavior.Status.NOT_STARTED);return this},getKeyFrameDataValues:function(a){var b,c,d,e={angle:0,scaleX:1,scaleY:1,x:0,y:0};for(b=0;b<this.behaviors.length;b++)if(c=this.behaviors[b],c.status!==CAAT.Behavior.BaseBehavior.Status.EXPIRED&&!(c instanceof CAAT.Behavior.GenericBehavior)&&(d=a*this.behaviorDuration,c.behaviorStartTime<=d&&c.behaviorStartTime+c.behaviorDuration>=d)){d=(d-c.behaviorStartTime)/c.behaviorDuration,c=c.getKeyFrameDataValues(d);for(var f in c)e[f]=c[f]}return e},calculateKeyFrameData:function(a,b){function c(a){g[a]?i+=g[a]:prevValues&&(h=prevValues[a])&&(i+=h,g[a]=h)}var d,e,f,g={};for(d=0;d<this.behaviors.length;d++)e=this.behaviors[d],e.status===CAAT.Behavior.BaseBehavior.Status.EXPIRED||e instanceof CAAT.Behavior.GenericBehavior||(f=a*this.behaviorDuration,e.behaviorStartTime<=f&&e.behaviorStartTime+e.behaviorDuration>=f&&(f=(f-e.behaviorStartTime)/e.behaviorDuration,f=e.calculateKeyFrameData(f),e=e.getPropertyName(b),"undefined"==typeof g[e]&&(g[e]=""),g[e]+=f+" "));var h,i="";return c("translate"),c("rotate"),c("scale"),d="",i&&(d="-"+b+"-transform: "+i+";"),i="",c("opacity"),i&&(d+=" opacity: "+i+";"),{rules:d+" -webkit-transform-origin: 0% 0%",ret:g}},calculateKeyFramesData:function(a,b,c,d,e){if(this.duration===Number.MAX_VALUE)return"";"undefined"==typeof d&&(d=.5),"undefined"==typeof e&&(e=.5),"undefined"==typeof c&&(c=100);var f,g="@-"+a+"-keyframes "+b+" {",h={};for(b=0;c>=b;b++){f=this.interpolator.getPosition(b/c).y,f=this.getKeyFrameDataValues(f);var i=""+b/c*100+"%{",j=f,k=void 0;for(k in h)j[k]||(j[k]=h[k]);h="-"+a+"-transform:",(j.x||j.y)&&(h+="translate("+(j.x||0)+"px,"+(j.y||0)+"px)"),j.angle&&(h+=" rotate("+j.angle+"rad)"),(1!==j.scaleX||1!==j.scaleY)&&(h+=" scale("+j.scaleX+","+j.scaleY+")"),h+=";",j.alpha&&(h+=" opacity: "+j.alpha+";"),(.5!==d||.5!==e)&&(h+=" -"+a+"-transform-origin:"+100*d+"% "+100*e+"%;"),g+=i+h+"}\n",h=f}return g+"}\n"}}}}),CAAT.Module({defines:"CAAT.Behavior.GenericBehavior",depends:["CAAT.Behavior.BaseBehavior"],aliases:["CAAT.GenericBehavior"],extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{start:0,end:0,target:null,property:null,callback:null,setForTime:function(a,b){var c=this.start+a*(this.end-this.start);this.callback&&this.callback(c,this.target,b),this.property&&(this.target[this.property]=c)},setValues:function(a,b,c,d,e){return this.start=a,this.end=b,this.target=c,this.property=d,this.callback=e,this}}}}),CAAT.Module({defines:"CAAT.Behavior.PathBehavior",aliases:["CAAT.PathBehavior"],depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.SpriteImage"],constants:{AUTOROTATE:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2},autorotate:{LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,FREE:2}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{parse:function(a){if(CAAT.Behavior.PathBehavior.superclass.parse.call(this,a),a.SVG){var b=(new CAAT.PathUtil.SVGPath).parsePath(a.SVG);this.setValues(b)}a.autoRotate&&(this.autoRotate=a.autoRotate)},path:null,autoRotate:!1,prevX:-1,prevY:-1,autoRotateOp:CAAT.Behavior.PathBehavior.autorotate.FREE,isOpenContour:!1,relativeX:0,relativeY:0,setOpenContour:function(a){return this.isOpenContour=a,this},getPropertyName:function(){return"translate"},setRelativeValues:function(a,b){return this.relativeX=a,this.relativeY=b,this.isRelative=!0,this},setAutoRotate:function(a,b){return this.autoRotate=a,void 0!==b&&(this.autoRotateOp=b),this},setPath:function(a){return this.path=a,this},setValues:function(a){return this.setPath(a)},setTranslation:function(){return this},calculateKeyFrameData:function(a){return a=this.interpolator.getPosition(a).y,a=this.path.getPosition(a),"translateX("+a.x+"px) translateY("+a.y+"px)"},getKeyFrameDataValues:function(a){a=this.interpolator.getPosition(a).y;var b=this.path.getPosition(a),c={x:b.x,y:b.y};return this.autoRotate&&(a=0===a?b:this.path.getPosition(a-.001),b=Math.atan2(b.y-a.y,b.x-a.x),c.angle=b),c},calculateKeyFramesData:function(a,b,c){"undefined"==typeof c&&(c=100),c>>=0;var d,e="@-"+a+"-keyframes "+b+" {";for(b=0;c>=b;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"}",e+=d;return e+"}"},setForTime:function(a,b){if(!this.path)return{x:b.x,y:b.y};var c=this.path.getPosition(a,this.isOpenContour,.001);if(this.isRelative&&(c.x+=this.relativeX,c.y+=this.relativeY),this.autoRotate){-1===this.prevX&&-1===this.prevY&&(this.prevX=c.x,this.prevY=c.y);var d=c.x-this.prevX,e=c.y-this.prevY;if(0===d&&0===e)return b.setLocation(c.x,c.y),{x:b.x,y:b.y};var f=Math.atan2(e,d),g=CAAT.Foundation.SpriteImage,h=CAAT.Behavior.PathBehavior.AUTOROTATE;this.autoRotateOp===h.LEFT_TO_RIGHT?this.prevX<=c.x?b.setImageTransformation(g.TR_NONE):(b.setImageTransformation(g.TR_FLIP_HORIZONTAL),f+=Math.PI):this.autoRotateOp===h.RIGHT_TO_LEFT&&(this.prevX<=c.x?b.setImageTransformation(g.TR_FLIP_HORIZONTAL):(b.setImageTransformation(g.TR_NONE),f-=Math.PI)),b.setRotation(f),this.prevX=c.x,this.prevY=c.y,Math.sqrt(d*d+e*e)}return this.doValueApplication?(b.setLocation(c.x,c.y),{x:b.x,y:b.y}):{x:c.x,y:c.y}},positionOnTime:function(a){return this.isBehaviorInTime(a,null)?(a=this.normalizeTime(a),this.path.getPosition(a)):{x:-1,y:-1}}}}}),CAAT.Module({defines:"CAAT.Behavior.RotateBehavior",extendsClass:"CAAT.Behavior.BaseBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.RotateBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},parse:function(a){CAAT.Behavior.RotateBehavior.superclass.parse.call(this,a),this.startAngle=a.start||0,this.endAngle=a.end||0,this.anchorX="undefined"!=typeof a.anchorX?parseInt(a.anchorX):.5,this.anchorY="undefined"!=typeof a.anchorY?parseInt(a.anchorY):.5},startAngle:0,endAngle:0,anchorX:.5,anchorY:.5,rotationRelative:0,setRelativeValues:function(a){return this.rotationRelative=a,this.isRelative=!0,this},getPropertyName:function(){return"rotate"},setForTime:function(a,b){var c=this.startAngle+a*(this.endAngle-this.startAngle);return this.isRelative&&(c+=this.rotationRelative,c>=Math.PI&&(c-=2*Math.PI),c<-2*Math.PI&&(c+=2*Math.PI)),this.doValueApplication&&b.setRotationAnchored(c,this.anchorX,this.anchorY),c},setValues:function(a,b,c,d){return this.startAngle=a,this.endAngle=b,"undefined"!=typeof c&&"undefined"!=typeof d&&(this.anchorX=c,this.anchorY=d),this},setAngles:function(a,b){return this.setValues(a,b)},setAnchor:function(a,b,c){return this.anchorX=b/a.width,this.anchorY=c/a.height,this},calculateKeyFrameData:function(a){return a=this.interpolator.getPosition(a).y,"rotate("+(this.startAngle+a*(this.endAngle-this.startAngle))+"rad)"},getKeyFrameDataValues:function(a){return a=this.interpolator.getPosition(a).y,{angle:this.startAngle+a*(this.endAngle-this.startAngle)}},calculateKeyFramesData:function(a,b,c){"undefined"==typeof c&&(c=100),c>>=0;var d,e="@-"+a+"-keyframes "+b+" {";for(b=0;c>=b;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+100*this.anchorX+"% "+100*this.anchorY+"% }\n",e+=d;return e+"}\n"}}}}),CAAT.Module({defines:"CAAT.Behavior.Scale1Behavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],aliases:["CAAT.Scale1Behavior"],constants:{AXIS:{X:0,Y:1},Axis:{X:0,Y:1}},extendsClass:"CAAT.Behavior.BaseBehavior",extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScale:1,endScale:1,anchorX:.5,anchorY:.5,applyOnX:!0,parse:function(a){CAAT.Behavior.Scale1Behavior.superclass.parse.call(this,a),this.startScale=a.start||0,this.endScale=a.end||0,this.anchorX="undefined"!=typeof a.anchorX?parseInt(a.anchorX):.5,this.anchorY="undefined"!=typeof a.anchorY?parseInt(a.anchorY):.5,this.applyOnX=a.axis?"x"===a.axis.toLowerCase():!0},applyOnAxis:function(a){this.applyOnX=a===CAAT.Behavior.Scale1Behavior.AXIS.X?!1:!0},getPropertyName:function(){return"scale"},setForTime:function(a,b){var c=this.startScale+a*(this.endScale-this.startScale);return 0===c&&(c=.01),this.doValueApplication&&(this.applyOnX?b.setScaleAnchored(c,b.scaleY,this.anchorX,this.anchorY):b.setScaleAnchored(b.scaleX,c,this.anchorX,this.anchorY)),c},setValues:function(a,b,c,d,e){return this.startScale=a,this.endScale=b,this.applyOnX=!!c,"undefined"!=typeof d&&"undefined"!=typeof e&&(this.anchorX=d,this.anchorY=e),this},setAnchor:function(a,b,c){return this.anchorX=b/a.width,this.anchorY=c/a.height,this},calculateKeyFrameData:function(a){return a=this.interpolator.getPosition(a).y,a=this.startScale+a*(this.endScale-this.startScale),this.applyOnX?"scaleX("+a+")":"scaleY("+a+")"},getKeyFrameDataValues:function(a){a=this.interpolator.getPosition(a).y;var b={};return b[this.applyOnX?"scaleX":"scaleY"]=this.startScale+a*(this.endScale-this.startScale),b},calculateKeyFramesData:function(a,b,c){"undefined"==typeof c&&(c=100),c>>=0;var d,e="@-"+a+"-keyframes "+b+" {";for(b=0;c>=b;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+100*this.anchorX+"% "+100*this.anchorY+"% }\n",e+=d;return e+"}\n"}}}}),CAAT.Module({defines:"CAAT.Behavior.ScaleBehavior",depends:["CAAT.Behavior.BaseBehavior","CAAT.Foundation.Actor"],extendsClass:"CAAT.Behavior.BaseBehavior",aliases:["CAAT.ScaleBehavior"],extendsWith:function(){return{__init:function(){return this.__super(),this.anchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this},startScaleX:1,endScaleX:1,startScaleY:1,endScaleY:1,anchorX:.5,anchorY:.5,parse:function(a){CAAT.Behavior.ScaleBehavior.superclass.parse.call(this,a),this.startScaleX=a.scaleX&&a.scaleX.start||0,this.endScaleX=a.scaleX&&a.scaleX.end||0,this.startScaleY=a.scaleY&&a.scaleY.start||0,this.endScaleY=a.scaleY&&a.scaleY.end||0,this.anchorX="undefined"!=typeof a.anchorX?parseInt(a.anchorX):.5,this.anchorY="undefined"!=typeof a.anchorY?parseInt(a.anchorY):.5},getPropertyName:function(){return"scale"},setForTime:function(a,b){var c=this.startScaleX+a*(this.endScaleX-this.startScaleX),d=this.startScaleY+a*(this.endScaleY-this.startScaleY);return 0===c&&(c=.01),0===d&&(d=.01),this.doValueApplication&&b.setScaleAnchored(c,d,this.anchorX,this.anchorY),{scaleX:c,scaleY:d}},setValues:function(a,b,c,d,e,f){return this.startScaleX=a,this.endScaleX=b,this.startScaleY=c,this.endScaleY=d,"undefined"!=typeof e&&"undefined"!=typeof f&&(this.anchorX=e,this.anchorY=f),this},setAnchor:function(a,b,c){return this.anchorX=b/a.width,this.anchorY=c/a.height,this},calculateKeyFrameData:function(a){return a=this.interpolator.getPosition(a).y,"scale("+(this.startScaleX+a*(this.endScaleX-this.startScaleX))+","+(this.startScaleY+a*(this.endScaleY-this.startScaleY))+")"},getKeyFrameDataValues:function(a){return a=this.interpolator.getPosition(a).y,{scaleX:this.startScaleX+a*(this.endScaleX-this.startScaleX),scaleY:this.startScaleY+a*(this.endScaleY-this.startScaleY)}},calculateKeyFramesData:function(a,b,c){"undefined"==typeof c&&(c=100),c>>=0;var d,e="@-"+a+"-keyframes "+b+" {";for(b=0;c>=b;b++)d=""+b/c*100+"%{-"+a+"-transform:"+this.calculateKeyFrameData(b/c)+"; -"+a+"-transform-origin:"+100*this.anchorX+"% "+100*this.anchorY+"% }\n",e+=d;return e+"}\n"}}}}),CAAT.Module({defines:"CAAT.Module.Runtime.BrowserInfo",constants:function(){function a(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}}function b(a){var b=a.indexOf(this.versionSearchString);return-1!==b?parseFloat(a.substring(b+this.versionSearchString.length+1)):void 0}var c=[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],d=a([{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}])||"An unknown browser",e=b(navigator.userAgent)||b(navigator.appVersion)||"an unknown version",c=a(c)||"an unknown OS";return{browser:d,version:e,OS:c,DevicePixelRatio:window.devicePixelRatio||1}}}),CAAT.Module({defines:"CAAT.Module.Audio.AudioManager",extendsWith:function(){return{__init:function(){return this.isFirefox=null!==navigator.userAgent.match(/Firefox/g),this},isFirefox:!1,musicChannel:null,musicEnabled:!0,fxEnabled:!0,audioCache:null,channels:null,workingChannels:null,loopingChannels:[],audioFormatExtensions:["ogg","wav","x-wav","mp3"],currentAudioFormatExtension:"ogg",audioTypes:{ogg:"audio/ogg",mp3:"audio/mpeg;",wav:"audio/wav","x-wav":"audio/x-wav",mp4:'audio/mp4"'},initialize:function(a){this.setAudioFormatExtensions(this.audioFormatExtensions),this.audioCache=[],this.channels=[],this.workingChannels=[];for(var b=0;a>=b;b++){var c=document.createElement("audio");if(null!==c){c.finished=-1,this.channels.push(c);var d=this;c.addEventListener("ended",function(a){a=a.target;var b;for(b=0;b<d.workingChannels.length;b++)if(d.workingChannels[b]===a){d.workingChannels.splice(b,1);break}a.caat_callback&&a.caat_callback(a.caat_id),d.channels.push(a)},!1)}}return this.musicChannel=this.channels.pop(),this},setAudioFormatExtensions:function(a){return this.audioFormatExtensions=a,this.__setCurrentAudioFormatExtension(),this},__setCurrentAudioFormatExtension:function(){for(var a=new Audio,b=0,c=this.audioFormatExtensions.length;c>b;b+=1){var d=a.canPlayType(this.audioTypes[this.audioFormatExtensions[b]]).toLowerCase();if("no"!==d&&""!==d)return this.currentAudioFormatExtension=this.audioFormatExtensions[b],console.log("Audio type set to: "+this.currentAudioFormatExtension),void 0}this.currentAudioFormatExtension=null},__getAudioUrl:function(a){if(null===this.currentAudioFormatExtension)return a;var b=a.lastIndexOf(".");return 0>b&&(console.log("Audio w/o extension: "+a),b=a.length()-1),a.substring(0,b+1)+this.currentAudioFormatExtension},addAudioFromURL:function(a,b,c){var d=document.createElement("audio");return null!==d?(d.src=this.__getAudioUrl(b),console.log("Loading audio: "+d.src),d.preload="auto",d.load(),c&&(d.caat_callback=c,d.caat_id=a),this.audioCache.push({id:a,audio:d}),!0):!1},addAudioFromDomNode:function(a,b,c){var d=b.src.substr(b.src.lastIndexOf(".")+1);return b.canPlayType(this.audioTypes[d])?(c&&(b.caat_callback=c,b.caat_id=a),this.audioCache.push({id:a,audio:b}),!0):!1},addAudioElement:function(a,b,c){if("string"==typeof b)return this.addAudioFromURL(a,b,c);try{if(b instanceof HTMLAudioElement)return this.addAudioFromDomNode(a,b,c)}catch(d){}return!1},addAudio:function(a,b,c){if(b instanceof Array)for(var d=0;d<b.length&&!this.addAudioElement(a,b[d],c);d++);else this.addAudioElement(a,b,c);return this},getAudio:function(a){for(var b=0;b<this.audioCache.length;b++)if(this.audioCache[b].id===a)return this.audioCache[b].audio;return null},stopMusic:function(){this.musicChannel.pause()},playMusic:function(a){if(!this.musicEnabled)return null;if(a=this.getAudio(a),null!==a){var b=this.musicChannel;if(null!==b)return b.src=a.src,b.preload="auto",this.isFirefox?b.addEventListener("ended",function(a){a.target.currentTime=0},!1):b.loop=!0,b.load(),b.play(),b}return null},setVolume:function(a,b){var c=this.getAudio(a);return null!=c&&(c.volume=b),this},play:function(a){if(!this.fxEnabled)return null;var b=this.getAudio(a);return null!==b&&0<this.channels.length?(a=this.channels.shift(),a.src=b.src,a.volume=b.volume,a.play(),this.workingChannels.push(a)):console.log("Can't play audio: "+a),b},cancelPlay:function(a){for(var b=0;this.workingChannels.length;b++){var c=this.workingChannels[b];c.caat_id===a&&(c.pause(),this.channels.push(c),this.workingChannels.splice(b,1))}return this},cancelPlayByChannel:function(a){for(var b=0;this.workingChannels.length;b++)if(this.workingChannels[b]===a){this.channels.push(a),this.workingChannels.splice(b,1);break}return this},loop:function(a){if(!this.musicEnabled)return null;if(a=this.getAudio(a),null!==a){var b=document.createElement("audio");if(null!==b)return b.src=a.src,b.preload="auto",this.isFirefox?b.addEventListener("ended",function(a){a.target.currentTime=0},!1):b.loop=!0,b.load(),b.play(),this.loopingChannels.push(b),b}return null},endSound:function(){var a;for(a=0;a<this.workingChannels.length;a++)this.workingChannels[a].pause(),this.channels.push(this.workingChannels[a]);for(a=0;a<this.loopingChannels.length;a++)this.loopingChannels[a].pause();return this.workingChannels=[],this.loopingChannels=[],this.stopMusic(),this},setSoundEffectsEnabled:function(a){this.fxEnabled=a;for(var b=0;b<this.loopingChannels.length;b++)a?this.loopingChannels[b].play():this.loopingChannels[b].pause();return this},isSoundEffectsEnabled:function(){return this.fxEnabled},setMusicEnabled:function(a){return this.musicEnabled=a,this.stopMusic(),this},isMusicEnabled:function(){return this.musicEnabled}}}}),CAAT.Module({defines:"CAAT.Module.Storage.LocalStorage",constants:{save:function(a,b){try{localStorage.setItem(a,JSON.stringify(b))}catch(c){}return this},load:function(a,b){try{var c=localStorage.getItem(a);return null===c?b:JSON.parse(c)}catch(d){return null}},remove:function(a){try{localStorage.removeItem(a)}catch(b){}return this}},extendsWith:{}}),CAAT.Module({defines:"CAAT.Module.ColorUtil.Color",depends:[],constants:{RampEnumeration:{RAMP_RGBA:0,RAMP_RGB:1,RAMP_CHANNEL_RGB:2,RAMP_CHANNEL_RGBA:3,RAMP_CHANNEL_RGB_ARRAY:4,RAMP_CHANNEL_RGBA_ARRAY:5},hsvToRgb:function(a,b,c){var d,e,f;if(a=Math.max(0,Math.min(360,a)),b=Math.max(0,Math.min(100,b)),c=Math.max(0,Math.min(100,c)),b/=100,c/=100,0===b)return d=b=c,[Math.round(255*d),Math.round(255*b),Math.round(255*c)];switch(a/=60,d=Math.floor(a),e=a-d,a=c*(1-b),f=c*(1-b*e),e=c*(1-b*(1-e)),d){case 0:d=c,b=e,c=a;break;case 1:d=f,b=c,c=a;break;case 2:d=a,b=c,c=e;break;case 3:d=a,b=f;break;case 4:d=e,b=a;break;default:d=c,b=a,c=f}return new CAAT.Module.ColorUtil.Color(Math.round(255*d),Math.round(255*b),Math.round(255*c))},interpolate:function(a,b,c,d,e,f,g,h){return 0>=h?{r:a,g:b,b:c}:h>=g?{r:d,g:e,b:f}:(a=a+(d-a)/g*h>>0,b=b+(e-b)/g*h>>0,c=c+(f-c)/g*h>>0,a>255?a=255:0>a&&(a=0),b>255?b=255:0>b&&(b=0),c>255?c=255:0>c&&(c=0),{r:a,g:b,b:c})},makeRGBColorRamp:function(a,b,c){var d=[],e=a.length-1;b/=e;var f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(f=0;e>f;f+=1)for(l=a[f],m=l>>24&255,n=(16711680&l)>>16,o=(65280&l)>>8,l&=255,g=a[f+1],p=g>>24&255,q=(16711680&g)>>16,r=(65280&g)>>8,g&=255,p=(p-m)/b,q=(q-n)/b,r=(r-o)/b,s=(g-l)/b,g=0;b>g;g+=1){h=m+p*g>>0,i=n+q*g>>0,j=o+r*g>>0,k=l+s*g>>0;var t=CAAT.Module.ColorUtil.Color.RampEnumeration;switch(c){case t.RAMP_RGBA:d.push("argb("+h+","+i+","+j+","+k+")");break;case t.RAMP_RGB:d.push("rgb("+i+","+j+","+k+")");break;case t.RAMP_CHANNEL_RGB:d.push(4278190080|i<<16|j<<8|k);break;case t.RAMP_CHANNEL_RGBA:d.push(h<<24|i<<16|j<<8|k);break;case t.RAMP_CHANNEL_RGBA_ARRAY:d.push([i,j,k,h]);break;case t.RAMP_CHANNEL_RGB_ARRAY:d.push([i,j,k])}}return d},random:function(){for(var a="#",b=0;3>b;b++)a+="0123456789abcdef"[16*Math.random()>>0];return a}},extendsWith:{__init:function(a,b,c){return this.r=a||255,this.g=b||255,this.b=c||255,this},r:255,g:255,b:255,toHex:function(){return("000000"+((this.r<<16)+(this.g<<8)+this.b).toString(16)).slice(-6)}}}),CAAT.Module({defines:"CAAT.Module.Debug.Debug",depends:["CAAT.Event.AnimationLoop"],extendsWith:{width:0,height:0,canvas:null,ctx:null,statistics:null,framerate:null,textContainer:null,textFPS:null,textEntitiesTotal:null,textEntitiesActive:null,textDraws:null,textDrawTime:null,textRAFTime:null,textDirtyRects:null,textDiscardDR:null,frameTimeAcc:0,frameRAFAcc:0,canDebug:!1,SCALE:60,debugTpl:'    <style type="text/css">        #caat-debug {            z-index: 10000;            position:fixed;            bottom:0;            left:0;            width:100%;            background-color: rgba(0,0,0,0.8);        }        #caat-debug.caat_debug_max {            margin-bottom: 0px;        }        .caat_debug_bullet {            display:inline-block;            background-color:#f00;            width:8px;            height:8px;            border-radius: 4px;            margin-left:10px;            margin-right:2px;        }        .caat_debug_description {            font-size:11px;            font-family: helvetica, arial;            color: #aaa;            display: inline-block;        }        .caat_debug_value {            font-size:11px;            font-family: helvetica, arial;            color: #fff;            width:25px;            text-align: right;            display: inline-block;            margin-right: .3em;        }        .caat_debug_indicator {            float: right;        }        #debug_tabs {            border-top: 1px solid #888;            height:25px;        }        .tab_max_min {            font-family: helvetica, arial;            font-size: 12px;            font-weight: bold;            color: #888;            border-right: 1px solid #888;            float: left;            cursor: pointer;            padding-left: 5px;            padding-right: 5px;            padding-top: 5px;            height: 20px;        }        .debug_tabs_content_hidden {            display: none;            width: 100%;        }        .debug_tabs_content_visible {            display: block;            width: 100%;        }        .checkbox_enabled {            display:inline-block;            background-color:#eee;            border: 1px solid #eee;            width:6px;            height:8px;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_disabled {            display:inline-block;            width:6px;            height:8px;            background-color: #333;            border: 1px solid #eee;            margin-left:12px;            margin-right:2px;            cursor: pointer;        }        .checkbox_description {            font-size:11px;            font-family: helvetica, arial;            color: #fff;        }        .debug_tab {            font-family: helvetica, arial;            font-size: 12px;            color: #fff;            border-right: 1px solid #888;            float: left;            padding-left: 5px;            padding-right: 5px;            height: 20px;            padding-top: 5px;            cursor: default;        }        .debug_tab_selected {            background-color: #444;            cursor: default;        }        .debug_tab_not_selected {            background-color: #000;            cursor: pointer;        }    </style>    <div id="caat-debug">        <div id="debug_tabs">            <span class="tab_max_min" onCLick="javascript: var debug = document.getElementById(\'debug_tabs_content\');if (debug.className === \'debug_tabs_content_visible\') {debug.className = \'debug_tabs_content_hidden\'} else {debug.className = \'debug_tabs_content_visible\'}"> CAAT Debug panel </span>            <span id="caat-debug-tab0" class="debug_tab debug_tab_selected">Performance</span>            <span id="caat-debug-tab1" class="debug_tab debug_tab_not_selected">Controls</span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                <span class="caat_debug_description">Draw Time: </span>                <span class="caat_debug_value" id="textDrawTime">5.46</span>                <span class="caat_debug_description">ms.</span>            </span>            <span class="caat_debug_indicator">                <span class="caat_debug_bullet" style="background-color:#f00;"></span>                <span class="caat_debug_description">FPS: </span>                <span class="caat_debug_value" id="textFPS">48</span>            </span>        </div>        <div id="debug_tabs_content" class="debug_tabs_content_hidden">            <div id="caat-debug-tab0-content">                <canvas id="caat-debug-canvas" height="60"></canvas>                <div>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0f0;"></span>                        <span class="caat_debug_description">RAF Time:</span>                        <span class="caat_debug_value" id="textRAFTime">20.76</span>                        <span class="caat_debug_description">ms.</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Total: </span>                        <span class="caat_debug_value" id="textEntitiesTotal">41</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#0ff;"></span>                        <span class="caat_debug_description">Entities Active: </span>                        <span class="caat_debug_value" id="textEntitiesActive">37</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Draws: </span>                        <span class="caat_debug_value" id="textDraws">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">DirtyRects: </span>                        <span class="caat_debug_value" id="textDirtyRects">0</span>                    </span>                    <span>                        <span class="caat_debug_bullet" style="background-color:#00f;"></span>                        <span class="caat_debug_description">Discard DR: </span>                        <span class="caat_debug_value" id="textDiscardDR">0</span>                    </span>                </div>            </div>            <div id="caat-debug-tab1-content">                <div>                    <div>                        <span id="control-sound"></span>                        <span class="checkbox_description">Sound</span>                    </div>                    <div>                        <span id="control-music"></span>                        <span class="checkbox_description">Music</span>                    </div>                    <div>                        <span id="control-aabb"></span>                        <span class="checkbox_description">AA Bounding Boxes</span>                    </div>                    <div>                        <span id="control-bb"></span>                        <span class="checkbox_description">Bounding Boxes</span>                    </div>                    <div>                        <span id="control-dr"></span>                        <span class="checkbox_description">Dirty Rects</span>                    </div>                </div>            </div>        </div>    </div>',setScale:function(a){return this.scale=a,this},initialize:function(a,b){if(this.width=a=window.innerWidth,this.height=b,this.framerate={refreshInterval:CAAT.FPS_REFRESH||500,frames:0,timeLastRefresh:0,fps:0,prevFps:-1,fpsMin:1e3,fpsMax:0},!document.getElementById("caat-debug")){var c=document.createElement("div");c.innerHTML=this.debugTpl,document.body.appendChild(c),eval(' var __x= CAAT;        function initCheck( name, bool, callback ) {            var elem= document.getElementById(name);            if ( elem ) {                elem.className= (bool) ? "checkbox_enabled" : "checkbox_disabled";                if ( callback ) {                    elem.addEventListener( "click", (function(elem, callback) {                        return function(e) {                            elem.__value= !elem.__value;                            elem.className= (elem.__value) ? "checkbox_enabled" : "checkbox_disabled";                            callback(e,elem.__value);                        }                    })(elem, callback), false );                }                elem.__value= bool;            }        }        function setupTabs() {            var numTabs=0;            var elem;            var elemContent;            do {                elem= document.getElementById("caat-debug-tab"+numTabs);                if ( elem ) {                    elemContent= document.getElementById("caat-debug-tab"+numTabs+"-content");                    if ( elemContent ) {                        elemContent.style.display= numTabs===0 ? \'block\' : \'none\';                        elem.className= numTabs===0 ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                        elem.addEventListener( "click", (function(tabIndex) {                            return function(e) {                                for( var i=0; i<numTabs; i++ ) {                                    var _elem= document.getElementById("caat-debug-tab"+i);                                    var _elemContent= document.getElementById("caat-debug-tab"+i+"-content");                                    _elemContent.style.display= i===tabIndex ? \'block\' : \'none\';                                    _elem.className= i===tabIndex ? "debug_tab debug_tab_selected" : "debug_tab debug_tab_not_selected";                                }                            }                        })(numTabs), false );                    }                    numTabs++;                }            } while( elem );        }        initCheck( "control-sound", __x.director[0].isSoundEffectsEnabled(), function(e, bool) {            __x.director[0].setSoundEffectsEnabled(bool);        } );        initCheck( "control-music", __x.director[0].isMusicEnabled(), function(e, bool) {            __x.director[0].setMusicEnabled(bool);        } );        initCheck( "control-aabb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGAABB= bool;            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-bb", CAAT.DEBUGBB, function(e,bool) {            CAAT.DEBUGBB= bool;            if ( bool ) {                CAAT.DEBUGAABB= true;            }            __x.director[0].currentScene.dirty= true;        } );        initCheck( "control-dr", CAAT.DEBUG_DIRTYRECTS , function( e,bool ) {            CAAT.DEBUG_DIRTYRECTS= bool;        });        setupTabs();')
}return this.canvas=document.getElementById("caat-debug-canvas"),null!==this.canvas?(this.canvas.width=a,this.canvas.height=b,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.width,this.height),this.textFPS=document.getElementById("textFPS"),this.textDrawTime=document.getElementById("textDrawTime"),this.textRAFTime=document.getElementById("textRAFTime"),this.textEntitiesTotal=document.getElementById("textEntitiesTotal"),this.textEntitiesActive=document.getElementById("textEntitiesActive"),this.textDraws=document.getElementById("textDraws"),this.textDirtyRects=document.getElementById("textDirtyRects"),this.textDiscardDR=document.getElementById("textDiscardDR"),this.canDebug=!0,this):(this.canDebug=!1,void 0)},debugInfo:function(a){if(this.statistics=a,a=CAAT,this.frameTimeAcc+=a.FRAME_TIME,this.frameRAFAcc+=a.REQUEST_ANIMATION_FRAME_TIME,this.framerate.frames++,a=(new Date).getTime(),a>this.framerate.timeLastRefresh+this.framerate.refreshInterval){this.framerate.fps=1e3*this.framerate.frames/(a-this.framerate.timeLastRefresh)|0,this.framerate.fpsMin=0<this.framerate.frames?Math.min(this.framerate.fpsMin,this.framerate.fps):this.framerate.fpsMin,this.framerate.fpsMax=Math.max(this.framerate.fpsMax,this.framerate.fps),this.textFPS.innerHTML=this.framerate.fps;var b=(100*this.frameTimeAcc/this.framerate.frames|0)/100;this.frameTimeAcc=0,this.textDrawTime.innerHTML=b,b=(100*this.frameRAFAcc/this.framerate.frames|0)/100,this.frameRAFAcc=0,this.textRAFTime.innerHTML=b,this.framerate.timeLastRefresh=a,this.framerate.frames=0,this.paint(b)}this.textEntitiesTotal.innerHTML=this.statistics.size_total,this.textEntitiesActive.innerHTML=this.statistics.size_active,this.textDirtyRects.innerHTML=this.statistics.size_dirtyRects,this.textDraws.innerHTML=this.statistics.draws,this.textDiscardDR.innerHTML=this.statistics.size_discarded_by_dirty_rects},paint:function(a){var b=this.ctx,c=0;b.drawImage(this.canvas,1,0,this.width-1,this.height,0,0,this.width-1,this.height),b.strokeStyle="black",b.beginPath(),b.moveTo(this.width-.5,0),b.lineTo(this.width-.5,this.height),b.stroke(),b.strokeStyle="#a22",b.beginPath(),c=this.height-(20/this.SCALE*this.height>>0)-.5,b.moveTo(.5,c),b.lineTo(this.width+.5,c),b.stroke(),b.strokeStyle="#aa2",b.beginPath(),c=this.height-(30/this.SCALE*this.height>>0)-.5,b.moveTo(.5,c),b.lineTo(this.width+.5,c),b.stroke(),c=Math.min(this.height-this.framerate.fps/this.SCALE*this.height,59),-1===this.framerate.prevFps&&(this.framerate.prevFps=0|c),b.strokeStyle="#0ff",b.beginPath(),b.moveTo(this.width,(0|c)-.5),b.lineTo(this.width,this.framerate.prevFps-.5),b.stroke(),this.framerate.prevFps=c,a=(this.height-a/this.SCALE*this.height>>0)-.5,b.strokeStyle="#ff0",b.beginPath(),b.moveTo(this.width,a),b.lineTo(this.width,a),b.stroke()}}}),CAAT.Module({defines:"CAAT.Module.Font.Font",aliases:"CAAT.Font",depends:["CAAT.Foundation.SpriteImage"],constants:{getFontMetrics:function(a){var b;if(CAAT.CSS_TEXT_METRICS)try{return b=CAAT.Module.Font.Font.getFontMetricsCSS(a)}catch(c){}return CAAT.Module.Font.Font.getFontMetricsNoCSS(a)},getFontMetricsNoCSS:function(a){a=/(\d+)p[x|t]\s*/i.exec(a);var b;return b=a?0|a[1]:32,a=b-1,b=b+.2*b|0,{height:b,ascent:a,descent:b-a}},getFontMetricsCSS:function(a){function b(a){var b,c,d;return d=a&&a.ownerDocument,b=d.documentElement,a=a.getBoundingClientRect(),c=document.body,d=9===d.nodeType?d.defaultView||d.parentWindow:!1,{top:a.top+(d.pageYOffset||b.scrollTop)-(b.clientTop||c.clientTop||0),left:a.left+(d.pageXOffset||b.scrollLeft)-(b.clientLeft||c.clientLeft||0)}}try{var c=document.createElement("span");c.style.font=a,c.innerHTML="Hg";var d=document.createElement("div");d.style.display="inline-block",d.style.width="1px",d.style.heigh="0px";var e=document.createElement("div");e.appendChild(c),e.appendChild(d);var f=document.body;f.appendChild(e);try{return a={},d.style.verticalAlign="baseline",a.ascent=b(d).top-b(c).top,d.style.verticalAlign="bottom",a.height=b(d).top-b(c).top,a.ascent=Math.ceil(a.ascent),a.height=Math.ceil(a.height),a.descent=a.height-a.ascent,a}finally{f.removeChild(e)}}catch(g){return null}}},extendsWith:function(){return{fontSize:10,fontSizeUnit:"px",font:"Sans-Serif",fontStyle:"",fillStyle:"#fff",strokeStyle:null,strokeSize:1,padding:0,image:null,charMap:null,height:0,ascent:0,descent:0,setPadding:function(a){return this.padding=a,this},setFontStyle:function(a){return this.fontStyle=a,this},setStrokeSize:function(a){return this.strokeSize=a,this},setFontSize:function(a){return this.fontSize=a,this.fontSizeUnit="px",this},setFont:function(a){return this.font=a,this},setFillStyle:function(a){return this.fillStyle=a,this},setStrokeStyle:function(a){return this.strokeStyle=a,this},createDefault:function(a){for(var b="",c=32;128>c;c++)b+=String.fromCharCode(c);return this.create(b,a)},create:function(a,b){this.padding=b|=0;var c=document.createElement("canvas"),d=c.getContext("2d");d.textBaseline="bottom",d.font=this.fontStyle+" "+this.fontSize+this.fontSizeUnit+" "+this.font;var e,f,g=0,h=[];for(e=0;e<a.length;e++){var i=Math.max(1,(d.measureText(a.charAt(e)).width>>0)+1)+2*b;h.push(i),g+=i}for(e=CAAT.Font.getFontMetrics(d.font),d=e.height,this.ascent=e.ascent,this.descent=e.descent,this.height=e.height,i=e.ascent,c.width=g,c.height=d,d=c.getContext("2d"),d.textBaseline="alphabetic",d.font=this.fontStyle+" "+this.fontSize+this.fontSizeUnit+" "+this.font,d.fillStyle=this.fillStyle,d.strokeStyle=this.strokeStyle,this.charMap={},e=g=0;e<a.length;e++)f=a.charAt(e),d.fillText(f,g+b,i),this.strokeStyle&&(d.beginPath(),d.lineWidth=this.strokeSize,d.strokeText(f,g+b,i)),this.charMap[f]={x:g+b,width:h[e]-2*b,height:this.height},g+=h[e];return this.image=c,this},setAsSpriteImage:function(){var a,b=[],c=0;for(a in this.charMap){var d=a,e=this.charMap[a];b[a]={id:c++,height:this.height,xoffset:0,letter:d,yoffset:0,width:e.width,xadvance:e.width,x:e.x,y:0}}return this.spriteImage=(new CAAT.Foundation.SpriteImage).initializeAsGlyphDesigner(this.image,b),this},getAscent:function(){return this.ascent},getDescent:function(){return this.descent},stringHeight:function(){return this.height},getFontData:function(){return{height:this.height,ascent:this.ascent,descent:this.descent}},stringWidth:function(a){var b,c,d,e=0;for(b=0,c=a.length;c>b;b++)e=(d=this.charMap[a.charAt(b)])?e+d.width:e+10;return e},drawText:function(a,b,c,d){var e,f,g,h,i=this.image.height;for(e=0,f=a.length;f>e;e++)(g=this.charMap[a.charAt(e)])?(h=g.width,h>0&&0<g.height&&b.drawImage(this.image,g.x,0,h,i,c,d,h,i),c+=h):(b.strokeStyle="#f00",b.strokeRect(c,d,10,i),c+=10)},save:function(){var a=this.image.toDataURL("image/png");document.location.href=a.replace("image/png","image/octet-stream")},drawSpriteText:function(a,b){this.spriteImage.drawSpriteText(a,b)}}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircle",depends:["CAAT.Module.CircleManager.PackedCircle","CAAT.Math.Point"],constants:{BOUNDS_RULE_WRAP:1,BOUNDS_RULE_CONSTRAINT:2,BOUNDS_RULE_DESTROY:4,BOUNDS_RULE_IGNORE:8},extendsWith:{__init:function(){return this.boundsRule=CAAT.Module.CircleManager.PackedCircle.BOUNDS_RULE_IGNORE,this.position=new CAAT.Math.Point(0,0,0),this.offset=new CAAT.Math.Point(0,0,0),this.targetPosition=new CAAT.Math.Point(0,0,0),this},id:0,delegate:null,position:null,offset:null,targetPosition:null,targetChaseSpeed:.02,isFixed:!1,boundsRule:0,collisionMask:0,collisionGroup:0,containsPoint:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},getDistanceSquaredFromPosition:function(a){return this.position.getDistanceSquared(a)<this.radiusSquared},intersects:function(a){var b=this.position.getDistanceSquared(a.position);return b<this.radiusSquared||b<a.radiusSquared},setPosition:function(a){return this.position=a,this},setDelegate:function(a){return this.delegate=a,this},setOffset:function(a){return this.offset=a,this},setTargetPosition:function(a){return this.targetPosition=a,this},setTargetChaseSpeed:function(a){return this.targetChaseSpeed=a,this},setIsFixed:function(a){return this.isFixed=a,this},setCollisionMask:function(a){return this.collisionMask=a,this},setCollisionGroup:function(a){return this.collisionGroup=a,this},setRadius:function(a){return this.radius=a,this.radiusSquared=this.radius*this.radius,this},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this},dealloc:function(){this.targetPosition=this.delegate=this.offset=this.position=null}}}),CAAT.Module({defines:"CAAT.Module.CircleManager.PackedCircleManager",depends:["CAAT.Math.Point","CAAT.Math.Rectangle"],extendsWith:{__init:function(){this.bounds=new CAAT.Math.Rectangle},allCircles:[],numberOfCollisionPasses:1,numberOfTargetingPasses:0,bounds:null,addCircle:function(a){return a.id=this.allCircles.length,this.allCircles.push(a),this},removeCircle:function(a){var b=0,c=!1,d=this.allCircles.length;if(0===d)throw"Error: (PackedCircleManager) attempting to remove circle, and allCircles.length === 0!!";for(;d--;)if(this.allCircles[d]===a){c=!0,b=d;break}if(!c)throw"Could not locate circle in allCircles array!";return this.allCircles[b].dealloc(),this.allCircles[b]=null,this},forceCirclesToMatchDelegatePositions:function(){for(var a=this.allCircles.length,b=0;a>b;b++){var c=this.allCircles[b];c&&c.delegate&&c.position.set(c.delegate.x+c.offset.x,c.delegate.y+c.offset.y)}},pushAllCirclesTowardTarget:function(a){a=new CAAT.Math.Point(0,0,0);for(var b=this.allCircles,c=b.length,d=0;d<this.numberOfTargetingPasses;d++)for(var e=0;c>e;e++){var f=b[e];f.isFixed||(a.x=f.position.x-(f.targetPosition.x+f.offset.x),a.y=f.position.y-(f.targetPosition.y+f.offset.y),a.multiply(f.targetChaseSpeed),f.position.x-=a.x,f.position.y-=a.y)}},handleCollisions:function(){this.removeExpiredElements();for(var a=new CAAT.Math.Point(0,0,0),b=this.allCircles,c=b.length,d=0;d<this.numberOfCollisionPasses;d++)for(var e=0;c>e;e++)for(var f=b[e],g=e+1;c>g;g++){var h=b[g];if(this.circlesCanCollide(f,h)){var i=h.position.x-f.position.x,j=h.position.y-f.position.y,k=1.08*(f.radius+h.radius),l=f.position.getDistanceSquared(h.position);k*k-.02>l&&(a.x=i,a.y=j,a.normalize(),i=.5*(k-Math.sqrt(l)),a.multiply(i),h.isFixed||(f.isFixed&&a.multiply(2.2),h.position.translatePoint(a)),f.isFixed||(h.isFixed&&a.multiply(2.2),f.position.subtract(a)))}}},handleBoundaryForCircle:function(a,b){var c=a.position.x,d=a.position.y,e=a.radius,f=2*e;b=12,1&b&&c-f>this.bounds.right?a.position.x=this.bounds.left+e:1&b&&c+f<this.bounds.left&&(a.position.x=this.bounds.right-e),4&b&&d-f>this.bounds.bottom?a.position.y=this.bounds.top-e:4&b&&d+f<this.bounds.top&&(a.position.y=this.bounds.bottom+e),8&b&&c+e>=this.bounds.right?a.position.x=a.position.x=this.bounds.right-e:8&b&&c-e<this.bounds.left&&(a.position.x=this.bounds.left+e),16&b&&d+e>this.bounds.bottom?a.position.y=this.bounds.bottom-e:16&b&&d-e<this.bounds.top&&(a.position.y=this.bounds.top+e)},getCircleAt:function(a,b,c){var d=this.allCircles,e=d.length;a=new CAAT.Math.Point(a,b,0),b=null;for(var f=Number.MAX_VALUE,g=0;e>g;g++){var h=d[g];if(h){var i=h.position.getDistanceSquared(a);f>i&&i<h.radiusSquared+c&&(f=i,b=h)}}return b},circlesCanCollide:function(a,b){return a&&b&&a!==b?!0:!1},setBounds:function(a,b,c,d){this.bounds.x=a,this.bounds.y=b,this.bounds.width=c,this.bounds.height=d},setNumberOfCollisionPasses:function(a){return this.numberOfCollisionPasses=a,this},setNumberOfTargetingPasses:function(a){return this.numberOfTargetingPasses=a,this},sortOnDistanceToTarget:function(a,b){var c=a.getDistanceSquaredFromPosition(a.targetPosition),d=b.getDistanceSquaredFromPosition(a.targetPosition),e=0;return c>d?e=-1:d>c&&(e=1),e},removeExpiredElements:function(){for(var a=this.allCircles.length;a>=0;a--)null===this.allCircles[a]&&this.allCircles.splice(a,1)},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this}}}),CAAT.Module({defines:"CAAT.Module.Preloader.Preloader",extendsWith:function(){var a=function(a,b,c){return this.id=a,this.path=b,this.image=new Image,this.loader=c,this.image.onload=this.onload.bind(this),this.image.onerror=this.onerror.bind(this),this};return a.prototype={id:null,path:null,image:null,loader:null,onload:function(){this.loader.__onload(this),this.image.onload=null,this.image.onerror=null},onerror:function(){this.loader.__onerror(this)},load:function(){this.image.src=this.path},clear:function(){this.loader=null}},{__init:function(){return this.elements=[],this.baseURL="",this},currentGroup:null,elements:null,imageCounter:0,cfinished:null,cloaded:null,cerrored:null,loadedCount:0,baseURL:null,addElement:function(b,c){return this.elements.push(new a(b,this.baseURL+c,this)),this},clear:function(){for(var a=0;a<this.elements.length;a++)this.elements[a].clear();this.elements=null},__onload:function(a){this.cloaded&&this.cloaded(a.id),this.loadedCount++,this.loadedCount===this.elements.length&&this.cfinished&&this.cfinished(this.elements)},__onerror:function(a){this.cerrored&&this.cerrored(a.id)},setBaseURL:function(a){return this.baseURL=a,this},load:function(a,b,c){for(this.cfinished=a,this.cloaded=b,this.cerroed=c,a=0;a<this.elements.length;a++)this.elements[a].load();return this}}}}),CAAT.Module({defines:"CAAT.Module.Preloader.ImagePreloader",aliases:["CAAT.ImagePreloader"],extendsWith:{__init:function(){return this.images=[],this},images:null,notificationCallback:null,imageCounter:0,loadImages:function(a,b,c){a||b&&b(0,[]);var d,e=this;for(this.notificationCallback=b,this.images=[],d=0;d<a.length;d++)this.images.push({id:a[d].id,image:new Image});for(d=0;d<a.length;d++)this.images[d].image.onload=function(){e.imageCounter++,e.notificationCallback(e.imageCounter,e.images)},this.images[d].image.onerror=function(a){return function(b){c&&c(b,a)}}(d),this.images[d].image.src=a[d].url;0===a.length&&b(0,[])}}}),CAAT.Module({defines:"CAAT.Module.Preloader.XHR",extendsWith:{load:function(a,b,c,d){"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d="GET");var e=!1;if(window.XMLHttpRequest&&!window.ActiveXObject)try{e=new XMLHttpRequest}catch(f){e=!1}else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(h){e=!1}}e&&(e.open(d,b,!1),e.onreadystatechange=function(b){return 200!=e.status?a("error"):(a("ok",b.currentTarget?b.currentTarget.responseText:b.target.responseText),void 0)},e.send())}}}),CAAT.Module({defines:"CAAT.Module.Image.ImageUtil",depends:["CAAT.Math.Matrix"],extendsWith:{},constants:{createAlphaSpriteSheet:function(a,b,c,d,e){if(b>a){var f=a;a=b,b=f}f=document.createElement("canvas"),f.width=d.width,f.height=d.height*c;var g=f.getContext("2d");for(g.fillStyle=e?e:"rgba(255,255,255,0)",g.fillRect(0,0,d.width,d.height*c),e=0;c>e;e++)g.globalAlpha=1-(a-b)/c*(e+1),g.drawImage(d,0,e*d.height);return f},rotate:function(a,b){if(b=b||0,!b)return a;var c=document.createElement("canvas");c.width=a.height,c.height=a.width;var d=c.getContext("2d");d.globalAlpha=1,d.fillStyle="rgba(0,0,0,0)",d.clearRect(0,0,c.width,c.height);var e=new CAAT.Math.Matrix;return e.multiply((new CAAT.Math.Matrix).setTranslate(c.width/2,c.width/2)),e.multiply((new CAAT.Math.Matrix).setRotation(b*Math.PI/180)),e.multiply((new CAAT.Math.Matrix).setTranslate(-c.width/2,-c.width/2)),e.transformRenderingContext(d),d.drawImage(a,0,0),c},optimize:function(a,b,c){b>>=0;var d=!0,e=!0,f=!0,g=!0;"undefined"!=typeof c&&("undefined"!=typeof c.top&&(d=c.top),"undefined"!=typeof c.bottom&&(e=c.bottom),"undefined"!=typeof c.left&&(f=c.left),"undefined"!=typeof c.right&&(g=c.right)),c=document.createElement("canvas"),c.width=a.width,c.height=a.height;var h=c.getContext("2d");h.fillStyle="rgba(0,0,0,0)",h.fillRect(0,0,a.width,a.height),h.drawImage(a,0,0);var i,j=h.getImageData(0,0,a.width,a.height).data;a=0;var k=c.height-1,l=0,m=c.width-1,n=!1;if(d){for(d=0;d<c.height;d++){for(i=0;i<c.width;i++)if(j[d*c.width*4+3+4*i]>b){n=!0;break}if(n)break}a=d}if(e){for(n=!1,d=c.height-1;d>=a;d--){for(i=0;i<c.width;i++)if(j[d*c.width*4+3+4*i]>b){n=!0;break}if(n)break}k=d}if(f){for(n=!1,i=0;i<c.width;i++){for(d=a;k>=d;d++)if(j[d*c.width*4+3+4*i]>b){n=!0;break}if(n)break}l=i}if(g){for(n=!1,i=c.width-1;i>=l;i--){for(d=a;k>=d;d++)if(j[d*c.width*4+3+4*i]>b){n=!0;break}if(n)break}m=i}return 0===l&&0===a&&c.width-1===m&&c.height-1===k?c:(b=m-l+1,e=k-a+1,f=h.getImageData(l,a,b,e),c.width=b,c.height=e,h=c.getContext("2d"),h.putImageData(f,0,0),c)},createThumb:function(a,b,c,d){b=b||24,c=c||24;var e=document.createElement("canvas");e.width=b,e.height=c;var f=e.getContext("2d");if(d){var g=Math.max(a.width,a.height);d=a.width/g*b,g=a.height/g*c,f.drawImage(a,(b-d)/2,(c-g)/2,d,g)}else f.drawImage(a,0,0,b,c);return e}}}),CAAT.Module({defines:"CAAT.Module.Collision.QuadTree",depends:["CAAT.Math.Rectangle"],extendsClass:"CAAT.Math.Rectangle",extendsWith:function(){return{bgActors:null,quadData:null,create:function(a,b,c,d,e,f,g){"undefined"==typeof f&&(f=32),"undefined"==typeof g&&(g=1);var h=(a+c)/2,i=(b+d)/2;return this.x=a,this.y=b,this.x1=c,this.y1=d,this.width=c-a,this.height=d-b,this.bgActors=this.__getOverlappingActorList(e),this.bgActors.length<=g||this.width<=f?this:(this.quadData=Array(4),this.quadData[0]=(new CAAT.Module.Collision.QuadTree).create(a,b,h,i,this.bgActors),this.quadData[1]=(new CAAT.Module.Collision.QuadTree).create(h,b,c,i,this.bgActors),this.quadData[2]=(new CAAT.Module.Collision.QuadTree).create(a,i,h,d,this.bgActors),this.quadData[3]=(new CAAT.Module.Collision.QuadTree).create(h,i,c,d,this.bgActors),this)},__getOverlappingActorList:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];this.intersects(e.AABB)&&b.push(e)}return b},getOverlappingActors:function(a){var b,c,d,e,f=[];if(c=this.bgActors,this.quadData){for(b=0;4>b;b++)if(this.quadData[b].intersects(a))for(e=this.quadData[b].getOverlappingActors(a),c=0,d=e.length;d>c;c++)f.push(e[c])}else for(b=0,d=c.length;d>b;b++)e=c[b],a.intersects(e.AABB)&&f.push(e);return f}}}}),CAAT.Module({defines:"CAAT.Module.Collision.SpatialHash",aliases:["CAAT.SpatialHash"],depends:["CAAT.Math.Rectangle"],extendsWith:{elements:null,width:null,height:null,rows:null,columns:null,xcache:null,ycache:null,xycache:null,rectangle:null,r0:null,r1:null,initialize:function(a,b,c,d){var e;for(this.elements=[],e=0;c*d>e;e++)this.elements.push([]);for(this.width=a,this.height=b,this.rows=c,this.columns=d,this.xcache=[],e=0;a>e;e++)this.xcache.push(e/(a/d)>>0);for(this.ycache=[],e=0;b>e;e++)this.ycache.push(e/(b/c)>>0);for(this.xycache=[],e=0;e<this.rows;e++)for(this.xycache.push([]),c=0;c<this.columns;c++)this.xycache[e].push(c+e*d);return this.rectangle=(new CAAT.Math.Rectangle).setBounds(0,0,a,b),this.r0=new CAAT.Math.Rectangle,this.r1=new CAAT.Math.Rectangle,this},clearObject:function(){var a;for(a=0;a<this.rows*this.columns;a++)this.elements[a]=[];return this},addObject:function(a){for(var b=this.__getCells(0|a.x,0|a.y,0|a.width,0|a.height),c=0;c<b.length;c++)this.elements[b[c]].push(a)},__getCells:function(a,b,c,d){var e=[];if(this.rectangle.contains(a,b)&&e.push(this.xycache[this.ycache[b]][this.xcache[a]]),this.rectangle.contains(a+c-1,b+d-1)){var f=this.xycache[this.ycache[b+d-1]][this.xcache[a+c-1]];if(f===e[0])return e;e.push(f)}if(this.rectangle.contains(a+c-1,b)){if(f=this.xycache[this.ycache[b]][this.xcache[a+c-1]],f===e[0]||f===e[1])return e;e.push(f)}return this.rectangle.contains(a+c-1,b+d-1)&&(f=this.xycache[this.ycache[b+d-1]][this.xcache[a]],e.push(f)),e},solveCollision:function(a){var b;for(b=0;b<this.elements.length;b++){var c=this.elements[b];1<c.length&&this._solveCollisionCell(c,a)}},_solveCollisionCell:function(a,b){var c,d;for(c=0;c<a.length;c++){var e=a[c];for(this.r0.setBounds(e.x,e.y,e.width,e.height),d=c+1;d<a.length;d++){var f=a[d];this.r0.intersects(this.r1.setBounds(f.x,f.y,f.width,f.height))&&b(e,f)}}},collide:function(a,b,c,d,e){a|=0,b|=0,c|=0,d|=0;var f=this.__getCells(a,b,c,d),g=this.elements;for(this.r0.setBounds(a,b,c,d),a=0;a<f.length;a++)for(d=g[f[a]],b=0,c=d.length;c>b;b++){var h=d[b];if(this.r1.setBounds(h.x,h.y,h.width,h.height),this.r0.intersects(this.r1)&&e(h))return}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureElement",extendsWith:{inverted:!1,image:null,u:0,v:0,glTexture:null}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScan",depends:["CAAT.Module.TexturePacker.TextureElement"],extendsWith:{__init:function(a){return this.freeChunks=[{position:0,size:a||1024}],this},freeChunks:null,findWhereFits:function(a){if(0===this.freeChunks.length)return[];var b,c=[];for(b=0;b<this.freeChunks.length;b++)for(var d=0;d+a<=this.freeChunks[b].size;)c.push(d+this.freeChunks[b].position),d+=a;return c},fits:function(a,b){for(var c=0,c=0;c<this.freeChunks.length;c++){var d=this.freeChunks[c];if(d.position<=a&&a+b<=d.position+d.size)return!0}return!1},substract:function(a,b){for(var c=0,c=0;c<this.freeChunks.length;c++){var d=this.freeChunks[c];if(d.position<=a&&a+b<=d.position+d.size){var e=0,f=0,g=0,h=0,e=d.position,f=a-d.position,g=a+b,h=d.position+d.size-g;return this.freeChunks.splice(c,1),f>0&&this.freeChunks.splice(c++,0,{position:e,size:f}),h>0&&this.freeChunks.splice(c,0,{position:g,size:h}),!0}}return!1},log:function(a){if(0===this.freeChunks.length)CAAT.log("index "+a+" empty");else{a="index "+a;for(var b=0;b<this.freeChunks.length;b++){var c=this.freeChunks[b];a+="["+c.position+","+c.size+"]"}CAAT.log(a)}}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TextureScanMap",depends:["CAAT.Module.TexturePacker.TextureScan"],extendsWith:{__init:function(a,b){this.scanMapHeight=b,this.scanMapWidth=a,this.scanMap=[];for(var c=0;c<this.scanMapHeight;c++)this.scanMap.push(new CAAT.Module.TexturePacker.TextureScan(this.scanMapWidth));return this},scanMap:null,scanMapWidth:0,scanMapHeight:0,whereFitsChunk:function(a,b){if(a>this.width||b>this.height)return null;for(var c,d,e=0;e<=this.scanMapHeight-b;){var f=null;for(c=!1;e<=this.scanMapHeight-b;e++)if(f=this.scanMap[e].findWhereFits(a),null!==f&&0<f.length){c=!0;break}if(!c)break;for(d=0;d<f.length;d++){var g=!0;for(c=e;e+b>c;c++)if(!this.scanMap[c].fits(f[d],a)){g=!1;break}if(g)return{x:f[d],y:e}}e++}return null},substract:function(a,b,c,d){for(var e=0;d>e;e++)this.scanMap[e+b].substract(a,c)||CAAT.log("Error: removing chunk ",c,d," at ",a,b)},log:function(){for(var a=0;a<this.scanMapHeight;a++)this.scanMap[a].log(a)}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePage",depends:["CAAT.Module.TexturePacker.TextureScanMap"],extendsWith:{__init:function(a,b){return this.width=a||1024,this.height=b||1024,this.images=[],this},width:1024,height:1024,gl:null,texture:null,allowImagesInvertion:!1,padding:4,scan:null,images:null,criteria:"area",initialize:function(a){this.gl=a,a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(var b=new Uint8Array(this.width*this.height*4),c=0;c<4*this.width*this.height;)b[c++]=0,b[c++]=0,b[c++]=0,b[c++]=0;for(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,b),a.enable(a.BLEND),b=0;b<this.images.length;b++)c=this.images[b],c.inverted&&(c=CAAT.Module.Image.ImageUtil.rotate(c,-90)),a.texSubImage2D(a.TEXTURE_2D,0,this.images[b].__tx,this.images[b].__ty,a.RGBA,a.UNSIGNED_BYTE,c)},create:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].image;d.__texturePage||b.push(d)}this.createFromImages(b)},clear:function(){this.createFromImages([])},update:function(a,b,c,d){this.allowImagesInvertion=a,this.padding=b,100>c&&(c=100),100>d&&(d=100),this.width=c,this.height=d,this.createFromImages(this.images)},createFromImages:function(a){var b;if(this.scan=new CAAT.Module.TexturePacker.TextureScanMap(this.width,this.height),this.images=[],this.allowImagesInvertion)for(b=0;b<a.length;b++)a[b].inverted=this.allowImagesInvertion&&a[b].height<a[b].width;var c=this;for(a.sort(function(a,b){var d=a.width*a.height,e=b.width*b.height;return"width"===c.criteria?a.width<b.width?1:a.width>b.width?-1:0:"height"===c.criteria?a.height<b.height?1:a.height>b.height?-1:0:e>d?1:d>e?-1:0}),b=0;b<a.length;b++)this.packImage(a[b])},addImage:function(a,b,c){this.allowImagesInvertion=b,this.padding=c,this.images.push(a),this.createFromImages(Array.prototype.slice.call(this.images))},endCreation:function(){var a=this.gl;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.generateMipmap(a.TEXTURE_2D)},deletePage:function(){for(var a=0;a<this.images.length;a++)delete this.images[a].__texturePage,delete this.images[a].__u,delete this.images[a].__v;this.gl.deleteTexture(this.texture)},toCanvas:function(a,b){a=a||document.createElement("canvas"),a.width=this.width,a.height=this.height;var c=a.getContext("2d");c.fillStyle="rgba(0,0,0,0)",c.fillRect(0,0,this.width,this.height);for(var d=0;d<this.images.length;d++)c.drawImage(this.images[d].inverted?CAAT.Modules.Image.ImageUtil.rotate(this.images[d],90):this.images[d],this.images[d].__tx,this.images[d].__ty),b&&(c.strokeStyle="red",c.strokeRect(this.images[d].__tx,this.images[d].__ty,this.images[d].__w,this.images[d].__h));return b&&(c.strokeStyle="red",c.strokeRect(0,0,this.width,this.height)),a},packImage:function(a){var b,c;a.inverted?(b=a.height,c=a.width):(b=a.width,c=a.height);var d,e=b,f=c;e&&this.padding&&(d=this.padding,e+d<=this.width&&(e+=d)),f&&this.padding&&(d=this.padding,f+d<=this.height&&(f+=d)),d=this.scan.whereFitsChunk(e,f),null!==d?(this.images.push(a),a.__tx=d.x,a.__ty=d.y,a.__u=d.x/this.width,a.__v=d.y/this.height,a.__u1=(d.x+b)/this.width,a.__v1=(d.y+c)/this.height,a.__texturePage=this,a.__w=b,a.__h=c,this.scan.substract(d.x,d.y,e,f)):CAAT.log("Imagen ",a.src," de tamano ",a.width,a.height," no cabe.")},changeHeuristic:function(a){this.criteria=a}}}),CAAT.Module({defines:"CAAT.Module.TexturePacker.TexturePageManager",depends:["CAAT.Module.TexturePacker.TexturePage"],extendsWith:{__init:function(){return this.pages=[],this},pages:null,createPages:function(a,b,c,d){for(var e=!1;!e;){e=new CAAT.Module.TexturePacker.TexturePage(b,c),e.create(d),e.initialize(a),e.endCreation(),this.pages.push(e);for(var e=!0,f=0;f<d.length;f++)if(!d[f].image.__texturePage){d[f].image.width<=b&&d[f].image.height<=c&&(e=!1);break}}},deletePages:function(){for(var a=0;a<this.pages.length;a++)this.pages[a].deletePage();this.pages=null}}}),CAAT.Module({defines:"CAAT.Module.LayoutUtils.RowLayout",constants:{Row:function(a,b,c){for(var d=a.width,e=0,f=0,g=0,h=0,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,g=b.length-1;g;g-=1)i<b[g].width&&(i=b[g].width),h<b[g].height&&(h=b[g].height);if(c.padding_left&&(e=c.padding_left,d-=e),c.padding_right&&(d-=c.padding_right),c.top&&(f=parseInt(c.top,10),isNaN(f)))switch(c.top){case"center":f=(a.height-h)/2;break;case"top":f=0;break;case"bottom":f=a.height-h;break;default:f=0}for(a=d/b.length,g=0,h=b.length;h>g;g++)b[g].setLocation(e+g*a+(a-b[g].width)/2,f)}}}),CAAT.Module({defines:"CAAT.Module.Initialization.Template",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(a,b,c,d,e){c=document.getElementById(c);var f;if(CAAT.__CSS__)c&&!1==c instanceof HTMLDivElement&&(c=null),null===c&&(c=document.createElement("div"),document.body.appendChild(c));else if(c)if(c instanceof HTMLDivElement){var g=document.createElement("canvas");c.appendChild(g),c=g}else 0==c instanceof HTMLCanvasElement&&(g=document.createElement("canvas"),document.body.appendChild(g),c=g);else c=document.createElement("canvas"),document.body.appendChild(c);f=(new CAAT.Foundation.Director).initialize(a||800,b||600,c),(new CAAT.Module.Preloader.ImagePreloader).loadImages(d,function(a,b){a===b.length&&(f.emptyScenes(),f.setImagesCache(b),e(f),f.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4)),CAAT.loop(60))})}}}),CAAT.Module({defines:"CAAT.Module.Initialization.TemplateWithSplash",depends:["CAAT.Foundation.Director","CAAT.Module.Preloader.ImagePreloader"],constants:{init:function(a,b,c,d,e,f,g,h){function i(a,b,c){var d=a.getImage("spinner"),e=a.getImage("splash"),f=a.createScene(),g=(new Date).getTime();return e&&f.addChild((new CAAT.Foundation.Actor).setBackgroundImage(e,!1).setBounds(0,0,a.width,a.height).setImageTransformation(CAAT.Foundation.SpriteImage.TR_FIXED_TO_SIZE)),d&&f.addChild((new CAAT.Foundation.Actor).setBackgroundImage(d).centerAt(f.width/2,f.height/2).addBehavior((new CAAT.Behavior.RotateBehavior).setValues(0,2*Math.PI).setFrameTime(0,1e3).setCycle(!0))),f.loadedImage=function(d,e){if(!e||d===e.length){var f=(new Date).getTime()-g;b>f?(f=Math.abs(b-f),f>b&&(f=b),setTimeout(function(){j(a,e,c)},f)):j(a,e,c)}},f}function j(a,b,c){a.emptyScenes(),a.setImagesCache(b),a.setClear(!0),c(a),a.setClear(CAAT.Foundation.Director.CLEAR_ALL),a.easeIn(0,CAAT.Foundation.Scene.EASE_SCALE,2e3,!1,CAAT.Foundation.Actor.ANCHOR_CENTER,(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(2.5,.4))}c=document.getElementById(c);var k;if(CAAT.__CSS__)c&&!1==c instanceof HTMLDivElement&&(c=null),null===c&&(c=document.createElement("div"),document.body.appendChild(c));else if(c)if(c instanceof HTMLDivElement){var l=document.createElement("canvas");c.appendChild(l),c=l}else 0==c instanceof HTMLCanvasElement&&(l=document.createElement("canvas"),document.body.appendChild(l),c=l);else c=document.createElement("canvas"),document.body.appendChild(c);k=(new CAAT.Foundation.Director).initialize(a||800,b||600,c),a=[],g&&a.push({id:"splash",url:g}),h&&a.push({id:"spinner",url:h}),k.setClear(CAAT.Foundation.Director.CLEAR_DIRTY_RECTS),(new CAAT.Module.Preloader.ImagePreloader).loadImages(a,function(a,b){if(a===b.length){k.setImagesCache(b);var c=i(k,d||5e3,f);CAAT.loop(60),e&&0<e.length?(new CAAT.Module.Preloader.ImagePreloader).loadImages(e,c.loadedImage):c.loadedImage(0,null)}})}}}),function(){CAAT.CSS={},CAAT.CSS.PREFIX=function(){for(var a="",b=["WebKit","Moz","O"],c=0;c<b.length;c++)if(window[b[c]+"CSSKeyframeRule"]){a=b[c].toLowerCase();break}return CAAT.CSS.PROP_ANIMATION="-"+a+"-animation",a}(),CAAT.CSS.applyKeyframe=function(a,b,c,d,e){a.style[CAAT.CSS.PROP_ANIMATION]=b+" "+c/1e3+"s "+d/1e3+"s linear both "+(e?"infinite":"")},CAAT.CSS.unregisterKeyframes=function(a){a=CAAT.CSS.getCSSKeyframesIndex(a),null!==a&&document.styleSheets[a.sheetIndex].deleteRule(a.index)},CAAT.CSS.registerKeyframes=function(a){var b=a.name,c=a.behavior,d=a.size,e=a.overwrite;if("undefined"==typeof b||"undefined"==typeof c)throw"Keyframes must be defined by a name and a CAAT.Behavior instance.";"undefined"==typeof d&&(d=100),"undefined"==typeof e&&(e=!1);var f=CAAT.CSS.getCSSKeyframesIndex(b);return null===f||e?(a=c.calculateKeyFramesData(CAAT.CSS.PREFIX,b,d,a.anchorX,a.anchorY),document.styleSheets&&(document.styleSheets.length||(b=document.createElement("style"),b.type="text/css",document.getElementsByTagName("head")[0].appendChild(b)),null!==f&&document.styleSheets[f.sheetIndex].deleteRule(f.index),document.styleSheets[f?f.sheetIndex:0].insertRule(a,0)),a):void 0},CAAT.CSS.getCSSKeyframesIndex=function(a){for(var b=document.styleSheets,c=b.length-1;c>=0;c--)try{for(var d=b[c],e=d.cssRules?d.cssRules:d.rules?d.rules:[],f=e.length-1;f>=0;f--)if((e[f].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||e[f].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&e[f].name===a)return{sheetIndex:c,index:f}}catch(g){}return null},CAAT.CSS.getCSSKeyframes=function(a){for(var b=document.styleSheets,c=b.length-1;c>=0;c--)try{for(var d=b[c],e=d.cssRules?d.cssRules:d.rules?d.rules:[],f=e.length-1;f>=0;f--)if((e[f].type===window.CSSRule.WEBKIT_KEYFRAMES_RULE||e[f].type===window.CSSRule.MOZ_KEYFRAMES_RULE)&&e[f].name===a)return e[f]}catch(g){}return null}}(),CAAT.Module({defines:"CAAT.PathUtil.PathSegment",depends:["CAAT.Math.Rectangle","CAAT.Math.Point","CAAT.Math.Matrix","CAAT.Math.Curve"],extendsWith:function(){return{__init:function(){return this.bbox=new CAAT.Math.Rectangle,this
},color:"#000",length:0,bbox:null,parent:null,setParent:function(a){return this.parent=a,this},setColor:function(a){return a&&(this.color=a),this},endCurvePosition:function(){},startCurvePosition:function(){},setPoints:function(){},setPoint:function(){},getPosition:function(){},getLength:function(){return this.length},getBoundingBox:function(){return this.bbox},numControlPoints:function(){},getControlPoint:function(){},endPath:function(){},getContour:function(){},updatePath:function(){},applyAsPath:function(){},transform:function(){},drawHandle:function(a,b,c){a.beginPath(),a.arc(b,c,CAAT.Math.Curve.prototype.HANDLE_SIZE/2,0,2*Math.PI,!1),a.fill()}}}}),CAAT.Module({defines:"CAAT.PathUtil.ArcPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.ArcPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,radius:0,startAngle:0,angle:2*Math.PI,arcTo:!1,setRadius:function(a){return this.radius=a,this},isArcTo:function(){return this.arcTo},setArcTo:function(a){return this.arcTo=a,this},initialize:function(a,b,c,d){return this.setInitialPosition(a,b),this.setFinalPosition(a+c,b),this.angle=d||2*Math.PI,this},applyAsPath:function(a){return a=a.ctx,this.arcTo?a.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):a.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.angle+this.startAngle,this.cw),this},setPoint:function(a,b){b>=0&&b<this.points.length&&(this.points[b]=a)},setPoints:function(a){return this.points=[],this.points[0]=a[0],this.points[1]=a[1],this.updatePath(),this},setClockWise:function(a){return this.cw=void 0!==a?a:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(a,b){for(var c=0,d=this.points.length;d>c;c++)this.points[0].x=a,this.points[0].y=b;return this},setFinalPosition:function(a,b){return this.points[1].x=a,this.points[1].y=b,this.updatePath(this.points[1]),this},endCurvePosition:function(){return this.points[0]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){return(a>1||0>a)&&(a%=1),0>a&&(a=1+a),-1===this.length?this.newPosition.set(this.points[0].x,this.points[0].y):(a=this.angle*a*(this.cw?1:-1)+this.startAngle,this.newPosition.set(this.points[0].x+this.radius*Math.cos(a),this.points[0].y+this.radius*Math.sin(a))),this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(a,b){var c=a.ctx;if(c.save(),c.strokeStyle=this.color,c.beginPath(),this.arcTo?c.arcTo(this.points[0].x,this.points[0].y,this.points[1].x,this.points[1].y,this.radius):c.arc(this.points[0].x,this.points[0].y,this.radius,this.startAngle,this.startAngle+this.angle,this.cw),c.stroke(),b){c.globalAlpha=.5,c.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(c,this.points[d].x,this.points[d].y)}c.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(a){for(var b=[],c=0;a>c;c++)b.push({x:this.points[0].x+this.radius*Math.cos(c*Math.PI/(a/2)),y:this.points[0].y+this.radius*Math.sin(c*Math.PI/(a/2))});return b},getPositionFromLength:function(a){return this.getPosition(a/this.length*(this.cw?1:-1))},updatePath:function(a){return this.points[1]===a?(this.arcTo||(this.radius=Math.sqrt((this.points[0].x-this.points[1].x)*(this.points[0].x-this.points[1].x)+(this.points[0].y-this.points[1].y)*(this.points[0].y-this.points[1].y))),this.length=this.angle*this.radius,this.startAngle=Math.atan2(this.points[1].y-this.points[0].y,this.points[1].x-this.points[0].x)):this.points[0]===a&&this.points[1].set(this.points[0].x+this.radius*Math.cos(this.startAngle),this.points[0].y+this.radius*Math.sin(this.startAngle)),this.bbox.setEmpty(),this.bbox.x=this.points[0].x-this.radius,this.bbox.y=this.points[0].y-this.radius,this.bbox.x1=this.points[0].x+this.radius,this.bbox.y1=this.points[0].y+this.radius,this.bbox.width=2*this.radius,this.bbox.height=2*this.radius,this}}}}),CAAT.Module({defines:"CAAT.PathUtil.CurvePath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Bezier"],aliases:["CAAT.CurvePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this},curve:null,newPosition:null,applyAsPath:function(a){return this.curve.applyAsPath(a),this},setPoint:function(a,b){this.curve&&this.curve.setPoint(a,b)},setPoints:function(a){var b=new CAAT.Math.Bezier;return b.setPoints(a),this.curve=b,this},setQuadric:function(a,b,c,d,e,f){var g=new CAAT.Math.Bezier;return g.setQuadric(a,b,c,d,e,f),this.curve=g,this.updatePath(),this},setCubic:function(a,b,c,d,e,f,g,h){var i=new CAAT.Math.Bezier;return i.setCubic(a,b,c,d,e,f,g,h),this.curve=i,this.updatePath(),this},updatePath:function(){return this.curve.update(),this.length=this.curve.getLength(),this.curve.getBoundingBox(this.bbox),this},getPosition:function(a){return(a>1||0>a)&&(a%=1),0>a&&(a=1+a),this.curve.solve(this.newPosition,a),this.newPosition},getPositionFromLength:function(a){return this.curve.solve(this.newPosition,a/this.length),this.newPosition},initialPositionX:function(){return this.curve.coordlist[0].x},finalPositionX:function(){return this.curve.coordlist[this.curve.coordlist.length-1].x},paint:function(a,b){this.curve.drawHandles=b,a.ctx.strokeStyle=this.color,this.curve.paint(a,b)},numControlPoints:function(){return this.curve.coordlist.length},getControlPoint:function(a){return this.curve.coordlist[a]},endCurvePosition:function(){return this.curve.endCurvePosition()},startCurvePosition:function(){return this.curve.startCurvePosition()},getContour:function(a){for(var b=[],c=0;a>=c;c++)b.push({x:c/a,y:this.getPosition(c/a).y});return b}}}}),CAAT.Module({defines:"CAAT.PathUtil.LinearPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point"],aliases:["CAAT.LinearPath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point(0,0,0),this},points:null,newPosition:null,applyAsPath:function(a){a.ctx.lineTo(this.points[1].x,this.points[1].y)},setPoint:function(a,b){0===b?this.points[0]=a:1===b&&(this.points[1]=a)},updatePath:function(a){a=this.points[1].x-this.points[0].x;var b=this.points[1].y-this.points[0].y;return this.length=Math.sqrt(a*a+b*b),this.bbox.setEmpty(),this.bbox.union(this.points[0].x,this.points[0].y),this.bbox.union(this.points[1].x,this.points[1].y),this},setPoints:function(a){return this.points[0]=a[0],this.points[1]=a[1],this.updatePath(),this},setInitialPosition:function(a,b){return this.points[0].x=a,this.points[0].y=b,this.newPosition.set(a,b),this},setFinalPosition:function(a,b){return this.points[1].x=a,this.points[1].y=b,this},endCurvePosition:function(){return this.points[1]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){return(a>1||0>a)&&(a%=1),0>a&&(a=1+a),this.newPosition.set(this.points[0].x+(this.points[1].x-this.points[0].x)*a,this.points[0].y+(this.points[1].y-this.points[0].y)*a),this.newPosition},getPositionFromLength:function(a){return this.getPosition(a/this.length)},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[1].x},paint:function(a,b){var c=a.ctx;c.save(),c.strokeStyle=this.color,c.beginPath(),c.moveTo(this.points[0].x,this.points[0].y),c.lineTo(this.points[1].x,this.points[1].y),c.stroke(),b&&(c.globalAlpha=.5,c.fillStyle="#7f7f00",c.beginPath(),this.drawHandle(c,this.points[0].x,this.points[0].y),this.drawHandle(c,this.points[1].x,this.points[1].y)),c.restore()},numControlPoints:function(){return 2},getControlPoint:function(a){return 0===a?this.points[0]:1===a?this.points[1]:void 0},getContour:function(a){return a=[],a.push(this.getPosition(0).clone()),a.push(this.getPosition(1).clone()),a}}}}),CAAT.Module({defines:"CAAT.PathUtil.RectPath",depends:["CAAT.PathUtil.PathSegment","CAAT.Math.Point","CAAT.Math.Rectangle"],aliases:["CAAT.RectPath","CAAT.ShapePath"],extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:function(){return{__init:function(){return this.__super(),this.points=[],this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.points.push(new CAAT.Math.Point),this.newPosition=new CAAT.Math.Point,this},points:null,cw:!0,newPosition:null,applyAsPath:function(a){return a=a.ctx,this.cw?(a.lineTo(this.points[0].x,this.points[0].y),a.lineTo(this.points[1].x,this.points[1].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[4].x,this.points[4].y)):(a.lineTo(this.points[4].x,this.points[4].y),a.lineTo(this.points[3].x,this.points[3].y),a.lineTo(this.points[2].x,this.points[2].y),a.lineTo(this.points[1].x,this.points[1].y),a.lineTo(this.points[0].x,this.points[0].y)),this},setPoint:function(a,b){b>=0&&b<this.points.length&&(this.points[b]=a)},setPoints:function(a){return this.points=[],this.points.push(a[0]),this.points.push((new CAAT.Math.Point).set(a[1].x,a[0].y)),this.points.push(a[1]),this.points.push((new CAAT.Math.Point).set(a[0].x,a[1].y)),this.points.push(a[0].clone()),this.updatePath(),this},setClockWise:function(a){return this.cw=void 0!==a?a:!0,this},isClockWise:function(){return this.cw},setInitialPosition:function(a,b){for(var c=0,d=this.points.length;d>c;c++)this.points[c].x=a,this.points[c].y=b;return this},setFinalPosition:function(a,b){return this.points[2].x=a,this.points[2].y=b,this.points[1].x=a,this.points[1].y=this.points[0].y,this.points[3].x=this.points[0].x,this.points[3].y=b,this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y,this.updatePath(),this},endCurvePosition:function(){return this.points[4]},startCurvePosition:function(){return this.points[0]},getPosition:function(a){if((a>1||0>a)&&(a%=1),0>a&&(a=1+a),-1===this.length)this.newPosition.set(0,0);else{var b,c=this.bbox.width/this.length,d=this.bbox.height/this.length,e=0,f=0;for(this.cw?(b=[0,1,2,3,4],c=[c,d,c,d]):(b=[4,3,2,1,0],c=[d,c,d,c]);f<c.length&&e+c[f]<a;)e+=c[f],f++;a-=e,e=b[f],b=b[f+1],this.newPosition.set(this.points[e].x+(this.points[b].x-this.points[e].x)*a/c[f],this.points[e].y+(this.points[b].y-this.points[e].y)*a/c[f])}return this.newPosition},initialPositionX:function(){return this.points[0].x},finalPositionX:function(){return this.points[2].x},paint:function(a,b){var c=a.ctx;if(c.save(),c.strokeStyle=this.color,c.beginPath(),c.strokeRect(this.bbox.x,this.bbox.y,this.bbox.width,this.bbox.height),b){c.globalAlpha=.5,c.fillStyle="#7f7f00";for(var d=0;d<this.points.length;d++)this.drawHandle(c,this.points[d].x,this.points[d].y)}c.restore()},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},getContour:function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b]);return a},updatePath:function(a){for(a&&(a===this.points[0]?(this.points[1].y=a.y,this.points[3].x=a.x):a===this.points[1]?(this.points[0].y=a.y,this.points[2].x=a.x):a===this.points[2]?(this.points[3].y=a.y,this.points[1].x=a.x):a===this.points[3]&&(this.points[0].x=a.x,this.points[2].y=a.y),this.points[4].x=this.points[0].x,this.points[4].y=this.points[0].y),this.bbox.setEmpty(),a=0;4>a;a++)this.bbox.union(this.points[a].x,this.points[a].y);return this.length=2*this.bbox.width+2*this.bbox.height,this.points[0].x=this.bbox.x,this.points[0].y=this.bbox.y,this.points[1].x=this.bbox.x+this.bbox.width,this.points[1].y=this.bbox.y,this.points[2].x=this.bbox.x+this.bbox.width,this.points[2].y=this.bbox.y+this.bbox.height,this.points[3].x=this.bbox.x,this.points[3].y=this.bbox.y+this.bbox.height,this.points[4].x=this.bbox.x,this.points[4].y=this.bbox.y,this},getPositionFromLength:function(a){return this.getPosition(a/(2*this.bbox.width+2*this.bbox.height))}}}}),CAAT.Module({defines:"CAAT.PathUtil.Path",aliases:["CAAT.Path"],depends:"CAAT.PathUtil.PathSegment CAAT.PathUtil.ArcPath CAAT.PathUtil.CurvePath CAAT.PathUtil.LinearPath CAAT.PathUtil.RectPath CAAT.Math.Bezier CAAT.Math.CatmullRom CAAT.Math.Point CAAT.Math.Matrix".split(" "),extendsClass:"CAAT.PathUtil.PathSegment",extendsWith:{__init:function(){return this.__super(),this.newPosition=new CAAT.Math.Point(0,0,0),this.pathSegments=[],this.behaviorList=[],this.matrix=new CAAT.Math.Matrix,this.tmpMatrix=new CAAT.Math.Matrix,this},pathSegments:null,pathSegmentDurationTime:null,pathSegmentStartTime:null,newPosition:null,pathLength:-1,beginPathX:-1,beginPathY:-1,trackPathX:-1,trackPathY:-1,ax:-1,ay:-1,point:[],interactive:!0,behaviorList:null,rb_angle:0,rb_rotateAnchorX:.5,rb_rotateAnchorY:.5,sb_scaleX:1,sb_scaleY:1,sb_scaleAnchorX:.5,sb_scaleAnchorY:.5,tAnchorX:0,tAnchorY:0,tb_x:0,tb_y:0,matrix:null,tmpMatrix:null,pathPoints:null,width:0,height:0,clipOffsetX:0,clipOffsetY:0,closed:!1,applyAsPath:function(a){var b=a.ctx;a.modelViewMatrix.transformRenderingContext(b),b.globalCompositeOperation="source-out",b.moveTo(this.getFirstPathSegment().startCurvePosition().x,this.getFirstPathSegment().startCurvePosition().y);for(var c=0;c<this.pathSegments.length;c++)this.pathSegments[c].applyAsPath(a);return b.globalCompositeOperation="source-over",this},setInteractive:function(a){return this.interactive=a,this},getFirstPathSegment:function(){return this.pathSegments.length?this.pathSegments[0]:null},getLastPathSegment:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1]:null},endCurvePosition:function(){return this.pathSegments.length?this.pathSegments[this.pathSegments.length-1].endCurvePosition():(new CAAT.Math.Point).set(this.beginPathX,this.beginPathY)},startCurvePosition:function(){return this.pathSegments[0].startCurvePosition()},getCurrentPathSegment:function(){return this.pathSegments[this.pathSegments.length-1]},setLinear:function(a,b,c,d){return this.pathSegments=[],this.beginPath(a,b),this.addLineTo(c,d),this.endPath(),this},setQuadric:function(a,b,c,d,e,f){return this.beginPath(a,b),this.addQuadricTo(c,d,e,f),this.endPath(),this},setCubic:function(a,b,c,d,e,f,g,h){return this.beginPath(a,b),this.addCubicTo(c,d,e,f,g,h),this.endPath(),this},setRectangle:function(a,b,c,d){return this.beginPath(a,b),this.addRectangleTo(c,d),this.endPath(),this},setCatmullRom:function(a,b){b&&(a=a.slice(0),a.unshift(a[a.length-1]),a.push(a[1]),a.push(a[2]));for(var c=1;c<a.length-2;c++){var d=(new CAAT.PathUtil.CurvePath).setColor("#000").setParent(this),e=(new CAAT.Math.CatmullRom).setCurve(a[c-1],a[c],a[c+1],a[c+2]);d.curve=e,this.pathSegments.push(d)}return this},addSegment:function(a){return a.setParent(this),this.pathSegments.push(a),this},addArcTo:function(a,b,c,d,e,f,g){return f=new CAAT.PathUtil.ArcPath,f.setArcTo(!0),f.setRadius(e),f.setInitialPosition(a,b).setFinalPosition(c,d),f.setParent(this),f.setColor(g),this.pathSegments.push(f),this},addRectangleTo:function(a,b,c,d){var e=new CAAT.PathUtil.RectPath;return e.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b)]),e.setClockWise(c),e.setColor(d),e.setParent(this),this.pathSegments.push(e),this},addQuadricTo:function(a,b,c,d,e){var f=new CAAT.Math.Bezier;return f.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b),(new CAAT.Math.Point).set(c,d)]),this.trackPathX=c,this.trackPathY=d,a=(new CAAT.PathUtil.CurvePath).setColor(e).setParent(this),a.curve=f,this.pathSegments.push(a),this},addCubicTo:function(a,b,c,d,e,f,g){var h=new CAAT.Math.Bezier;return h.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b),(new CAAT.Math.Point).set(c,d),(new CAAT.Math.Point).set(e,f)]),this.trackPathX=e,this.trackPathY=f,a=(new CAAT.PathUtil.CurvePath).setColor(g).setParent(this),a.curve=h,this.pathSegments.push(a),this},addCatmullTo:function(a,b,c,d,e,f,g){return g=(new CAAT.Math.CatmullRom).setColor(g),g.setCurve(this.trackPathX,this.trackPathY,a,b,c,d,e,f),this.trackPathX=e,this.trackPathY=f,a=(new CAAT.PathUtil.CurvePath).setParent(this),a.curve=g,this.pathSegments.push(a),this},addLineTo:function(a,b,c){return c=(new CAAT.PathUtil.LinearPath).setColor(c),c.setPoints([this.endCurvePosition(),(new CAAT.Math.Point).set(a,b)]),c.setParent(this),this.trackPathX=a,this.trackPathY=b,this.pathSegments.push(c),this},beginPath:function(a,b){return this.trackPathX=a,this.trackPathY=b,this.beginPathX=a,this.beginPathY=b,this},closePath:function(){return this.getLastPathSegment().setPoint(this.getFirstPathSegment().startCurvePosition(),this.getLastPathSegment().numControlPoints()-1),this.trackPathX=this.beginPathX,this.trackPathY=this.beginPathY,this.closed=!0,this.endPath(),this},endPath:function(){return this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[],this.updatePath(),this},getPosition:function(a,b){if(b&&(a>=1||0>=a)){var c,d,e;a>=1?(c=this.__getPositionImpl(.999),d=this.endCurvePosition(),e=Math.atan2(d.y-c.y,d.x-c.x),c=a%1):(c=this.__getPositionImpl(.001),d=this.startCurvePosition(),e=Math.atan2(d.y-c.y,d.x-c.x),c=-a);var f=this.newPosition,g=this.getLength();return f.x=d.x+c*g*Math.cos(e),f.y=d.y+c*g*Math.sin(e),f}return this.__getPositionImpl(a)},__getPositionImpl:function(a){(a>1||0>a)&&(a%=1),0>a&&(a=1+a);for(var b,c,d=this.pathSegments,e=this.pathSegmentStartTime,f=this.pathSegmentDurationTime,g=0,h=d.length,i=this.newPosition;g!==h;){if(b=(h+g)/2|0,c=e[b],a>=c&&a<=c+f[b])return a=f[b]?(a-c)/f[b]:0,a>1?a=1:0>a&&(a=0),a=d[b].getPosition(a),i.x=a.x,i.y=a.y,i;c>a?h=b:g=b+1}return this.endCurvePosition()},getPositionFromLength:function(a){a%=this.getLength(),0>a&&(a+=this.getLength());for(var b=0,c=0;c<this.pathSegments.length;c++){if(a>=b&&a<=this.pathSegments[c].getLength()+b){a-=b,a=this.pathSegments[c].getPositionFromLength(a),this.newPosition.x=a.x,this.newPosition.y=a.y;break}b+=this.pathSegments[c].getLength()}return this.newPosition},paint:function(a){for(var b=0;b<this.pathSegments.length;b++)this.pathSegments[b].paint(a,this.interactive)},release:function(){this.ay=this.ax=-1},isEmpty:function(){return!this.pathSegments.length},getNumSegments:function(){return this.pathSegments.length},getSegment:function(a){return this.pathSegments[a]},numControlPoints:function(){return this.points.length},getControlPoint:function(a){return this.points[a]},updatePath:function(a,b){var c,d;this.length=0,this.bbox.setEmpty(),this.points=[];var e=Number.MAX_VALUE,f=Number.MAX_VALUE;for(c=0;c<this.pathSegments.length;c++)for(this.pathSegments[c].updatePath(a),this.length+=this.pathSegments[c].getLength(),this.bbox.unionRectangle(this.pathSegments[c].bbox),d=0;d<this.pathSegments[c].numControlPoints();d++){var g=this.pathSegments[c].getControlPoint(d);this.points.push(g),g.x<e&&(e=g.x),g.y<f&&(f=g.y)}for(this.clipOffsetX=-e,this.clipOffsetY=-f,this.width=this.bbox.width,this.height=this.bbox.height,this.setLocation(this.bbox.x,this.bbox.y),this.pathSegmentStartTime=[],this.pathSegmentDurationTime=[],c=0;c<this.pathSegments.length;c++)this.pathSegmentStartTime.push(0),this.pathSegmentDurationTime.push(0);for(c=0;c<this.pathSegments.length;c++)this.pathSegmentDurationTime[c]=this.getLength()?this.pathSegments[c].getLength()/this.getLength():0,c>0?this.pathSegmentStartTime[c]=this.pathSegmentStartTime[c-1]+this.pathSegmentDurationTime[c-1]:this.pathSegmentStartTime[0]=0,this.pathSegments[c].endPath();return this.extractPathPoints(),b&&b(this),this},press:function(a,b){if(this.interactive){for(var c=CAAT.Math.Curve.prototype.HANDLE_SIZE/2,d=0;d<this.pathSegments.length;d++)for(var e=0;e<this.pathSegments[d].numControlPoints();e++){var f=this.pathSegments[d].getControlPoint(e);if(a>=f.x-c&&b>=f.y-c&&a<f.x+c&&b<f.y+c)return this.point=f,void 0}this.point=null}},drag:function(a,b,c){this.interactive&&null!==this.point&&((-1===this.ax||-1===this.ay)&&(this.ax=a,this.ay=b),this.point.x+=a-this.ax,this.point.y+=b-this.ay,this.ax=a,this.ay=b,this.updatePath(this.point,c))},getContour:function(a){for(var b=[],c=0;a>=c;c++)b.push((new CAAT.Math.Point).set(c/a,this.getPosition(c/a).y,0));return b},setPoints:function(a){if(this.points.length===a.length)for(var b=0;b<a.length;b++)this.points[b].x=a[b].x,this.points[b].y=a[b].y;return this},setPoint:function(a,b){return b>=0&&b<this.points.length&&(this.points[b].x=a.x,this.points[b].y=a.y),this},emptyBehaviorList:function(){return this.behaviorList=[],this},extractPathPoints:function(){if(!this.pathPoints){var a;for(this.pathPoints=[],a=0;a<this.numControlPoints();a++)this.pathPoints.push(this.getControlPoint(a).clone())}return this},addBehavior:function(a){return this.behaviorList.push(a),this},removeBehaviour:function(a){for(var b=this.behaviorList.length-1;b;)if(this.behaviorList[b]===a){this.behaviorList.splice(b,1);break}return this},removeBehaviorById:function(a){for(var b=0;b<this.behaviorList.length;b++)this.behaviorList[b].id===a&&this.behaviorList.splice(b,1);return this},applyBehaviors:function(a){for(var b=0;b<this.behaviorList.length;b++)this.behaviorList[b].apply(a,this);for(this.setATMatrix(),b=0;b<this.numControlPoints();b++)this.setPoint(this.matrix.transformCoord(this.pathPoints[b].clone().translate(this.clipOffsetX,this.clipOffsetY)),b);return this},setATMatrix:function(){this.matrix.identity(),this.tmpMatrix.identity();var a,b,c,d,e,f,g,h,i,j,k=this.matrix.matrix;g=this.bbox;var l=g.width,m=g.height,n=g.x,o=g.y;if(g=1,i=d=0,f=1,h=this.tb_x-n-this.tAnchorX*l,j=this.tb_y-o-this.tAnchorY*m,this.rb_angle){var p=this.rb_rotateAnchorX*l+n,q=this.rb_rotateAnchorY*m+o;h+=g*p+d*q,j+=i*p+f*q,a=Math.cos(this.rb_angle),b=Math.sin(this.rb_angle),c=g,e=i,g=c*a+d*b,d=-c*b+d*a,i=e*a+f*b,f=-e*b+f*a,h+=-g*p-d*q,j+=-i*p-f*q}return(1!=this.sb_scaleX||1!=this.sb_scaleY)&&(l=this.sb_scaleAnchorX*l+n,m=this.sb_scaleAnchorY*m+o,h+=g*l+d*m,j+=i*l+f*m,g*=this.sb_scaleX,d*=this.sb_scaleY,i*=this.sb_scaleX,f*=this.sb_scaleY,h+=-g*l-d*m,j+=-i*l-f*m),k[0]=g,k[1]=d,k[2]=h,k[3]=i,k[4]=f,k[5]=j,this},setRotationAnchored:function(a,b,c){return this.rb_angle=a,this.rb_rotateAnchorX=b,this.rb_rotateAnchorY=c,this},setRotationAnchor:function(a,b){this.rb_rotateAnchorX=a,this.rb_rotateAnchorY=b},setRotation:function(a){this.rb_angle=a},setScaleAnchored:function(a,b,c,d){return this.sb_scaleX=a,this.sb_scaleAnchorX=c,this.sb_scaleY=b,this.sb_scaleAnchorY=d,this},setScale:function(a,b){return this.sb_scaleX=a,this.sb_scaleY=b,this},setScaleAnchor:function(a,b){return this.sb_scaleAnchorX=a,this.sb_scaleAnchorY=b,this},setPositionAnchor:function(a,b){return this.tAnchorX=a,this.tAnchorY=b,this},setPositionAnchored:function(a,b,c,d){return this.tb_x=a,this.tb_y=b,this.tAnchorX=c,this.tAnchorY=d,this},setPosition:function(a,b){return this.tb_x=a,this.tb_y=b,this},setLocation:function(a,b){return this.tb_x=a,this.tb_y=b,this},flatten:function(a,b){for(var c=this.getPositionFromLength(0),d=(new CAAT.PathUtil.Path).beginPath(c.x,c.y),e=0;a>e;e++)c=this.getPositionFromLength(e/a*this.length),d.addLineTo(c.x,c.y);return b?d.closePath():d.endPath(),d}}}),CAAT.Module({defines:"CAAT.PathUtil.SVGPath",depends:["CAAT.PathUtil.Path"],extendsWith:function(){function a(a,b){var c=b;0>c&&(c=0),console.log("parse error near ..."+a.substr(c,20))}return{__init:function(){},c:0,bezierInfo:null,__skipBlank:function(a,b){for(var c=a.charAt(b);b<a.length&&(" "==c||"\n"==c||"	"==c||","==c);)++b,c=a.charAt(b);return b},__maybeNumber:function(a,b){if(b<a.length-2){var c=a.charAt(b),d=a.charAt(b+1);return"-"==c||this.__isDigit(c)||"."===c&&this.__isDigit(d)}return!1},__isDigit:function(a){return a>="0"&&"9">=a},__getNumber:function(a,b,c,d){if(b=this.__skipBlank(a,b),b<a.length){var e=this.__findNumber(a,b);-1!==e?(c.push(parseFloat(a.substr(b,e))),b=this.__skipBlank(a,e),d.pos=b,d.result=0):d.result=2}else d.result=1},____getNumbers:function(a,b,c,d,e){for(var f=0;d>f&&(this.__getNumber(a,b,c,e),0==e.result);f++)b=e.pos;return b},__findNumber:function(a,b){if("-"==a.charAt(b)&&++b,!(this.__isDigit(a.charAt(b))||"."==a.charAt(b)&&this.__isDigit(a.charAt(b+1))))return-1;for(;this.__isDigit(a.charAt(b));)++b;if("."==a.charAt(b)){if(++b,!this.__isDigit(a.charAt(b)))return b;for(;this.__isDigit(a.charAt(b));)++b}return b},__parseMoveTo:function(a,b,c,d,e){var f=[];b=this.____getNumbers(a,b,f,2,e),0===e.result&&(c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY),d.beginPath(f[0],f[1]),this.__maybeNumber(a,b)&&(b=this.parseLine(a,b,c,d,e)),e.pos=b)},__parseLine:function(a,b,c,d,e){var f=[];do b=this.____getNumbers(a,b,f,2,e),c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY),d.addLineTo(f[0],f[1]);while(this.__maybeNumber(a,b));e.pos=b},__parseLineH:function(a,b,c,d,e){var f=[];do b=this.____getNumbers(a,b,f,1,e),c||(f[0]+=d.trackPathX),f[1].push(d.trackPathY),d.addLineTo(f[0],f[1]);while(this.__maybeNumber(a,b));e.pos=b},__parseLineV:function(a,b,c,d,e){var f=[d.trackPathX];do b=this.____getNumbers(a,b,f,1,e),c||(f[1]+=d.trackPathY),d.addLineTo(f[0],f[1]);while(this.__maybeNumber(a,b));e.pos=b},__parseCubic:function(a,b,c,d,e){var f=[];do{if(b=this.____getNumbers(a,b,f,6,e),0!==e.result)return;c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY,f[2]+=d.trackPathX,f[3]+=d.trackPathY,f[4]+=d.trackPathX,f[5]+=d.trackPathY),d.addCubicTo(f[0],f[1],f[2],f[3],f[4],f[5]),f.shift(),f.shift(),this.bezierInfo=f}while(this.__maybeNumber(a,b));e.pos=b},__parseCubicS:function(a,b,c,d,e){var f=[];do{if(b=this.____getNumbers(a,b,f,4,e),0!=e.result)return;c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY,f[2]+=d.trackPathX,f[3]+=d.trackPathY),d.addCubicTo(this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),f[0],f[1],f[2],f[3]),this.bezierInfo=f}while(this.__maybeNumber(b));e.pos=b},__parseQuadricS:function(a,b,c,d,e){var f=[];do{if(b=this.____getNumbers(a,b,f,4,e),0!==e.result)return;c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY);var g,h;g=this.bezierInfo[2]+(this.bezierInfo[2]-this.bezierInfo[0]),h=this.bezierInfo[3]+(this.bezierInfo[3]-this.bezierInfo[1]),d.addQuadricTo(g,h,f[0],f[1]),this.bezierInfo=[],bezierInfo.push(g),bezierInfo.push(h),bezierInfo.push(f[0]),bezierInfo.push(f[1])}while(this.__maybeNumber(b));e.pos=b},__parseQuadric:function(a,b,c,d,e){var f=[];do{if(b=this.____getNumbers(a,b,f,4,e),0!==e.result)return;c||(f[0]+=d.trackPathX,f[1]+=d.trackPathY,f[2]+=d.trackPathX,f[3]+=d.trackPathY),d.addQuadricTo(f[0],f[1],f[2],f[3]),this.bezierInfo=f}while(this.__maybeNumber(b));e.pos=b},__parseClosePath:function(a,b,c,d){c.closePath(),d.pos=b},parsePath:function(b){this.c=0,this.contours=[];var c=new CAAT.PathUtil.Path;if(this.contours.push(c),this.c=this.__skipBlank(b,this.c),this.c===b.length)return c;for(var d={pos:0,result:0};this.c!=b.length;){switch(b.charAt(this.c)){case"m":this.__parseMoveTo(b,this.c+1,!1,c,d);break;case"M":this.__parseMoveTo(b,this.c+1,!0,c,d);break;case"c":this.__parseCubic(b,this.c+1,!1,c,d);break;case"C":this.__parseCubic(b,this.c+1,!0,c,d);break;case"s":this.__parseCubicS(b,this.c+1,!1,c,d);break;case"S":this.__parseCubicS(b,this.c+1,!0,c,d);break;case"q":this.__parseQuadric(b,this.c+1,!1,c,d);break;case"Q":this.__parseQuadricS(b,this.c+1,!0,c,d);break;case"t":this.__parseQuadricS(b,this.c+1,!1,c,d);break;case"T":this.__parseQuadric(b,this.c+1,!0,c,d);break;case"l":this.__parseLine(b,this.c+1,!1,c,d);break;case"L":this.__parseLine(b,this.c+1,!0,c,d);break;case"h":this.__parseLineH(b,this.c+1,!1,c,d);break;case"H":this.__parseLineH(b,this.c+1,!0,c,d);break;case"v":this.__parseLineV(b,this.c+1,!1,c,d);break;case"V":this.__parseLineV(b,this.c+1,!0,c,d);break;case"z":case"Z":this.__parseClosePath(b,this.c+1,c,d),c=new CAAT.PathUtil.Path,this.contours.push(c);break;case 0:break;default:a(b,this.c)}if(0!=d.result){a(b,this.c);break}this.c=d.pos}for(c=0,d=null,b=0;b<this.contours.length;b++)this.contours[b].isEmpty()||(d=this.contours[b],d.closed||d.endPath(),c++);if(1===c)return d;for(c=new CAAT.PathUtil.Path,b=0;b<this.contours.length;b++)this.contours[b].isEmpty()||c.addSegment(this.contours[b]);return c.endPath()}}}}),CAAT.Module({defines:"CAAT.WebGL.GLU",depends:["CAAT.Math.Matrix3"],constants:{makePerspective:function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);var f=-a;return makeFrustum(f*b,a*b,f,a,c,d,e)},makeFrustum:function(a,b,c,d,e,f,g){var h=2*e/(b-a),i=2*e/(d-c);return a=(b+a)/(b-a),c=(d+c)/(d-c),d=-(f+e)/(f-e),e=-2*f*e/(f-e),(new CAAT.Math.Matrix3).initWithMatrix([[h,0,a,-g/2],[0,-i,c,g/2],[0,0,d,e],[0,0,-1,0]])},makeOrtho:function(a,b,c,d,e,f){var g=-(b+a)/(b-a),h=-(d+c)/(d-c),i=-(f+e)/(f-e);return(new CAAT.Math.Matrix3).initWithMatrix([[2/(b-a),0,0,g],[0,2/(d-c),0,h],[0,0,-2/(f-e),i],[0,0,0,1]])}}}),CAAT.Module({defines:"CAAT.WebGL.Program",extendsWith:{__init:function(a){return this.gl=a,this},shaderProgram:null,gl:null,setAlpha:function(){},getShader:function(a,b,c){if("x-shader/x-fragment"===b)b=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==b)return null;b=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(b,c),a.compileShader(b),a.getShaderParameter(b,a.COMPILE_STATUS)?b:(alert(a.getShaderInfoLog(b)),null)},getDomShader:function(a,b){var c=document.getElementById(b);if(!c)return null;for(var d="",e=c.firstChild;e;)3===e.nodeType&&(d+=e.textContent),e=e.nextSibling;if("x-shader/x-fragment"===c.type)c=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==c.type)return null;c=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(c,d),a.compileShader(c),a.getShaderParameter(c,a.COMPILE_STATUS)?c:(alert(a.getShaderInfoLog(c)),null)},initialize:function(){return this},getFragmentShader:function(){return null},getVertexShader:function(){return null},create:function(){var a=this.gl;return this.shaderProgram=a.createProgram(),a.attachShader(this.shaderProgram,this.getVertexShader()),a.attachShader(this.shaderProgram,this.getFragmentShader()),a.linkProgram(this.shaderProgram),a.useProgram(this.shaderProgram),this},setMatrixUniform:function(a){this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,new Float32Array(a.flatten()))},useProgram:function(){return this.gl.useProgram(this.shaderProgram),this}}}),CAAT.Module({defines:"CAAT.WebGL.ColorProgram",aliases:["CAAT.ColorProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){return this.__super(a),this},colorBuffer:null,vertexPositionBuffer:null,vertexPositionArray:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec4 color; \nvoid main(void) { \n  gl_FragColor = color;\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec4 aColor; \nuniform mat4 uPMatrix; \nvarying vec4 color; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \ncolor= aColor; \n}\n")},initialize:function(){return this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.vertexColorAttribute=this.gl.getAttribLocation(this.shaderProgram,"aColor"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexColorAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.useProgram(),this.colorBuffer=this.gl.createBuffer(),this.setColor([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(6144),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),CAAT.ColorProgram.superclass.initialize.call(this)
},setColor:function(a){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexColorAttribute,this.colorBuffer,this.gl.FLOAT,!1,0,0)}}}),CAAT.Module({defines:"CAAT.WebGL.TextureProgram",aliases:["CAAT.TextureProgram"],extendsClass:"CAAT.WebGL.Program",depends:["CAAT.WebGL.Program"],extendsWith:{__init:function(a){return this.__super(a),this},vertexPositionBuffer:null,vertexPositionArray:null,vertexUVBuffer:null,vertexUVArray:null,vertexIndexBuffer:null,linesBuffer:null,prevAlpha:-1,prevR:-1,prevG:-1,prevB:-1,prevA:-1,prevTexture:null,getFragmentShader:function(){return this.getShader(this.gl,"x-shader/x-fragment","#ifdef GL_ES \nprecision highp float; \n#endif \nvarying vec2 vTextureCoord; \nuniform sampler2D uSampler; \nuniform float alpha; \nuniform bool uUseColor;\nuniform vec4 uColor;\nvoid main(void) { \nif ( uUseColor ) {\n  gl_FragColor= vec4(uColor.r*alpha, uColor.g*alpha, uColor.b*alpha, uColor.a*alpha);\n} else { \n  vec4 textureColor= texture2D(uSampler, vec2(vTextureCoord)); \n  gl_FragColor = vec4(textureColor.r*alpha, textureColor.g*alpha, textureColor.b*alpha, textureColor.a * alpha ); \n}\n}\n")},getVertexShader:function(){return this.getShader(this.gl,"x-shader/x-vertex","attribute vec3 aVertexPosition; \nattribute vec2 aTextureCoord; \nuniform mat4 uPMatrix; \nvarying vec2 vTextureCoord; \nvoid main(void) { \ngl_Position = uPMatrix * vec4(aVertexPosition, 1.0); \nvTextureCoord = aTextureCoord;\n}\n")},useProgram:function(){CAAT.TextureProgram.superclass.useProgram.call(this),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},initialize:function(){var a;this.linesBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBuffer);var b=[];for(a=0;1024>a;a++)b[a]=a;for(this.linesBufferArray=new Uint16Array(b),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.linesBufferArray,this.gl.DYNAMIC_DRAW),this.shaderProgram.vertexPositionAttribute=this.gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),this.gl.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),this.shaderProgram.textureCoordAttribute=this.gl.getAttribLocation(this.shaderProgram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.shaderProgram.textureCoordAttribute),this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix"),this.shaderProgram.samplerUniform=this.gl.getUniformLocation(this.shaderProgram,"uSampler"),this.shaderProgram.alphaUniform=this.gl.getUniformLocation(this.shaderProgram,"alpha"),this.shaderProgram.useColor=this.gl.getUniformLocation(this.shaderProgram,"uUseColor"),this.shaderProgram.color=this.gl.getUniformLocation(this.shaderProgram,"uColor"),this.setAlpha(1),this.setUseColor(!1),this.vertexPositionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexPositionBuffer),this.vertexPositionArray=new Float32Array(49152),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexPositionArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,3,this.gl.FLOAT,!1,0,0),this.vertexUVBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexUVBuffer),this.vertexUVArray=new Float32Array(32768),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexUVArray,this.gl.DYNAMIC_DRAW),this.gl.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,2,this.gl.FLOAT,!1,0,0),this.vertexIndexBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),b=[],a=0;4096>a;a++)b.push(0+4*a),b.push(1+4*a),b.push(2+4*a),b.push(0+4*a),b.push(2+4*a),b.push(3+4*a);return this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),this.gl.DYNAMIC_DRAW),CAAT.TextureProgram.superclass.initialize.call(this)},setUseColor:function(a,b,c,d,e){this.gl.uniform1i(this.shaderProgram.useColor,a?1:0),!a||this.prevA===e&&this.prevR===b&&this.prevG===c&&this.prevB===d||(this.gl.uniform4f(this.shaderProgram.color,b,c,d,e),this.prevA=e,this.prevR=b,this.prevG=c,this.prevB=d)},setTexture:function(a){if(this.prevTexture!==a){var b=this.gl;b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,a),b.uniform1i(this.shaderProgram.samplerUniform,0),this.prevTexture=a}return this},updateVertexBuffer:function(a){var b=this.gl;return b.bindBuffer(b.ARRAY_BUFFER,this.vertexPositionBuffer),b.bufferSubData(b.ARRAY_BUFFER,0,a),this},updateUVBuffer:function(a){var b=this.gl;return b.bindBuffer(b.ARRAY_BUFFER,this.vertexUVBuffer),b.bufferSubData(b.ARRAY_BUFFER,0,a),this},setAlpha:function(a){return this.prevAlpha!==a&&(this.gl.uniform1f(this.shaderProgram.alphaUniform,a),this.prevAlpha=a),this},drawLines:function(a,b,c,d,e,f,g){var h=this.gl;this.setAlpha(f),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer),h.lineWidth(g),this.updateVertexBuffer(a),this.setUseColor(!0,c,d,e,1),h.drawElements(h.LINES,b,h.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)},drawPolylines:function(a,b,c,d,e,f,g){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.linesBuffer),h.lineWidth(g),this.setAlpha(f),this.updateVertexBuffer(a),this.setUseColor(!0,c,d,e,1),h.drawElements(h.LINE_STRIP,b,h.UNSIGNED_SHORT,0),this.setAlpha(1),this.setUseColor(!1),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}}),CAAT.Module({defines:"CAAT.Event.TouchInfo",aliases:["CAAT.TouchInfo"],extendsWith:{__init:function(a,b,c,d){return this.identifier=a,this.pageX=this.clientX=b,this.pageY=this.clientY=c,this.target=d,this.time=(new Date).getTime(),this}}}),CAAT.Module({defines:"CAAT.Event.TouchEvent",aliases:["CAAT.TouchEvent"],depends:["CAAT.Event.TouchInfo"],extendsWith:{__init:function(){return this.touches=[],this.changedTouches=[],this},time:0,source:null,sourceEvent:null,shift:!1,control:!1,alt:!1,meta:!1,touches:null,changedTouches:null,init:function(a,b,c){return this.source=b,this.alt=a.altKey,this.control=a.ctrlKey,this.shift=a.shiftKey,this.meta=a.metaKey,this.sourceEvent=a,this.time=c,this},addTouch:function(a){return-1===this.touches.indexOf(a)&&this.touches.push(a),this},addChangedTouch:function(a){return-1===this.changedTouches.indexOf(a)&&this.changedTouches.push(a),this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.MouseEvent",aliases:["CAAT.MouseEvent"],depends:["CAAT.Math.Point"],extendsWith:{__init:function(){return this.point=new CAAT.Math.Point(0,0,0),this.screenPoint=new CAAT.Math.Point(0,0,0),this.touches=[],this},screenPoint:null,point:null,time:0,source:null,shift:!1,control:!1,alt:!1,meta:!1,sourceEvent:null,touches:null,init:function(a,b,c,d,e,f){return this.point.set(a,b),this.source=d,this.screenPoint=e,this.alt=c.altKey,this.control=c.ctrlKey,this.shift=c.shiftKey,this.meta=c.metaKey,this.sourceEvent=c,this.x=a,this.y=b,this.time=f,this},isAltDown:function(){return this.alt},isControlDown:function(){return this.control},isShiftDown:function(){return this.shift},isMetaDown:function(){return this.meta},getSourceEvent:function(){return this.sourceEvent}}}),CAAT.Module({defines:"CAAT.Event.KeyEvent",aliases:"CAAT.KeyEvent",extendsWith:{__init:function(a,b,c,d){this.keyCode=a,this.action=b,this.modifiers=c,this.sourceEvent=d,this.preventDefault=function(){this.sourceEvent.preventDefault()},this.getKeyCode=function(){return this.keyCode},this.getAction=function(){return this.action},this.modifiers=function(){return this.modifiers},this.isShiftPressed=function(){return this.modifiers.shift},this.isControlPressed=function(){return this.modifiers.control},this.isAltPressed=function(){return this.modifiers.alt},this.getSourceEvent=function(){return this.sourceEvent}}},onCreate:function(){CAAT.KEYS={ENTER:13,BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMALPOINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUALSIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},CAAT.Keys=CAAT.KEYS,CAAT.SHIFT_KEY=16,CAAT.CONTROL_KEY=17,CAAT.ALT_KEY=18,CAAT.ENTER_KEY=13,CAAT.KEY_MODIFIERS={alt:!1,control:!1,shift:!1}}}),CAAT.Module({defines:"CAAT.Event.Input",depends:["CAAT.Event.KeyEvent","CAAT.Event.MouseEvent","CAAT.Event.TouchEvent"],onCreate:function(){CAAT.setCursor=function(a){"iOS"!==navigator.browser&&(document.body.style.cursor=a)},CAAT.TOUCH_AS_MOUSE=1,CAAT.TOUCH_AS_MULTITOUCH=2,CAAT.TOUCH_BEHAVIOR=CAAT.TOUCH_AS_MOUSE,CAAT.windowResizeListeners=[],CAAT.registerResizeListener=function(a){CAAT.windowResizeListeners.push(a)},CAAT.unregisterResizeListener=function(a){for(var b=0;b<CAAT.windowResizeListeners.length;b++)if(a===CAAT.windowResizeListeners[b]){CAAT.windowResizeListeners.splice(b,1);break}},CAAT.keyListeners=[],CAAT.registerKeyListener=function(a){CAAT.keyListeners.push(a)},CAAT.accelerationIncludingGravity={x:0,y:0,z:0},CAAT.rotationRate={alpha:0,beta:0,gamma:0},CAAT.enableDeviceMotion=function(){function a(a){CAAT.rotationRate={alpha:0,beta:a[0],gamma:a[1]}}CAAT.prevOnDeviceMotion=null,CAAT.onDeviceMotion=null,window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(b){a([b.beta,b.gamma])},!0):window.DeviceMotionEvent?window.addEventListener("devicemotion",function(b){a([2*b.acceleration.x,2*b.acceleration.y])},!0):window.addEventListener("MozOrientation",function(b){a([45*-b.y,45*b.x])},!0)},window.addEventListener("keydown",function(a){var b=a.which?a.which:a.keyCode;if(b===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!0;else if(b===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!0;else if(b===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!0;else for(var c=0;c<CAAT.keyListeners.length;c++)CAAT.keyListeners[c](new CAAT.KeyEvent(b,"down",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))},!1),window.addEventListener("keyup",function(a){var b=a.which?a.which:a.keyCode;if(b===CAAT.SHIFT_KEY)CAAT.KEY_MODIFIERS.shift=!1;else if(b===CAAT.CONTROL_KEY)CAAT.KEY_MODIFIERS.control=!1;else if(b===CAAT.ALT_KEY)CAAT.KEY_MODIFIERS.alt=!1;else for(var c=0;c<CAAT.keyListeners.length;c++)CAAT.keyListeners[c](new CAAT.KeyEvent(b,"up",{alt:CAAT.KEY_MODIFIERS.alt,control:CAAT.KEY_MODIFIERS.control,shift:CAAT.KEY_MODIFIERS.shift},a))},!1),window.addEventListener("resize",function(a){for(a=0;a<CAAT.windowResizeListeners.length;a++)CAAT.windowResizeListeners[a].windowResized(window.innerWidth,window.innerHeight)},!1)},extendsWith:{}}),CAAT.Module({defines:"CAAT.Event.AnimationLoop",onCreate:function(){CAAT.ENDRAF=!1,CAAT.INTERVAL_ID=null,CAAT.renderEnabled=!1,CAAT.FPS=60,CAAT.NO_RAF=0,CAAT.FPS_REFRESH=500,CAAT.RAF=0,CAAT.REQUEST_ANIMATION_FRAME_TIME=0,CAAT.SET_INTERVAL=0,CAAT.FRAME_TIME=0,CAAT.currentDirector=null,CAAT.director=[],CAAT.RegisterDirector=function(a){CAAT.currentDirector||(CAAT.currentDirector=a),CAAT.director.push(a)},CAAT.getCurrentScene=function(){return CAAT.currentDirector.getCurrentScene()},CAAT.getCurrentSceneTime=function(){return CAAT.currentDirector.getCurrentScene().time},CAAT.endLoop=function(){CAAT.NO_RAF?null!==CAAT.INTERVAL_ID&&clearInterval(CAAT.INTERVAL_ID):CAAT.ENDRAF=!0,CAAT.renderEnabled=!1},CAAT.loop=function(a){if(!CAAT.renderEnabled){for(var b=0,c=CAAT.director.length;c>b;b++)CAAT.director[b].timeline=(new Date).getTime();CAAT.FPS=a||60,CAAT.renderEnabled=!0,CAAT.NO_RAF?CAAT.INTERVAL_ID=setInterval(function(){for(var a=(new Date).getTime(),b=0,c=CAAT.director.length;c>b;b++){var d=CAAT.director[b];(d.renderMode===CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS||d.needsRepaint)&&d.renderFrame()}CAAT.FRAME_TIME=a-CAAT.SET_INTERVAL,CAAT.RAF&&(CAAT.REQUEST_ANIMATION_FRAME_TIME=(new Date).getTime()-CAAT.RAF),CAAT.RAF=(new Date).getTime(),CAAT.SET_INTERVAL=a},1e3/CAAT.FPS):CAAT.renderFrameRAF()}},CAAT.renderFrameRAF=function(a){var b=CAAT;if(b.ENDRAF)b.ENDRAF=!1;else{a||(a=(new Date).getTime());var c=(new Date).getTime();b.REQUEST_ANIMATION_FRAME_TIME=b.RAF?a-b.RAF:16;for(var d=0,e=b.director.length;e>d;d++)b.director[d].renderFrame();b.RAF=a,b.FRAME_TIME=(new Date).getTime()-c,window.requestAnimFrame(b.renderFrameRAF,0)}},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/CAAT.FPS)}}()},extendsWith:function(){return{}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerTask",aliases:["CAAT.TimerTask"],extendsWith:{startTime:0,duration:0,callback_timeout:null,callback_tick:null,callback_cancel:null,owner:null,scene:null,taskId:0,remove:!1,create:function(a,b,c,d,e){return this.startTime=a,this.duration=b,this.callback_timeout=c,this.callback_tick=d,this.callback_cancel=e,this},checkTask:function(a){var b;return b=a-this.startTime,b>=this.duration?(this.remove=!0,this.callback_timeout&&this.callback_timeout(a,b,this)):this.callback_tick&&this.callback_tick(a,b,this),this},remainingTime:function(){return this.duration-(this.scene.time-this.startTime)},reset:function(a){return this.remove=!1,this.startTime=a,this.owner.ensureTimerTask(this),this},cancel:function(){return this.remove=!0,null!=this.callback_cancel&&this.callback_cancel(this.scene.time,this.scene.time-this.startTime,this),this},addTime:function(a){return this.duration+=a,this}}}),CAAT.Module({defines:"CAAT.Foundation.Timer.TimerManager",aliases:["CAAT.TimerManager"],depends:["CAAT.Foundation.Timer.TimerTask"],extendsWith:{__init:function(){return this.timerList=[],this},timerList:null,timerSequence:0,checkTimers:function(a){for(var b=this.timerList,c=b.length-1;c>=0;)b[c].remove||b[c].checkTask(a),c--},ensureTimerTask:function(a){return this.hasTimer(a)||this.timerList.push(a),this},hasTimer:function(a){for(var b=this.timerList,c=b.length-1;c>=0;){if(b[c]===a)return!0;c--}return!1},createTimer:function(a,b,c,d,e,f){return a=(new CAAT.Foundation.Timer.TimerTask).create(a,b,c,d,e),a.taskId=this.timerSequence++,a.sceneTime=f.time,a.owner=this,a.scene=f,this.timerList.push(a),a},removeExpiredTimers:function(){var a,b=this.timerList;for(a=0;a<b.length;a++)b[a].remove&&b.splice(a,1)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.LayoutManager",aliases:["CAAT.UI.LayoutManager"],depends:["CAAT.Behavior.Interpolator"],constants:{AXIS:{X:0,Y:1},ALIGNMENT:{LEFT:0,RIGHT:1,CENTER:2,TOP:3,BOTTOM:4,JUSTIFY:5}},extendsWith:function(){return{__init:function(){return this.newChildren=[],this.padding={left:2,right:2,top:2,bottom:2},this},newElementInterpolator:(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.7),moveElementInterpolator:(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(2),padding:null,invalid:!0,hgap:2,vgap:2,animated:!1,newChildren:null,setAnimated:function(a){return this.animated=a,this},setHGap:function(a){return this.hgap=a,this.invalidateLayout(),this},setVGap:function(a){return this.vgap=a,this.invalidateLayout(),this},setAllPadding:function(a){return this.padding.left=a,this.padding.right=a,this.padding.top=a,this.padding.bottom=a,this.invalidateLayout(),this},setPadding:function(a,b,c,d){return this.padding.left=a,this.padding.right=b,this.padding.top=c,this.padding.bottom=d,this.invalidateLayout(),this},addChild:function(a){this.newChildren.push(a)},removeChild:function(){},doLayout:function(){this.newChildren=[],this.invalid=!1},invalidateLayout:function(){this.invalid=!0},getMinimumLayoutSize:function(){},getPreferredLayoutSize:function(){},isValid:function(){return!this.invalid},isInvalidated:function(){return this.invalid}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BoxLayout",aliases:["CAAT.UI.BoxLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:function(){return{axis:CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y,valign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,halign:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER,setAxis:function(a){return this.axis=a,this.invalidateLayout(),this},setHorizontalAlignment:function(a){return this.halign=a,this.invalidateLayout(),this},setVerticalAlignment:function(a){return this.valign=a,this.invalidateLayout(),this},doLayout:function(a){this.axis===CAAT.Foundation.UI.Layout.LayoutManager.AXIS.Y?this.doLayoutVertical(a):this.doLayoutHorizontal(a),CAAT.Foundation.UI.Layout.BoxLayout.superclass.doLayout.call(this,a)},doLayoutHorizontal:function(a){var b,c,d,e=0,f=0,g=0;for(b=0,c=a.getNumChildren();c>b;b+=1)d=a.getChildAt(b),!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(f<d.height&&(f=d.height),e+=d.width,b>0&&(e+=this.hgap));switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:e=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:e=a.width-e-this.padding.right;break;default:e=(a.width-e)/2}for(b=0,c=a.getNumChildren();c>b;b+=1)if(d=a.getChildAt(b),!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:g=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:g=a.height-this.padding.bottom-d.height;break;default:g=(a.height-d.height)/2}this.__setActorPosition(d,e,g),e+=d.width+this.hgap}},__setActorPosition:function(a,b,c){this.animated?-1!==this.newChildren.indexOf(a)?(a.setPosition(b,c),a.setScale(0,0),a.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):a.moveTo(b,c,500,0,this.moveElementInterpolator):a.setPosition(b,c)},doLayoutVertical:function(a){var b,c,d,e=0,f=0;for(b=0,c=a.getNumChildren();c>b;b+=1)d=a.getChildAt(b),!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(e<d.width&&(e=d.width),f+=d.height,b>0&&(f+=this.vgap));switch(this.valign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP:e=this.padding.top;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM:e=a.height-f-this.padding.bottom;break;default:e=(a.height-f)/2}for(b=0,c=a.getNumChildren();c>b;b+=1)if(d=a.getChildAt(b),!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())){switch(this.halign){case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT:f=this.padding.left;break;case CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT:f=a.width-this.padding.right-d.width;break;default:f=(a.width-d.width)/2}this.__setActorPosition(d,f,e),e+=d.height+this.vgap}},getPreferredLayoutSize:function(a){var b,c,d=new CAAT.Math.Dimension,e=0,f=0;for(b=0,c=a.getNumChildren();c>b;b+=1){var g=a.getChildAt(b);!g.preventLayout&&g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(g=g.getPreferredSize(),f<g.height&&(f=g.height),e+=g.width)}return d.width=e,d.height=f,d},getMinimumLayoutSize:function(a){var b,c,d=new CAAT.Math.Dimension,e=0,f=0;for(b=0,c=a.getNumChildren();c>b;b+=1){var g=a.getChildAt(b);!g.preventLayout&&g.isVisible()&&g.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(g=g.getMinimumSize(),f<g.height&&(f=g.height),e+=g.width)}return d.width=e,d.height=f,d}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.BorderLayout",aliases:["CAAT.UI.BorderLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(){return this.__super(),this},left:null,right:null,top:null,bottom:null,center:null,addChild:function(a,b){"undefined"==typeof b&&(b="center"),CAAT.Foundation.UI.Layout.BorderLayout.superclass.addChild.call(this,a,b),"left"===b?this.left=a:"right"===b?this.right=a:"top"===b?this.top=a:"bottom"===b?this.bottom=a:this.center=a},removeChild:function(a){this.center===a?this.center=null:this.left===a?this.left=null:this.right===a?this.right=null:this.top===a?this.top=null:this.bottom===a&&(this.bottom=null)},__getChild:function(a){return"center"===a?this.center:"left"===a?this.left:"right"===a?this.right:"top"===a?this.top:"bottom"===a?this.bottom:void 0},getMinimumLayoutSize:function(a){var b;return a=new CAAT.Math.Dimension,null!=(b=this.__getChild("right"))&&(b=b.getMinimumSize(),a.width+=b.width+this.hgap,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("left"))&&(b=b.getMinimumSize(),a.width+=b.width+this.hgap,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("center"))&&(b=b.getMinimumSize(),a.width+=b.width,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("top"))&&(b=b.getMinimumSize(),a.width=Math.max(b.width,a.width),a.height+=b.height+this.vgap),null!=(b=this.__getChild("bottom"))&&(b=b.getMinimumSize(),a.width=Math.max(b.width,a.width),a.height+=b.height+this.vgap),a.width+=this.padding.left+this.padding.right,a.height+=this.padding.top+this.padding.bottom,a},getPreferredLayoutSize:function(a){var b;return a=new CAAT.Dimension,null!=(b=this.__getChild("left"))&&(b=b.getPreferredSize(),a.width+=b.width+this.hgap,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("right"))&&(b=b.getPreferredSize(),a.width+=b.width+this.hgap,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("center"))&&(b=b.getPreferredSize(),a.width+=b.width,a.height=Math.max(b.height,a.height)),null!=(b=this.__getChild("top"))&&(b=b.getPreferredSize(),a.width=Math.max(b.width,a.width),a.height+=b.height+this.vgap),null!=(b=this.__getChild("bottom"))&&(b=b.getPreferredSize(),a.width=Math.max(b.width,a.width),a.height+=b.height+this.vgap),a.width+=this.padding.left+this.padding.right,a.height+=this.padding.top+this.padding.bottom,a},doLayout:function(a){var b,c,d=this.padding.top,e=a.height-this.padding.bottom,f=this.padding.left,g=a.width-this.padding.right;null!=(b=this.__getChild("top"))&&(b.setSize(g-f,b.height),c=b.getPreferredSize(),b.setBounds(f,d,g-f,c.height),d+=c.height+this.vgap),null!=(b=this.__getChild("bottom"))&&(b.setSize(g-f,b.height),c=b.getPreferredSize(),b.setBounds(f,e-c.height,g-f,c.height),e-=c.height+this.vgap),null!=(b=this.__getChild("right"))&&(b.setSize(b.width,e-d),c=b.getPreferredSize(),b.setBounds(g-c.width,d,c.width,e-d),g-=c.width+this.hgap),null!=(b=this.__getChild("left"))&&(b.setSize(b.width,e-d),c=b.getPreferredSize(),b.setBounds(f,d,c.width,e-d),f+=c.width+this.hgap),null!=(b=this.__getChild("center"))&&b.setBounds(f,d,g-f,e-d),CAAT.Foundation.UI.Layout.BorderLayout.superclass.doLayout.call(this,a)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Layout.GridLayout",aliases:["CAAT.UI.GridLayout"],depends:["CAAT.Foundation.UI.Layout.LayoutManager","CAAT.Math.Dimension"],extendsClass:"CAAT.Foundation.UI.Layout.LayoutManager",extendsWith:{__init:function(a,b){return this.__super(),this.rows=a,this.columns=b,this},rows:0,columns:2,doLayout:function(a){for(var b=[],c=0;c<a.getNumChildren();c++){var d=a.getChildAt(c);!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime())&&b.push(d)}var e=b.length;if(0!==e.length){var f=this.rows,g=this.columns;f>0?g=Math.floor((e+f-1)/f):f=Math.floor((e+g-1)/g);for(var c=(g-1)*this.hgap,d=a.width-(this.padding.left+this.padding.right),e=Math.floor((d-c)/g),h=(f-1)*this.vgap,i=a.height-(this.padding.top+this.padding.bottom),j=Math.floor((i-h)/f),h=Math.floor((i-(j*f+h))/2),i=0,k=this.padding.left+Math.floor((d-(e*g+c))/2);g>i;i++,k+=e+this.hgap)for(var l=0,m=this.padding.top+h;f>l;l++,m+=j+this.vgap)c=l*g+i,c<b.length&&(d=b[c],!d.preventLayout&&d.isVisible()&&d.isInAnimationFrame(CAAT.getCurrentSceneTime()))&&(this.animated?(d.width!==e||d.height!==j)&&(d.setSize(e,j),-1!==this.newChildren.indexOf(d)?(d.setPosition(k+(e-d.width)/2,m),d.setScale(.01,.01),d.scaleTo(1,1,500,0,.5,.5,this.newElementInterpolator)):d.moveTo(k+(e-d.width)/2,m,500,0,this.moveElementInterpolator)):d.setBounds(k+(e-d.width)/2,m,e,j));CAAT.Foundation.UI.Layout.GridLayout.superclass.doLayout.call(this,a)}},getMinimumLayoutSize:function(a){var b,c=this.rows,d=this.columns,e=a.getNumChildren(),f=0,g=0;for(c>0?d=Math.ceil((e+c-1)/c):c=Math.ceil((e+d-1)/d),b=0;e>b;b+=1){var h=a.getChildAt(b);!h.preventLayout&&h.isVisible()&&h.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(h=h.getMinimumSize(),f<h.width&&(f=h.width),g<h.height&&(g=h.height))}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+d*f+(d-1)*this.hgap,this.padding.top+this.padding.bottom+c*g+(c-1)*this.vgap)},getPreferredLayoutSize:function(a){var b,c=this.rows,d=this.columns,e=a.getNumChildren(),f=0,g=0;for(c>0?d=Math.ceil((e+c-1)/c):c=Math.ceil((e+d-1)/d),b=0;e>b;b+=1){var h=a.getChildAt(b);!h.preventLayout&&h.isVisible()&&h.isInAnimationFrame(CAAT.getCurrentSceneTime())&&(h=h.getPreferredSize(),f<h.width&&(f=h.width),g<h.height&&(g=h.height))}return new CAAT.Math.Dimension(this.padding.left+this.padding.right+d*f+(d-1)*this.hgap,this.padding.top+this.padding.bottom+c*g+(c-1)*this.vgap)}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageHelper",extendsWith:{__init:function(a,b,c,d,e,f){return this.x=parseFloat(a),this.y=parseFloat(b),this.width=parseFloat(c),this.height=parseFloat(d),this.setGL(a/e,b/f,(a+c-1)/e,(b+d-1)/f),this},x:0,y:0,width:0,height:0,u:0,v:0,u1:0,v1:0,setGL:function(a,b,c,d){return this.u=a,this.v=b,this.u1=c,this.v1=d,this}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImageAnimationHelper",extendsWith:function(){return{__init:function(a,b,c){return this.animation=a,this.time=b,this.onEndPlayCallback=c,this},animation:null,time:0,onEndPlayCallback:null}}}),CAAT.Module({defines:"CAAT.Foundation.SpriteImage",aliases:["CAAT.SpriteImage"],depends:["CAAT.Foundation.SpriteImageHelper","CAAT.Foundation.SpriteImageAnimationHelper","CAAT.Math.Rectangle"],constants:{TR_NONE:0,TR_FLIP_HORIZONTAL:1,TR_FLIP_VERTICAL:2,TR_FLIP_ALL:3,TR_FIXED_TO_SIZE:4,TR_FIXED_WIDTH_TO_SIZE:6,TR_TILE:5},extendsWith:function(){return{__init:function(){return this.paint=this.paintN,this.setAnimationImageIndex([0]),this.mapInfo={},this.animationsMap={},1===arguments.length?this.initialize.call(this,arguments[0],1,1):3===arguments.length&&this.initialize.apply(this,arguments),this},animationImageIndex:null,prevAnimationTime:-1,changeFPS:1e3,transformation:0,spriteIndex:0,prevIndex:0,currentAnimation:null,image:null,rows:1,columns:1,width:0,height:0,singleWidth:0,singleHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0,parentOffsetX:0,parentOffsetY:0,ownerActor:null,mapInfo:null,map:null,animationsMap:null,callback:null,fontScale:1,getOwnerActor:function(){return this.ownerActor},addAnimation:function(a,b,c,d){return this.animationsMap[a]=new CAAT.Foundation.SpriteImageAnimationHelper(b,c,d),this},setAnimationEndCallback:function(a){this.callback=a},playAnimation:function(a){if(a===this.currentAnimation)return this;var b=this.animationsMap[a];return b?(this.currentAnimation=a,this.setAnimationImageIndex(b.animation),this.changeFPS=b.time,this.callback=b.onEndPlayCallback,this):this},setOwner:function(a){return this.ownerActor=a,this},getRows:function(){return this.rows},getColumns:function(){return this.columns},getWidth:function(){return this.mapInfo[this.spriteIndex].width},getHeight:function(){return this.mapInfo[this.spriteIndex].height},getWrappedImageWidth:function(){return this.image.width},getWrappedImageHeight:function(){return this.image.height},getRef:function(){var a=new CAAT.Foundation.SpriteImage;return a.image=this.image,a.rows=this.rows,a.columns=this.columns,a.width=this.width,a.height=this.height,a.singleWidth=this.singleWidth,a.singleHeight=this.singleHeight,a.mapInfo=this.mapInfo,a.offsetX=this.offsetX,a.offsetY=this.offsetY,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.animationsMap=this.animationsMap,a.parentOffsetX=this.parentOffsetX,a.parentOffsetY=this.parentOffsetY,a.scaleFont=this.scaleFont,a},setOffsetX:function(a){return this.offsetX=a,this},setOffsetY:function(a){return this.offsetY=a,this},setOffset:function(a,b){return this.offsetX=a,this.offsetY=b,this},initialize:function(a,b,c){if(a||console.log("Null image for SpriteImage."),isString(a)&&(a=CAAT.currentDirector.getImage(a)),this.parentOffsetY=this.parentOffsetX=0,this.rows=b,this.columns=c,a instanceof CAAT.Foundation.SpriteImage||a instanceof CAAT.SpriteImage){this.image=a.image;var d=a.mapInfo[0];this.width=d.width,this.height=d.height,this.parentOffsetX=d.x,this.parentOffsetY=d.y,this.width=a.mapInfo[0].width,this.height=a.mapInfo[0].height}else this.image=a,this.width=a.width,this.height=a.height,this.mapInfo={};this.singleWidth=Math.floor(this.width/c),this.singleHeight=Math.floor(this.height/b);var e,f,g;if(a.__texturePage){a.__du=this.singleWidth/a.__texturePage.width,a.__dv=this.singleHeight/a.__texturePage.height,e=this.singleWidth,f=this.singleHeight;var h=this.columns;a.inverted&&(d=e,e=f,f=d,h=this.rows),a=this.image.__tx;for(var i=this.image.__ty,j=this.image.__texturePage,d=0;b*c>d;d++){g=a+(d%h>>0)*e;var k=i+(d/h>>0)*f,l=g+e,m=k+f;g=new CAAT.Foundation.SpriteImageHelper(g,k,l-g,m-k,j.width,j.height).setGL(g/j.width,k/j.height,l/j.width,m/j.height),this.mapInfo[d]=g}}else for(d=0;b*c>d;d++)e=(d%this.columns|0)*this.singleWidth+this.parentOffsetX,f=(d/this.columns|0)*this.singleHeight+this.parentOffsetY,g=new CAAT.Foundation.SpriteImageHelper(e,f,this.singleWidth,this.singleHeight,a.width,a.height),this.mapInfo[d]=g;return this},addElementsAsImages:function(a){for(var b in this.mapInfo){var c=(new CAAT.Foundation.SpriteImage).initialize(this.image,1,1);c.addElement(0,this.mapInfo[b]),c.setSpriteIndex(0),CAAT.currentDirector.addImage(a+b,c)}},copy:function(a){return this.initialize(a,1,1),this.mapInfo=a.mapInfo,this},paintTiled:function(a,b,c,d){b=this.mapInfo[this.spriteIndex],c=new CAAT.Math.Rectangle,this.ownerActor.AABB.intersect(a.AABB,c);var e=this.getWidth(),f=this.getHeight();d=(this.offsetX-this.ownerActor.x)%e,d>0&&(d-=e);var g=(this.offsetY-this.ownerActor.y)%f;g>0&&(g-=f);var h,e=((c.width-d)/e>>0)+1,f=((c.height-g)/f>>0)+1,i=a.ctx;for(a=0;f>a;a++)for(h=0;e>h;h++)i.drawImage(this.image,b.x,b.y,b.width,b.height,c.x-this.ownerActor.x+d+h*b.width>>0,c.y-this.ownerActor.y+g+a*b.height>>0,b.width,b.height)},paintInvertedH:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a=a.ctx,a.save(),a.translate((0|c)+b.width,0|d),a.scale(-1,1),a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height),a.restore(),this},paintInvertedV:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a=a.ctx,a.save(),a.translate(0|c,d+b.height|0),a.scale(1,-1),a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height),a.restore(),this},paintInvertedHV:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a=a.ctx,a.save(),a.translate(0|c,d+b.height|0),a.scale(1,-1),a.translate(b.width,0),a.scale(-1,1),a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX>>0,this.offsetY>>0,b.width,b.height),a.restore(),this},paintN:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,b.width,b.height),this},paintAtRect:function(a,b,c,d,e,f){return b=this.mapInfo[this.spriteIndex],a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,e,f),this
},paintScaledWidth:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,this.ownerActor.width,b.height),this},paintChunk:function(a,b,c,d,e,f,g){a.drawImage(this.image,d,e,f,g,b,c,f,g)},paintTile:function(a,b,c,d){return b=this.mapInfo[b],a.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,b.width,b.height),this},paintScaled:function(a,b,c,d){return b=this.mapInfo[this.spriteIndex],a.ctx.drawImage(this.image,b.x,b.y,b.width,b.height,this.offsetX+c>>0,this.offsetY+d>>0,this.ownerActor.width,this.ownerActor.height),this},getCurrentSpriteImageCSSPosition:function(){var a=this.mapInfo[this.spriteIndex];return""+-(a.x+this.parentOffsetX-this.offsetX)+"px "+-(a.y+this.parentOffsetY-this.offsetY)+"px "+(this.ownerActor.transformation===CAAT.Foundation.SpriteImage.TR_TILE?"repeat":"no-repeat")},getNumImages:function(){return this.rows*this.columns},setUV:function(a,b){var c=this.image;if(c.__texturePage){var d=b,e=this.mapInfo[this.spriteIndex],f=e.u,g=e.v,h=e.u1,e=e.v1;(this.offsetX||this.offsetY)&&(f=c.__texturePage,g=-this.offsetY/f.height,h=(this.ownerActor.width-this.offsetX)/f.width,e=(this.ownerActor.height-this.offsetY)/f.height,f=-this.offsetX/f.width+c.__u,g+=c.__v,h+=c.__u,e+=c.__v),c.inverted?(a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e,a[d++]=f,a[d++]=g):(a[d++]=f,a[d++]=g,a[d++]=h,a[d++]=g,a[d++]=h,a[d++]=e,a[d++]=f,a[d++]=e)}},setChangeFPS:function(a){return this.changeFPS=a,this},setSpriteTransformation:function(a){this.transformation=a;var b=CAAT.Foundation.SpriteImage;switch(a){case b.TR_FLIP_HORIZONTAL:this.paint=this.paintInvertedH;break;case b.TR_FLIP_VERTICAL:this.paint=this.paintInvertedV;break;case b.TR_FLIP_ALL:this.paint=this.paintInvertedHV;break;case b.TR_FIXED_TO_SIZE:this.paint=this.paintScaled;break;case b.TR_FIXED_WIDTH_TO_SIZE:this.paint=this.paintScaledWidth;break;case b.TR_TILE:this.paint=this.paintTiled;break;default:this.paint=this.paintN}return this.ownerActor.invalidate(),this},resetAnimationTime:function(){return this.prevAnimationTime=-1,this},setAnimationImageIndex:function(a){return this.animationImageIndex=a,this.spriteIndex=a[0],this.prevAnimationTime=-1,this},setSpriteIndex:function(a){return this.spriteIndex=a,this},setSpriteIndexAtTime:function(a){if(1<this.animationImageIndex.length){if(-1===this.prevAnimationTime)this.prevAnimationTime=a,this.spriteIndex=this.animationImageIndex[0],this.prevIndex=0;else{var b;b=a-this.prevAnimationTime,b/=this.changeFPS,b%=this.animationImageIndex.length,b=Math.floor(b),b<this.prevIndex&&this.callback&&this.callback(this,a),this.prevIndex=b,this.spriteIndex=this.animationImageIndex[b]}this.ownerActor.invalidate()}},getMapInfo:function(a){return this.mapInfo[a]},initializeFromGlyphDesigner:function(a){for(var b=0;b<a.length;b++)if(0===a[b].indexOf("char ")){for(var c=a[b].substring(5).split(" "),d={x:0,y:0,width:0,height:0,xadvance:0,xoffset:0,yoffset:0},e=0;e<c.length;e++){var f=c[e].split("="),g=f[0],f=f[1];'"'===f.charAt(0)&&'"'===f.charAt(f.length-1)&&f.substring(1,f.length-1),d[g]=f}this.addElement(String.fromCharCode(d.id),d)}return this},initializeFromMap:function(a,b){this.initialize(a,1,1);var c,d,e=0;for(c in b)d=b[c],d=new CAAT.Foundation.SpriteImageHelper(parseFloat(d.x)+this.parentOffsetX,parseFloat(d.y)+this.parentOffsetY,parseFloat(d.width),parseFloat(d.height),a.width,a.height),this.mapInfo[c]=d,e||this.setAnimationImageIndex([c]),e++;return this},initializeFromTexturePackerJSON:function(a,b){for(var c in b.frames){var d=b.frames[c],d={x:d.frame.x,y:d.frame.y,width:d.spriteSourceSize.w,height:d.spriteSourceSize.h,id:"0"},e=(new CAAT.Foundation.SpriteImage).initialize(a,1,1);e.addElement(0,d),CAAT.currentDirector.addImage(c.substring(0,c.indexOf(".")),e)}},addElement:function(a,b){var c=new CAAT.Foundation.SpriteImageHelper(parseFloat(b.x)+this.parentOffsetX,parseFloat(b.y)+this.parentOffsetY,parseFloat(b.width),parseFloat(b.height),this.image.width,this.image.height);return c.xoffset="undefined"==typeof b.xoffset?0:parseFloat(b.xoffset),c.yoffset="undefined"==typeof b.yoffset?0:parseFloat(b.yoffset),c.xadvance="undefined"==typeof b.xadvance?b.width:parseFloat(b.xadvance),this.mapInfo[a]=c,this},initializeAsGlyphDesigner:function(a,b){this.initialize(a,1,1);var c,d,e=0;for(c in b){var f=b[c];d=new CAAT.Foundation.SpriteImageHelper(parseFloat(f.x)+this.parentOffsetX,parseFloat(f.y)+this.parentOffsetX,parseFloat(f.width),parseFloat(f.height),a.width,a.height),d.xoffset="undefined"==typeof f.xoffset?0:f.xoffset,d.yoffset="undefined"==typeof f.yoffset?0:f.yoffset,d.xadvance="undefined"==typeof f.xadvance?f.width:f.xadvance,this.mapInfo[c]=d,e||this.setAnimationImageIndex([c]),e++}return this},initializeAsFontMap:function(a,b){this.initialize(a,1,1);for(var c,d=0,e=0;e<b.length;e++){var f=b[e];c=new CAAT.Foundation.SpriteImageHelper(parseFloat(d)+this.parentOffsetX,0+this.parentOffsetY,parseFloat(f.width),a.height,a.width,a.height),c.xoffset=0,c.yoffset=0,c.xadvance=f.width,d+=f.width,this.mapInfo[b[e].c]=c,e||this.setAnimationImageIndex([b[e].c])}return this},initializeAsMonoTypeFontMap:function(a,b){for(var c=[],d=b.split(""),e=a.width/d.length>>0,f=0;f<d.length;f++)c.push({c:d[f],width:e});return this.initializeAsFontMap(a,c)},stringWidth:function(a){var b,c,d,e=0;for(b=0,c=a.length;c>b;b++)(d=this.mapInfo[a.charAt(b)])&&(e+=d.xadvance*this.fontScale);return e},stringHeight:function(){if(this.fontHeight)return this.fontHeight*this.fontScale;var a,b=0;for(a in this.mapInfo){var c=this.mapInfo[a],c=c.height+c.yoffset;c>b&&(b=c)}return this.fontHeight=b,this.fontHeight*this.fontScale},drawText:function(a,b,c,d){var e,f,g;for(e=0;e<a.length;e++)(f=this.mapInfo[a.charAt(e)])&&(g=f.width,g>0&&0<f.height&&b.drawImage(this.image,f.x,f.y,g,f.height,c+f.xoffset*this.fontScale,d+f.yoffset*this.fontScale,g*this.fontScale,f.height*this.fontScale),c+=f.xadvance*this.fontScale)},getFontData:function(){var a=.8*this.stringHeight()>>0;return{height:this.stringHeight(),ascent:a,descent:this.stringHeight()-a}}}}}),CAAT.Module({defines:"CAAT.Foundation.Actor",aliases:["CAAT.Actor"],depends:"CAAT.Math.Dimension CAAT.Event.AnimationLoop CAAT.Foundation.SpriteImage CAAT.Core.Constants CAAT.Behavior.PathBehavior CAAT.Behavior.RotateBehavior CAAT.Behavior.ScaleBehavior CAAT.Behavior.Scale1Behavior CAAT.PathUtil.LinearPath CAAT.Event.AnimationLoop".split(" "),constants:{ANCHOR_CENTER:0,ANCHOR_TOP:1,ANCHOR_BOTTOM:2,ANCHOR_LEFT:3,ANCHOR_RIGHT:4,ANCHOR_TOP_LEFT:5,ANCHOR_TOP_RIGHT:6,ANCHOR_BOTTOM_LEFT:7,ANCHOR_BOTTOM_RIGHT:8,ANCHOR_CUSTOM:9,CACHE_NONE:0,CACHE_SIMPLE:1,CACHE_DEEP:2},extendsWith:function(){var a=0;return{__init:function(){return this.behaviorList=[],this.lifecycleListenerList=[],this.AABB=new CAAT.Math.Rectangle,this.viewVertices=[new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0),new CAAT.Math.Point(0,0,0)],this.scaleAnchor=CAAT.Foundation.Actor.ANCHOR_CENTER,this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.resetTransform(),this.setScale(1,1),this.setRotation(0),this.id=a++,this},__super:null,lifecycleListenerList:null,behaviorList:null,parent:null,x:0,y:0,width:0,height:0,preferredSize:null,minimumSize:null,start_time:0,duration:Number.MAX_VALUE,clip:!1,clipPath:null,tAnchorX:0,tAnchorY:0,scaleX:1,scaleY:1,scaleTX:.5,scaleTY:.5,scaleAnchor:0,rotationAngle:0,rotationY:.5,rotationX:.5,alpha:1,isGlobalAlpha:!1,frameAlpha:1,expired:!1,discardable:!1,pointed:!1,mouseEnabled:!0,visible:!0,fillStyle:null,strokeStyle:null,time:0,AABB:null,viewVertices:null,inFrame:!1,dirty:!0,wdirty:!0,oldX:-1,oldY:-1,modelViewMatrix:null,worldModelViewMatrix:null,modelViewMatrixI:null,worldModelViewMatrixI:null,glEnabled:!1,backgroundImage:null,id:null,size_active:1,size_total:1,__d_ax:-1,__d_ay:-1,gestureEnabled:!1,invalid:!0,cached:0,preventLayout:!1,isAA:!0,isCachedActor:!1,setCachedActor:function(a){return this.isCachedActor=a,this},setPreventLayout:function(a){return this.preventLayout=a,this},invalidateLayout:function(){return this.parent&&!this.parent.layoutInvalidated&&this.parent.invalidateLayout(),this},__validateLayout:function(){},setPreferredSize:function(a,b){return this.preferredSize||(this.preferredSize=new CAAT.Math.Dimension),this.preferredSize.width=a,this.preferredSize.height=b,this},getPreferredSize:function(){return this.preferredSize?this.preferredSize:this.getMinimumSize()},setMinimumSize:function(a,b){return this.minimumSize||(this.minimumSize=new CAAT.Math.Dimension),this.minimumSize.width=a,this.minimumSize.height=b,this},getMinimumSize:function(){return this.minimumSize?this.minimumSize:new CAAT.Math.Dimension(this.width,this.height)},create:function(){return this},moveTo:function(a,b,c,d,e,f){if(a!==this.x||b!==this.y){var g=this.getBehavior("__moveTo");return g||(g=(new CAAT.Behavior.PathBehavior).setId("__moveTo").setValues(new CAAT.PathUtil.LinearPath),this.addBehavior(g)),g.path.setInitialPosition(this.x,this.y).setFinalPosition(a,b),g.setDelayTime(d?d:0,c),e&&g.setInterpolator(e),f&&(g.lifecycleListenerList=[],g.addListener({behaviorExpired:function(a,b,c){f(a,b,c)}})),this}},rotateTo:function(a,b,c,d,e,f){if(a!==this.rotationAngle){var g=this.getBehavior("__rotateTo");return g||(g=(new CAAT.Behavior.RotateBehavior).setId("__rotateTo").setValues(0,0,.5,.5),this.addBehavior(g)),g.setValues(this.rotationAngle,a,d,e).setDelayTime(c?c:0,b),f&&g.setInterpolator(f),this}},scaleTo:function(a,b,c,d,e,f,g){if(this.scaleX!==a||this.scaleY!==b){var h=this.getBehavior("__scaleTo");return h||(h=(new CAAT.Behavior.ScaleBehavior).setId("__scaleTo").setValues(1,1,1,1,.5,.5),this.addBehavior(h)),h.setValues(this.scaleX,a,this.scaleY,b,e,f).setDelayTime(d?d:0,c),g&&h.setInterpolator(g),this}},scaleXTo:function(a,b,c,d,e,f){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_X,a,b,c,d,e,f)},scaleYTo:function(a,b,c,d,e,f){return this.__scale1To(CAAT.Behavior.Scale1Behavior.AXIS_Y,a,b,c,d,e,f)},__scale1To:function(a,b,c,d,e,f,g){if(!(a===CAAT.Behavior.Scale1Behavior.AXIS_X&&b===this.scaleX||a===CAAT.Behavior.Scale1Behavior.AXIS_Y&&b===this.scaleY)){var h=this.getBehavior("__scaleXTo");return h||(h=(new CAAT.Behavior.Scale1Behavior).setId("__scaleXTo").setValues(1,1,a===CAAT.Behavior.Scale1Behavior.AXIS_X,.5,.5),this.addBehavior(h)),h.setValues(a?this.scaleX:this.scaleY,b,e,f).setDelayTime(d?d:0,c),g&&h.setInterpolator(g),this}},touchStart:function(){},touchMove:function(){},touchEnd:function(){},gestureStart:function(){},gestureChange:function(a,b,c){return this.gestureEnabled&&(this.setRotation(a),this.setScale(b,c)),this},gestureEnd:function(){},isVisible:function(){return this.visible},invalidate:function(){return this.invalid=!0,this},setGestureEnabled:function(a){return this.gestureEnabled=!!a,this},isGestureEnabled:function(){return this.gestureEnabled},getId:function(){return this.id},setId:function(a){return this.id=a,this},setParent:function(a){return this.parent=a,this},setBackgroundImage:function(a,b){return a?(a=a instanceof CAAT.Foundation.SpriteImage?a.getRef():isString(a)?(new CAAT.Foundation.SpriteImage).initialize(CAAT.currentDirector.getImage(a),1,1):(new CAAT.Foundation.SpriteImage).initialize(a,1,1),a.setOwner(this),this.backgroundImage=a,("undefined"==typeof b||b)&&(this.width=a.getWidth(),this.height=a.getHeight()),this.glEnabled=!0,this.invalidate()):this.backgroundImage=null,this},setSpriteIndex:function(a){return this.backgroundImage&&(this.backgroundImage.setSpriteIndex(a),this.invalidate()),this},setBackgroundImageOffset:function(a,b){return this.backgroundImage&&this.backgroundImage.setOffset(a,b),this},setAnimationImageIndex:function(a){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.backgroundImage.setAnimationImageIndex(a),this.invalidate()),this},addAnimation:function(a,b,c,d){return this.backgroundImage&&this.backgroundImage.addAnimation(a,b,c,d),this},playAnimation:function(a){return this.backgroundImage&&this.backgroundImage.playAnimation(a),this},setAnimationEndCallback:function(a){return this.backgroundImage&&this.backgroundImage.setAnimationEndCallback(a),this},resetAnimationTime:function(){return this.backgroundImage&&(this.backgroundImage.resetAnimationTime(),this.invalidate()),this},setChangeFPS:function(a){return this.backgroundImage&&this.backgroundImage.setChangeFPS(a),this},setImageTransformation:function(a){return this.backgroundImage&&this.backgroundImage.setSpriteTransformation(a),this},centerOn:function(a,b){return this.setPosition(a-this.width/2,b-this.height/2),this},centerAt:function(a,b){return this.setPosition(a-this.width*(.5-this.tAnchorX),b-this.height*(.5-this.tAnchorY)),this},getTextureGLPage:function(){return this.backgroundImage.image.__texturePage},setVisible:function(a){return this.invalidate(),CAAT.currentDirector&&CAAT.currentDirector.dirtyRectsEnabled&&!a&&this.visible&&CAAT.currentDirector.scheduleDirtyRect(this.AABB),a&&!this.visible&&(this.dirty=!0),this.visible=a,this},setOutOfFrameTime:function(){return this.setFrameTime(-1,0),this},addListener:function(a){return this.lifecycleListenerList.push(a),this},removeListener:function(a){for(var b=this.lifecycleListenerList.length;b--;)if(this.lifecycleListenerList[b]===a){this.lifecycleListenerList.splice(b,1);break}},setGlobalAlpha:function(a){return this.isGlobalAlpha=a,this},fireEvent:function(a,b){for(var c=0;c<this.lifecycleListenerList.length;c++)this.lifecycleListenerList[c].actorLifeCycleEvent(this,a,b)},setExpired:function(a){return this.expired=!0,this.fireEvent("expired",a),this},enableEvents:function(a){return this.mouseEnabled=a,this},emptyBehaviorList:function(){return this.behaviorList=[],this},setFillStyle:function(a){return this.fillStyle=a,this.invalidate(),this},setStrokeStyle:function(a){return this.strokeStyle=a,this.invalidate(),this},setPaint:function(a){return this.setFillStyle(a)},setAlpha:function(a){return this.alpha=a,this.invalidate(),this},resetTransform:function(){return this.rotationAngle=0,this.rotationY=this.rotationX=.5,this.scaleY=this.scaleX=1,this.scaleTY=this.scaleTX=.5,this.scaleAnchor=0,this.oldY=this.oldX=-1,this.dirty=!0,this},setFrameTime:function(a,b){return this.start_time=a,this.duration=b,this.expired=!1,this.dirty=!0,this},paint:function(a,b){if(this.backgroundImage)this.backgroundImage.paint(a,b,0,0);else if(this.fillStyle){var c=a.ctx;c.fillStyle=this.fillStyle,c.fillRect(0,0,this.width,this.height)}},setScale:function(a,b){return this.scaleX=a,this.scaleY=b,this.dirty=!0,this},getAnchorPercent:function(a){var b=[.5,.5,.5,0,.5,1,0,.5,1,.5,0,0,1,0,0,1,1,1];return{x:b[2*a],y:b[2*a+1]}},getAnchor:function(a){var b=0,c=0,d=CAAT.Foundation.Actor;switch(a){case d.ANCHOR_CENTER:c=b=.5;break;case d.ANCHOR_TOP:b=.5,c=0;break;case d.ANCHOR_BOTTOM:b=.5,c=1;break;case d.ANCHOR_LEFT:b=0,c=.5;break;case d.ANCHOR_RIGHT:b=1,c=.5;break;case d.ANCHOR_TOP_RIGHT:b=1,c=0;break;case d.ANCHOR_BOTTOM_LEFT:b=0,c=1;break;case d.ANCHOR_BOTTOM_RIGHT:c=b=1;break;case d.ANCHOR_TOP_LEFT:c=b=0}return{x:b,y:c}},setGlobalAnchor:function(a,b){return this.scaleTX=this.rotationX=this.tAnchorX=a,this.scaleTY=this.rotationY=this.tAnchorY=b,this.dirty=!0,this},setScaleAnchor:function(a,b){return this.scaleTX=a,this.scaleTY=b,this.dirty=!0,this},setScaleAnchored:function(a,b,c,d){return this.scaleTX=c,this.scaleTY=d,this.scaleX=a,this.scaleY=b,this.dirty=!0,this},setRotationAnchor:function(a,b){return this.rotationX=b,this.rotationY=a,this.dirty=!0,this},setRotation:function(a){return this.rotationAngle=a,this.dirty=!0,this},setRotationAnchored:function(a,b,c){return this.rotationAngle=a,this.rotationX=b,this.rotationY=c,this.dirty=!0,this},setSize:function(a,b){return this.width=a,this.height=b,this.dirty=!0,this},setBounds:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this.dirty=!0,this},setLocation:function(a,b){return this.x=a,this.y=b,this.oldX=a,this.oldY=b,this.dirty=!0,this},setPosition:function(a,b){return this.setLocation(a,b)},setPositionAnchor:function(a,b){return this.tAnchorX=a,this.tAnchorY=b,this},setPositionAnchored:function(a,b,c,d){return this.setLocation(a,b),this.tAnchorX=c,this.tAnchorY=d,this},isInAnimationFrame:function(a){return this.expired?!1:this.duration===Number.MAX_VALUE?this.start_time<=a:a>=this.start_time+this.duration?(this.expired||this.setExpired(a),!1):this.start_time<=a&&a<this.start_time+this.duration},contains:function(a,b){return a>=0&&b>=0&&a<this.width&&b<this.height},addBehavior:function(a){return this.behaviorList.push(a),this},removeBehaviour:function(a){for(var b=this.behaviorList,c=b.length-1;c;)if(b[c]===a){b.splice(c,1);break}return this},removeBehaviorById:function(a){for(var b=this.behaviorList,c=0;c<b.length;c++)b[c].id===a&&b.splice(c,1);return this},getBehavior:function(a){for(var b=this.behaviorList,c=0;c<b.length;c++){var d=b[c];if(d.id===a)return d}return null},setDiscardable:function(a){return this.discardable=a,this},destroy:function(a){this.parent&&this.parent.removeChild(this),this.fireEvent("destroyed",a),this.isCachedActor||this.clean()},clean:function(){this.backgroundImage=null,this.emptyBehaviorList(),this.lifecycleListenerList=[]},modelToView:function(a){var b,c,d,e;if(this.dirty&&this.setModelViewMatrix(),e=this.worldModelViewMatrix.matrix,a instanceof Array)for(var f=0;f<a.length;f++)d=a[f],b=d.x,c=d.y,d.x=b*e[0]+c*e[1]+e[2],d.y=b*e[3]+c*e[4]+e[5];else b=a.x,c=a.y,a.x=b*e[0]+c*e[1]+e[2],a.y=b*e[3]+c*e[4]+e[5];return a},modelToModel:function(a,b){return this.dirty&&this.setModelViewMatrix(),b.viewToModel(this.modelToView(a))},viewToModel:function(a){return this.dirty&&this.setModelViewMatrix(),this.worldModelViewMatrixI=this.worldModelViewMatrix.getInverse(),this.worldModelViewMatrixI.transformCoord(a),a},findActorAtPosition:function(a){return 0!==this.scaleX&&0!==this.scaleY&&this.visible&&this.mouseEnabled&&this.isInAnimationFrame(this.time)?(this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.modelViewMatrixI.transformCoord(a),this.contains(a.x,a.y)?this:null):null},enableDrag:function(){return this.ay=this.ax=0,this.asy=this.asx=1,this.screeny=this.screenx=this.ara=0,this.mouseEnter=function(){this.__d_ay=this.__d_ax=-1,this.pointed=!0,CAAT.setCursor("move")},this.mouseExit=function(){this.__d_ay=this.__d_ax=-1,this.pointed=!1,CAAT.setCursor("default")},this.mouseMove=function(){},this.mouseUp=function(){this.__d_ay=this.__d_ax=-1},this.mouseDrag=function(a){var b;if(b=this.modelToView(new CAAT.Math.Point(a.x,a.y)),this.parent.viewToModel(b),(-1===this.__d_ax||-1===this.__d_ay)&&(this.__d_ax=b.x,this.__d_ay=b.y,this.__d_asx=this.scaleX,this.__d_asy=this.scaleY,this.__d_ara=this.rotationAngle,this.__d_screenx=a.screenPoint.x,this.__d_screeny=a.screenPoint.y),a.isShiftDown()){var c=(a.screenPoint.x-this.__d_screenx)/100,d=(a.screenPoint.y-this.__d_screeny)/100;a.isAltDown()||(d=c=a=Math.max(c,d)),this.setScale(c+this.__d_asx,d+this.__d_asy)}else a.isControlDown()?this.setRotation(-Math.atan2(a.screenPoint.x-this.__d_screenx,a.screenPoint.y-this.__d_screeny)+this.__d_ara):(this.x+=b.x-this.__d_ax,this.y+=b.y-this.__d_ay);this.__d_ax=b.x,this.__d_ay=b.y},this},disableDrag:function(){return this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseMove=function(){},this.mouseUp=function(){},this.mouseDrag=function(){},this},mouseClick:function(){},mouseDblClick:function(){},mouseEnter:function(){this.pointed=!0},mouseExit:function(){this.pointed=!1},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseOut:function(){},mouseOver:function(){},mouseDrag:function(){},drawScreenBoundingBox:function(a){if(null!==this.AABB&&this.inFrame){var b=this.AABB,c=a.ctx;c.strokeStyle=CAAT.DEBUGAABBCOLOR,c.strokeRect(.5+(0|b.x),.5+(0|b.y),0|b.width,0|b.height),CAAT.DEBUGBB&&(b=this.viewVertices,c.beginPath(),c.lineTo(b[0].x,b[0].y),c.lineTo(b[1].x,b[1].y),c.lineTo(b[2].x,b[2].y),c.lineTo(b[3].x,b[3].y),c.closePath(),c.strokeStyle=CAAT.DEBUGBBCOLOR,c.stroke())}},animate:function(a,b){if(!this.visible)return!1;var c;if(!this.isInAnimationFrame(b))return this.inFrame=!1,this.dirty=!0,!1;for((this.x!==this.oldX||this.y!==this.oldY)&&(this.dirty=!0,this.oldX=this.x,this.oldY=this.y),c=0;c<this.behaviorList.length;c++)this.behaviorList[c].apply(b,this);return this.clipPath&&this.clipPath.applyBehaviors(b),this.setModelViewMatrix(),(this.dirty||this.wdirty||this.invalid)&&(a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB),this.setScreenBounds(),a.dirtyRectsEnabled&&a.addDirtyRect(this.AABB)),this.invalid=this.dirty=!1,this.inFrame=!0,this.backgroundImage&&this.backgroundImage.setSpriteIndexAtTime(b),this.AABB.intersects(a.AABB)},setModelViewMatrix:function(){var a,b,c,d,e,f,g,h,i,j,k;if(this.wdirty=!1,k=this.modelViewMatrix.matrix,this.dirty){if(g=1,i=d=0,f=1,h=this.x-this.tAnchorX*this.width,j=this.y-this.tAnchorY*this.height,this.rotationAngle){var l=this.rotationX*this.width,m=this.rotationY*this.height;h+=g*l+d*m,j+=i*l+f*m,a=Math.cos(this.rotationAngle),b=Math.sin(this.rotationAngle),c=g,e=i,g=c*a+d*b,d=-c*b+d*a,i=e*a+f*b,f=-e*b+f*a,h+=-g*l-d*m,j+=-i*l-f*m}(1!=this.scaleX||1!=this.scaleY)&&(a=this.scaleTX*this.width,b=this.scaleTY*this.height,h+=g*a+d*b,j+=i*a+f*b,g*=this.scaleX,d*=this.scaleY,i*=this.scaleX,f*=this.scaleY,h+=-g*a-d*b,j+=-i*a-f*b),k[0]=g,k[1]=d,k[2]=h,k[3]=i,k[4]=f,k[5]=j}this.parent?(this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY&&this.parent.isAA,(this.dirty||this.parent.wdirty)&&(this.worldModelViewMatrix.copy(this.parent.worldModelViewMatrix),this.isAA?(g=this.worldModelViewMatrix.matrix,g[2]+=k[2],g[5]+=k[5]):this.worldModelViewMatrix.multiply(this.modelViewMatrix),this.wdirty=!0)):(this.dirty&&(this.wdirty=!0),this.worldModelViewMatrix.identity(),this.isAA=0===this.rotationAngle&&1===this.scaleX&&1===this.scaleY)},setScreenBounds:function(){var a,b,c,d,e,f=this.AABB,g=this.viewVertices;return this.isAA?(a=this.worldModelViewMatrix.matrix,b=a[2],c=a[5],d=this.width,e=this.height,f.x=b,f.y=c,f.x1=b+d,f.y1=c+e,f.width=d,f.height=e,CAAT.GLRENDER&&(a=g[0],a.x=b,a.y=c,a=g[1],a.x=b+d,a.y=c,a=g[2],a.x=b+d,a.y=c+e,a=g[3],a.x=b,a.y=c+e),this):(a=g[0],a.x=0,a.y=0,a=g[1],a.x=this.width,a.y=0,a=g[2],a.x=this.width,a.y=this.height,a=g[3],a.x=0,a.y=this.height,this.modelToView(this.viewVertices),b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d=Number.MAX_VALUE,e=-Number.MAX_VALUE,a=g[0],a.x<b&&(b=a.x),a.x>c&&(c=a.x),a.y<d&&(d=a.y),a.y>e&&(e=a.y),a=g[1],a.x<b&&(b=a.x),a.x>c&&(c=a.x),a.y<d&&(d=a.y),a.y>e&&(e=a.y),a=g[2],a.x<b&&(b=a.x),a.x>c&&(c=a.x),a.y<d&&(d=a.y),a.y>e&&(e=a.y),a=g[3],a.x<b&&(b=a.x),a.x>c&&(c=a.x),a.y<d&&(d=a.y),a.y>e&&(e=a.y),f.x=b,f.y=d,f.x1=c,f.y1=e,f.width=c-b,f.height=e-d,this)},paintActor:function(a,b){if(!this.visible||!a.inDirtyRect(this))return!0;var c=a.ctx;return this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1,c.globalAlpha=this.frameAlpha,a.modelViewMatrix.transformRenderingContextSet(c),this.worldModelViewMatrix.transformRenderingContext(c),this.clip&&(c.beginPath(),this.clipPath?this.clipPath.applyAsPath(a):c.rect(0,0,this.width,this.height),c.clip()),this.paint(a,b),!0},__paintActor:function(a,b){if(!this.visible)return!0;var c=a.ctx;this.frameAlpha=this.alpha;var d=this.worldModelViewMatrix.matrix;return c.setTransform(d[0],d[3],d[1],d[4],d[2],d[5],this.frameAlpha),this.paint(a,b),!0},paintActorGL:function(a){if(this.frameAlpha=this.parent.frameAlpha*this.alpha,this.glEnabled&&this.visible)if(this.glNeedsFlush(a))a.glFlush(),this.glSetShader(a),this.__uv||(this.__uv=new Float32Array(8)),this.__vv||(this.__vv=new Float32Array(12)),this.setGLCoords(this.__vv,0),this.setUV(this.__uv,0),a.glRender(this.__vv,12,this.__uv);else{var b=a.coordsIndex;this.setGLCoords(a.coords,b),a.coordsIndex=b+12,this.setUV(a.uv,a.uvIndex),a.uvIndex+=8}},setGLCoords:function(a,b){var c=this.viewVertices;a[b++]=c[0].x,a[b++]=c[0].y,a[b++]=0,a[b++]=c[1].x,a[b++]=c[1].y,a[b++]=0,a[b++]=c[2].x,a[b++]=c[2].y,a[b++]=0,a[b++]=c[3].x,a[b++]=c[3].y,a[b]=0},setUV:function(a,b){this.backgroundImage.setUV(a,b)},glNeedsFlush:function(a){return this.getTextureGLPage()!==a.currentTexturePage||this.frameAlpha!==a.currentOpacity?!0:!1},glSetShader:function(a){var b=this.getTextureGLPage();b!==a.currentTexturePage&&a.setGLTexturePage(b),this.frameAlpha!==a.currentOpacity&&a.setGLCurrentOpacity(this.frameAlpha)},endAnimate:function(){return this},initialize:function(a){if(a)for(var b in a)this[b]=a[b];return this},setClip:function(a,b){return this.clip=a,this.clipPath=b,this},isCached:function(){return this.cached},stopCacheAsBitmap:function(){this.cached&&(this.backgroundImage=null,this.cached=CAAT.Foundation.Actor.CACHE_NONE)},cacheAsBitmap:function(a,b){if(0>=this.width||0>=this.height)return this;a=a||0;var c=document.createElement("canvas");c.width=this.width,c.height=this.height;var d=c.getContext("2d");CAAT.Foundation.Actor.prototype.animate.call(this,CAAT.currentDirector,a);var d={ctx:d,modelViewMatrix:new CAAT.Math.Matrix,worldModelViewMatrix:new CAAT.Math.Matrix,dirtyRectsEnabled:!1,inDirtyRect:function(){return!0},AABB:new CAAT.Math.Rectangle(0,0,this.width,this.height)},e=this.modelViewMatrix,f=this.worldModelViewMatrix;return this.modelViewMatrix=new CAAT.Math.Matrix,this.worldModelViewMatrix=new CAAT.Math.Matrix,this.cached=CAAT.Foundation.Actor.CACHE_NONE,"undefined"==typeof b&&(b=CAAT.Foundation.Actor.CACHE_SIMPLE),b===CAAT.Foundation.Actor.CACHE_DEEP?(this.animate(d,a),this.paintActor(d,a)):this instanceof CAAT.Foundation.ActorContainer||this instanceof CAAT.ActorContainer?CAAT.Foundation.ActorContainer.superclass.paintActor.call(this,d,a):(this.animate(d,a),this.paintActor(d,a)),this.setBackgroundImage(c),this.cached=b,this.modelViewMatrix=e,this.worldModelViewMatrix=f,this},resetAsButton:function(){return this.actionPerformed=null,this.mouseEnter=function(){},this.mouseExit=function(){},this.mouseDown=function(){},this.mouseUp=function(){},this.mouseClick=function(){},this.mouseDrag=function(){},this},setAsButton:function(a,b,c,d,e,f){return this.setBackgroundImage(a,!0),this.iNormal=b||0,this.iOver=c||this.iNormal,this.iPress=d||this.iNormal,this.iDisabled=e||this.iNormal,this.fnOnClick=f,this.enabled=!0,this.setSpriteIndex(b),this.setEnabled=function(a){return this.enabled=a,this.setSpriteIndex(this.enabled?this.iNormal:this.iDisabled),this},this.actionPerformed=function(){this.enabled&&this.fnOnClick&&this.fnOnClick(this)},this.mouseEnter=function(){this.enabled&&(this.dragging?this.setSpriteIndex(this.iPress):this.setSpriteIndex(this.iOver),CAAT.setCursor("pointer"))},this.mouseExit=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),CAAT.setCursor("default"))},this.mouseDown=function(){this.enabled&&this.setSpriteIndex(this.iPress)},this.mouseUp=function(){this.enabled&&(this.setSpriteIndex(this.iNormal),this.dragging=!1)},this.mouseClick=function(){},this.mouseDrag=function(){this.enabled&&(this.dragging=!0)},this.setButtonImageIndex=function(a,b,c,d){return this.iNormal=a||0,this.iOver=b||this.iNormal,this.iPress=c||this.iNormal,this.iDisabled=d||this.iNormal,this.setSpriteIndex(this.iNormal),this},this},findActorById:function(a){return this.id===a?this:null}}}}),CAAT.Module({defines:"CAAT.Foundation.ActorContainer",aliases:["CAAT.ActorContainer"],depends:["CAAT.Foundation.Actor","CAAT.Math.Point","CAAT.Math.Rectangle"],constants:{ADDHINT:{CONFORM:1},AddHint:{CONFORM:1}},extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var a=CAAT.Foundation.Actor.CACHE_DEEP,b=CAAT.Foundation.ActorContainer.superclass,c=b.drawScreenBoundingBox,d=b.paintActor,e=b.paintActorGL,f=b.animate,g=b.findActorAtPosition,h=b.destroy;return{__init:function(a){return this.__super(),this.childrenList=[],this.activeChildren=[],this.pendingChildrenList=[],"undefined"!=typeof a&&(this.addHint=a,this.boundingBox=new CAAT.Math.Rectangle),this},childrenList:null,activeChildren:null,pendingChildrenList:null,addHint:0,boundingBox:null,runion:new CAAT.Math.Rectangle,layoutManager:null,layoutInvalidated:!0,setLayout:function(a){return this.layoutManager=a,this},setBounds:function(a,b,c,d){return CAAT.Foundation.ActorContainer.superclass.setBounds.call(this,a,b,c,d),CAAT.currentDirector&&!CAAT.currentDirector.inValidation&&this.invalidateLayout(),this},__validateLayout:function(){this.__validateTree(),this.layoutInvalidated=!1},__validateTree:function(){if(this.layoutManager&&this.layoutManager.isInvalidated()){CAAT.currentDirector.inValidation=!0,this.layoutManager.doLayout(this);for(var a=0;a<this.getNumChildren();a+=1)this.getChildAt(a).__validateLayout()}},invalidateLayout:function(){if(this.layoutInvalidated=!0,this.layoutManager){this.layoutManager.invalidateLayout(this);for(var a=0;a<this.getNumChildren();a+=1)this.getChildAt(a).invalidateLayout()}},getLayout:function(){return this.layoutManager},drawScreenBoundingBox:function(a,b){if(this.inFrame){for(var d=this.activeChildren,e=0;e<d.length;e++)d[e].drawScreenBoundingBox(a,b);c.call(this,a,b)}},emptyChildren:function(){return this.childrenList=[],this},paintActor:function(b,c){if(!this.visible)return!1;var e=b.ctx;if(e.save(),!d.call(this,b,c)||this.cached===a)return!1;this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1);for(var f=0,g=this.activeChildren.length;g>f;++f){var h=this.activeChildren[f];h.visible&&(e.save(),h.paintActor(b,c),e.restore())}return this.postPaint&&this.postPaint(b,c),e.restore(),!0},__paintActor:function(a,b){if(!this.visible)return!0;var c=a.ctx;this.frameAlpha=this.parent?this.parent.frameAlpha*this.alpha:1;var d=this.worldModelViewMatrix.matrix;for(c.setTransform(d[0],d[3],d[1],d[4],d[2],d[5],this.frameAlpha),this.paint(a,b),this.isGlobalAlpha||(this.frameAlpha=this.parent?this.parent.frameAlpha:1),c=0,d=this.activeChildren.length;d>c;++c)this.activeChildren[c].paintActor(a,b);return!0},paintActorGL:function(a,b){var c,d,f;if(!this.visible)return!0;for(e.call(this,a,b),this.isGlobalAlpha||(this.frameAlpha=this.parent.frameAlpha),c=0,d=this.activeChildren.length;d>c;++c)f=this.activeChildren[c],f.paintActorGL(a,b)},animate:function(b,c){if(!this.visible)return!1;if(this.activeChildren=[],!1===f.call(this,b,c))return!1;if(this.cached===a)return!0;this.__validateLayout(),CAAT.currentDirector.inValidation=!1;var d,e,g=this.pendingChildrenList;for(d=0;d<g.length;d++)e=g[d],this.addChildImmediately(e.child,e.constraint);for(this.pendingChildrenList=[],g=[],e=this.childrenList,this.size_total=this.size_active=1,d=0;d<e.length;d++){var h=e[d];h.time=c,this.size_total+=h.size_total,h.animate(b,c)?(this.activeChildren.push(h),this.size_active+=h.size_active):h.expired&&h.discardable&&g.push(h)}for(d=0,e=g.length;e>d;d++)h=g[d],h.destroy(c),b.dirtyRectsEnabled&&b.addDirtyRect(h.AABB);return!0},endAnimate:function(){},addChildImmediately:function(a,b){return this.addChild(a,b)},addActorImmediately:function(a,b){return this.addChildImmediately(a,b)},addActor:function(a,b){return this.addChild(a,b)},addChild:function(a,b){if(null!=a.parent)throw"adding to a container an element with parent.";return a.parent=this,this.childrenList.push(a),a.dirty=!0,this.layoutManager?(this.layoutManager.addChild(a,b),this.invalidateLayout()):this.addHint===CAAT.Foundation.ActorContainer.AddHint.CONFORM&&this.recalcSize(),this},recalcSize:function(){var a=this.boundingBox;a.setEmpty();for(var b,c=this.childrenList,d=0;d<c.length;d++)b=c[d],this.runion.setBounds(0>b.x?0:b.x,0>b.y?0:b.y,b.width,b.height),a.unionRectangle(this.runion);return this.setSize(a.x1,a.y1),this},addChildDelayed:function(a,b){return this.pendingChildrenList.push({child:a,constraint:b}),this},addChildAt:function(a,b){return 0>=b?(a.parent=this,a.dirty=!0,this.childrenList.splice(0,0,a),this.invalidateLayout(),this):(b>=this.childrenList.length&&(b=this.childrenList.length),a.parent=this,a.dirty=!0,this.childrenList.splice(b,0,a),this.invalidateLayout(),this)},findActorById:function(a){if(CAAT.Foundation.ActorContainer.superclass.findActorById.call(this,a))return this;
for(var b=this.childrenList,c=0,d=b.length;d>c;c++){var e=b[c].findActorById(a);if(null!=e)return e}return null},findChild:function(a){var b,c=this.childrenList,d=c.length;for(b=0;d>b;b++)if(c[b]===a)return b;return-1},removeChildAt:function(a){var b=this.childrenList;return-1!==a&&a>=0&&a<this.childrenList.length?(b[a].setParent(null),a=b.splice(a,1),a[0].isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a[0].AABB),this.invalidateLayout(),a[0]):null},removeChild:function(a){return a=this.findChild(a),this.removeChildAt(a)},removeFirstChild:function(){var a=this.childrenList.shift();return a.parent=null,a.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a.AABB),this.invalidateLayout(),a},removeLastChild:function(){if(this.childrenList.length){var a=this.childrenList.pop();return a.parent=null,a.isVisible()&&CAAT.currentDirector.dirtyRectsEnabled&&CAAT.currentDirector.scheduleDirtyRect(a.AABB),this.invalidateLayout(),a}return null},findActorAtPosition:function(a){if(null===g.call(this,a))return null;for(var b=this.childrenList.length-1;b>=0;b--){var c=this.childrenList[b],d=new CAAT.Math.Point(a.x,a.y,0),c=c.findActorAtPosition(d);if(null!==c)return c}return this},destroy:function(){for(var a=this.childrenList,b=a.length-1;b>=0;b--)a[b].destroy();return h.call(this),this},getNumChildren:function(){return this.childrenList.length},getNumActiveChildren:function(){return this.activeChildren.length},getChildAt:function(a){return this.childrenList[a]},setZOrder:function(a,b){var c=this.findChild(a);if(-1!==c){var d=this.childrenList;b!==c&&(b>=d.length?(d.splice(c,1),d.push(a)):(c=d.splice(c,1),0>b?b=0:b>d.length&&(b=d.length),d.splice(b,0,c[0])),this.invalidateLayout())}}}}}),CAAT.Module({defines:"CAAT.Foundation.Scene",depends:"CAAT.Math.Point CAAT.Math.Matrix CAAT.PathUtil.Path CAAT.Behavior.GenericBehavior CAAT.Behavior.ContainerBehavior CAAT.Behavior.ScaleBehavior CAAT.Behavior.AlphaBehavior CAAT.Behavior.RotateBehavior CAAT.Behavior.PathBehavior CAAT.Foundation.ActorContainer CAAT.Foundation.Timer.TimerManager".split(" "),aliases:["CAAT.Scene"],extendsClass:"CAAT.Foundation.ActorContainer",constants:{EASE_ROTATION:1,EASE_SCALE:2,EASE_TRANSLATE:3},extendsWith:function(){return{__init:function(){return this.__super(),this.timerManager=new CAAT.TimerManager,this.fillStyle=null,this.isGlobalAlpha=!0,this},easeContainerBehaviour:null,easeContainerBehaviourListener:null,easeIn:!1,paused:!1,timerManager:null,isPaused:function(){return this.paused},setPaused:function(a){this.paused=a},createTimer:function(a,b,c,d,e){return this.timerManager.createTimer(a,b,c,d,e,this)},setTimeout:function(a,b,c,d){return this.timerManager.createTimer(this.time,a,b,c,d,this)},createAlphaBehaviour:function(a,b){var c=new CAAT.Behavior.AlphaBehavior;c.setFrameTime(0,a),c.startAlpha=b?0:1,c.endAlpha=b?1:0,this.easeContainerBehaviour.addBehavior(c)},easeTranslationIn:function(a,b,c,d){this.easeTranslation(a,b,c,!0,d)},easeTranslationOut:function(a,b,c,d){this.easeTranslation(a,b,c,!1,d)},easeTranslation:function(a,b,c,d,e){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior,this.easeIn=d;var f=new CAAT.Behavior.PathBehavior;switch(e&&f.setInterpolator(e),f.setFrameTime(0,a),1>c?c=1:c>4&&(c=4),c){case CAAT.Foundation.Actor.ANCHOR_TOP:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(0,-this.height+1,0,0)),this.setPosition(0,-this.height+1)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,-this.height+1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_BOTTOM:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(0,this.height-1,0,0)),this.setPosition(0,this.height-1)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,0,this.height-1)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_LEFT:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(-this.width+1,0,0,0)),this.setPosition(-this.width+1,0)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,-this.width+1,0)),this.setPosition(0,0));break;case CAAT.Foundation.Actor.ANCHOR_RIGHT:d?(f.setPath((new CAAT.PathUtil.Path).setLinear(this.width-1,0,0,0)),this.setPosition(this.width-1,0)):(f.setPath((new CAAT.PathUtil.Path).setLinear(0,0,this.width-1,0)),this.setPosition(0,0))}b&&this.createAlphaBehaviour(a,d),this.easeContainerBehaviour.addBehavior(f),this.easeContainerBehaviour.setFrameTime(this.time,a),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},easeScaleIn:function(a,b,c,d,e){this.easeScale(a,b,c,d,!0,e),this.easeIn=!0},easeScaleOut:function(a,b,c,d,e){this.easeScale(a,b,c,d,!1,e),this.easeIn=!1},easeScale:function(a,b,c,d,e,f){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var g=0,h=0,i=0,j=0;switch(d){case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:case CAAT.Foundation.Actor.ANCHOR_CENTER:j=i=1;break;case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:i=g=1,h=0,j=1;break;case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:j=h=1,g=0,i=1;break;default:alert("scale anchor ?? "+d)}if(!e){var k;k=g,g=i,i=k,k=h,h=j,j=k}c&&this.createAlphaBehaviour(b,e),c=this.getAnchorPercent(d),a=(new CAAT.Behavior.ScaleBehavior).setFrameTime(a,b).setValues(g,i,h,j,c.x,c.y),f&&a.setInterpolator(f),this.easeContainerBehaviour.addBehavior(a),this.easeContainerBehaviour.setFrameTime(this.time,b),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},addBehavior:function(){return this},easeRotationIn:function(a,b,c,d){this.easeRotation(a,b,c,!0,d),this.easeIn=!0},easeRotationOut:function(a,b,c,d){this.easeRotation(a,b,c,!1,d),this.easeIn=!1},easeRotation:function(a,b,c,d,e){this.easeContainerBehaviour=new CAAT.Behavior.ContainerBehavior;var f=0,g=0;switch(c==CAAT.Foundation.Actor.ANCHOR_CENTER&&(c=CAAT.Foundation.Actor.ANCHOR_TOP),c){case CAAT.Foundation.Actor.ANCHOR_TOP:case CAAT.Foundation.Actor.ANCHOR_BOTTOM:case CAAT.Foundation.Actor.ANCHOR_LEFT:case CAAT.Foundation.Actor.ANCHOR_RIGHT:f=Math.PI*(.5>Math.random()?1:-1);break;case CAAT.Foundation.Actor.ANCHOR_TOP_LEFT:case CAAT.Foundation.Actor.ANCHOR_TOP_RIGHT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_LEFT:case CAAT.Foundation.Actor.ANCHOR_BOTTOM_RIGHT:f=Math.PI/2*(.5>Math.random()?1:-1);break;default:alert("rot anchor ?? "+c)}if(!1===d)var h=f,f=g,g=h;b&&this.createAlphaBehaviour(a,d),b=this.getAnchorPercent(c),f=(new CAAT.Behavior.RotateBehavior).setFrameTime(0,a).setValues(f,g,b.x,b.y),e&&f.setInterpolator(e),this.easeContainerBehaviour.addBehavior(f),this.easeContainerBehaviour.setFrameTime(this.time,a),this.easeContainerBehaviour.addListener(this),this.emptyBehaviorList(),CAAT.Foundation.Scene.superclass.addBehavior.call(this,this.easeContainerBehaviour)},setEaseListener:function(a){this.easeContainerBehaviourListener=a},behaviorExpired:function(){this.easeContainerBehaviourListener.easeEnd(this,this.easeIn)},activated:function(){},setExpired:function(a){this.expired=a},paint:function(a){if(this.fillStyle){var b=a.ctx;b.fillStyle=this.fillStyle,b.fillRect(0,0,this.width,this.height)}},findActorAtPosition:function(a){var b,c,d=new CAAT.Math.Point;if(this.inputList){var e=this.inputList;for(b=0;b<e.length;b++){var f=e[b];for(c=0;c<f.length;c++)if(f[c].visible&&(d.set(a.x,a.y),f[c].worldModelViewMatrix.getInverse().transformCoord(d),f[c].contains(d.x,d.y)))return f[c]}}return d.set(a.x,a.y),CAAT.Foundation.Scene.superclass.findActorAtPosition.call(this,d)},enableInputList:function(a){this.inputList=[];for(var b=0;a>b;b++)this.inputList.push([]);return this},addActorToInputList:function(a,b,c){return 0>b?b=0:b>=this.inputList.length&&(b=this.inputList.length-1),b=this.inputList[b],"undefined"==typeof c||c>=b.length?b.push(a):0>=c?b.unshift(a):b.splice(c,0,a),this},emptyInputList:function(a){return 0>a?a=0:a>=this.inputList.length&&(a=this.inputList.length-1),this.inputList[a]=[],this},removeActorFromInputList:function(a,b){if("undefined"==typeof b){var c,d;for(c=0;c<this.inputList.length;c++){var e=this.inputList[c];for(d=0;d<e.length;d++)e[d]==a&&e.splice(d,1)}return this}for(0>b?b=0:b>=this.inputList.length&&(b=this.inputList.length-1),e=this.inputList[b],d=0;d<e.length;d++)e[d]==a&&e.splice(d,1);return this},getIn:function(){},goOut:function(){}}}}),CAAT.Module({defines:"CAAT.Foundation.Director",aliases:["CAAT.Director"],extendsClass:"CAAT.Foundation.ActorContainer",depends:"CAAT.Core.Class CAAT.Core.Constants CAAT.Foundation.ActorContainer CAAT.Module.Audio.AudioManager CAAT.Module.Runtime.BrowserInfo CAAT.Module.Debug.Debug CAAT.Math.Point CAAT.Math.Rectangle CAAT.Math.Matrix CAAT.Foundation.Timer.TimerManager CAAT.Foundation.Actor CAAT.Foundation.Scene CAAT.Event.AnimationLoop CAAT.Event.Input CAAT.Event.KeyEvent CAAT.Event.MouseEvent CAAT.Event.TouchEvent CAAT.WebGL.Program CAAT.WebGL.ColorProgram CAAT.WebGL.TextureProgram CAAT.WebGL.GLU CAAT.Module.TexturePacker.TexturePageManager".split(" "),constants:{RENDER_MODE_CONTINUOUS:1,RENDER_MODE_DIRTY:2,CLEAR_DIRTY_RECTS:1,CLEAR_ALL:!0,CLEAR_NONE:!1,RESIZE_NONE:1,RESIZE_WIDTH:2,RESIZE_HEIGHT:4,RESIZE_BOTH:8,RESIZE_PROPORTIONAL:16},extendsWith:function(){return{__init:function(){this.__super(),this.browserInfo=CAAT.Module.Runtime.BrowserInfo,this.audioManager=(new CAAT.Module.Audio.AudioManager).initialize(8),this.scenes=[],this.imagesCache=[],this.mousePoint=new CAAT.Math.Point(0,0,0),this.prevMousePoint=new CAAT.Math.Point(0,0,0),this.screenMousePoint=new CAAT.Math.Point(0,0,0),this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.cDirtyRects=[],this.sDirtyRects=[],this.dirtyRects=[];for(var a=0;64>a;a++)this.dirtyRects.push(new CAAT.Math.Rectangle);return this.dirtyRectsIndex=0,this.touches={},this.timerManager=new CAAT.Foundation.Timer.TimerManager,this.__map={},this},debug:!1,renderMode:CAAT.Foundation.Director.RENDER_MODE_CONTINUOUS,onRenderStart:null,onRenderEnd:null,mousePoint:null,prevMousePoint:null,screenMousePoint:null,isMouseDown:!1,lastSelectedActor:null,dragging:!1,scenes:null,currentScene:null,canvas:null,ctx:null,time:0,timeline:0,imagesCache:null,audioManager:null,clear:CAAT.Foundation.Director.CLEAR_ALL,transitionScene:null,browserInfo:null,gl:null,glEnabled:!1,glTextureManager:null,glTtextureProgram:null,glColorProgram:null,pMatrix:null,coords:null,coordsIndex:0,uv:null,uvIndex:0,front_to_back:!1,statistics:{size_total:0,size_active:0,size_dirtyRects:0,draws:0,size_discarded_by_dirty_rects:0},currentTexturePage:0,currentOpacity:1,intervalId:null,frameCounter:0,resize:1,onResizeCallback:null,__gestureScale:0,__gestureRotation:0,dirtyRects:null,cDirtyRects:null,sDirtyRects:null,dirtyRectsIndex:0,dirtyRectsEnabled:!1,nDirtyRects:0,drDiscarded:0,stopped:!1,needsRepaint:!1,touches:null,timerManager:null,SCREEN_RATIO:1,__map:null,clean:function(){return this.audioManager=this.imagesCache=this.currentScene=this.scenes=null,this.isMouseDown=!1,this.lastSelectedActor=null,this.dragging=!1,this.__gestureRotation=this.__gestureScale=0,this.dirty=!0,this.cDirtyRects=this.dirtyRects=null,this.dirtyRectsIndex=0,this.dirtyRectsEnabled=!1,this.nDirtyRects=0,this.onResizeCallback=null,this.__map={},this},cancelPlay:function(a){return this.audioManager.cancelPlay(a)},cancelPlayByChannel:function(a){return this.audioManager.cancelPlayByChannel(a)},setAudioFormatExtensions:function(a){return this.audioManager.setAudioFormatExtensions(a),this},setValueForKey:function(a,b){return this.__map[a]=b,this},getValueForKey:function(a){return this.__map[a]},createTimer:function(a,b,c,d,e){return this.timerManager.createTimer(a,b,c,d,e,this)},requestRepaint:function(){this.needsRepaint=!0},getCurrentScene:function(){return this.currentScene},checkDebug:function(){if(!navigator.isCocoonJS&&CAAT.DEBUG){var a=(new CAAT.Module.Debug.Debug).initialize(this.width,60);this.debugInfo=a.debugInfo.bind(a)}},getRenderType:function(){return this.glEnabled?"WEBGL":"CANVAS"},windowResized:function(a,b){var c=CAAT.Foundation.Director;switch(this.resize){case c.RESIZE_WIDTH:this.setBounds(0,0,a,this.height);break;case c.RESIZE_HEIGHT:this.setBounds(0,0,this.width,b);break;case c.RESIZE_BOTH:this.setBounds(0,0,a,b);break;case c.RESIZE_PROPORTIONAL:this.setScaleProportional(a,b)}this.glEnabled&&this.glReset(),this.onResizeCallback&&this.onResizeCallback(this,a,b)},setScaleProportional:function(a,b){var c=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.canvas.width=this.referenceWidth*c,this.canvas.height=this.referenceHeight*c,this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.setScaleAnchored(c*this.scaleX,c*this.scaleY,0,0),this.glEnabled&&this.glReset()},enableResizeEvents:function(a,b){var c=CAAT.Foundation.Director;return a===c.RESIZE_BOTH||a===c.RESIZE_WIDTH||a===c.RESIZE_HEIGHT||a===c.RESIZE_PROPORTIONAL?(this.referenceWidth=this.width,this.referenceHeight=this.height,this.resize=a,CAAT.registerResizeListener(this),this.onResizeCallback=b,this.windowResized(window.innerWidth,window.innerHeight)):(CAAT.unregisterResizeListener(this),this.onResizeCallback=null),this},__setupRetina:function(){if(CAAT.RETINA_DISPLAY_ENABLED){var a=CAAT.Module.Runtime.BrowserInfo.DevicePixelRatio,b=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,c=a/b;a!==b?(a=this.canvas.width,b=this.canvas.height,this.canvas.width=a*c,this.canvas.height=b*c,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.setScaleAnchored(c,c,0,0)):this.setScaleAnchored(1,1,0,0),this.SCREEN_RATIO=c}else this.setScaleAnchored(1,1,0,0);for(c=0;c<this.scenes.length;c++)this.scenes[c].setBounds(0,0,this.width,this.height)},setBounds:function(a,b,c,d){return CAAT.Foundation.Director.superclass.setBounds.call(this,a,b,c,d),this.canvas.width!==c&&(this.canvas.width=c),this.canvas.height!==d&&(this.canvas.height=d),this.ctx=this.canvas.getContext(this.glEnabled?"experimental-webgl":"2d"),this.__setupRetina(),this.glEnabled&&this.glReset(),this},initialize:function(a,b,c,d){return"undefined"!=typeof c&&(isString(c)?c=document.getElementById(c):c instanceof HTMLCanvasElement||console.log("Canvas is a: "+c+" ???")),c||(c=document.createElement("canvas"),document.body.appendChild(c)),this.canvas=c,"undefined"==typeof d&&(d=c),this.setBounds(0,0,a,b),this.enableEvents(d),this.timeline=(new Date).getTime(),CAAT.CACHE_SCENE_ON_CHANGE&&(this.transitionScene=(new CAAT.Foundation.Scene).setBounds(0,0,a,b),c=document.createElement("canvas"),c.width=a,c.height=b,a=(new CAAT.Foundation.Actor).setBackgroundImage(c),this.transitionScene.ctx=c.getContext("2d"),this.transitionScene.addChildImmediately(a),this.transitionScene.setEaseListener(this)),this.checkDebug(),this},glReset:function(){this.pMatrix=CAAT.WebGL.GLU.makeOrtho(0,this.referenceWidth,this.referenceHeight,0,-1,1),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.glColorProgram.setMatrixUniform(this.pMatrix),this.glTextureProgram.setMatrixUniform(this.pMatrix),this.gl.viewportWidth=this.canvas.width,this.gl.viewportHeight=this.canvas.height},initializeGL:function(a,b,c){c||(c=document.createElement("canvas"),document.body.appendChild(c)),c.width=a,c.height=b,this.referenceWidth=a,this.referenceHeight=b;try{this.gl=c.getContext("experimental-webgl"),this.gl.viewportWidth=a,this.gl.viewportHeight=b,CAAT.GLRENDER=!0}catch(d){}return this.gl?(this.canvas=c,this.setBounds(0,0,a,b),this.enableEvents(c),this.timeline=(new Date).getTime(),this.glColorProgram=new CAAT.WebGL.ColorProgram(this.gl).create().initialize(),this.glTextureProgram=new CAAT.WebGL.TextureProgram(this.gl).create().initialize(),this.glTextureProgram.useProgram(),this.glReset(),this.coords=new Float32Array(6144),this.uv=new Float32Array(4096),this.gl.clearColor(0,0,0,255),this.front_to_back?(this.gl.clearDepth(1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LESS)):this.gl.disable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.glEnabled=!0,this.checkDebug(),this):this.initialize(a,b,c)},createScene:function(){var a=new CAAT.Scene;return this.addScene(a),a},setImagesCache:function(a,b,c){if(!a||!a.length)return this;var d;if(null!==this.glTextureManager&&(this.glTextureManager.deletePages(),this.glTextureManager=null),this.imagesCache){var e=[];for(d=0;d<this.imagesCache.length;d++)e.push(this.imagesCache[d].id);for(d=0;d<e.length;d++)delete this.imagesCache[e[d]]}if(this.imagesCache=a)for(d=0;d<a.length;d++)this.imagesCache[a[d].id]=a[d].image;return this.tpW=b||2048,this.tpH=c||2048,this.updateGLPages(),this},updateGLPages:function(){this.glEnabled&&(this.glTextureManager=new CAAT.Module.TexturePacker.TexturePageManager,this.glTextureManager.createPages(this.gl,this.tpW,this.tpH,this.imagesCache),this.currentTexturePage=this.glTextureManager.pages[0],this.glTextureProgram.setTexture(this.currentTexturePage.texture))},setGLTexturePage:function(a){return this.currentTexturePage=a,this.glTextureProgram.setTexture(a.texture),this},addImage:function(a,b,c){if(this.getImage(a)){for(var d in this.imagesCache)if(this.imagesCache[d].id===a){this.imagesCache[d].image=b;break}}else this.imagesCache.push({id:a,image:b});this.imagesCache[a]=b,c||this.updateGLPages()},deleteImage:function(a,b){for(var c=0;c<this.imagesCache.length;c++)if(this.imagesCache[c].id===a){delete this.imagesCache[a],this.imagesCache.splice(c,1);break}b||this.updateGLPages()},setGLCurrentOpacity:function(a){this.currentOpacity=a,this.glTextureProgram.setAlpha(a)},glRender:function(a,b,c){a=a||this.coords,c=c||this.uv,b=b||this.coordsIndex;var d=this.gl;b=b/12*2,this.glTextureProgram.updateVertexBuffer(a),this.glTextureProgram.updateUVBuffer(c),d.drawElements(d.TRIANGLES,3*b,d.UNSIGNED_SHORT,0)},glFlush:function(){0!==this.coordsIndex&&this.glRender(this.coords,this.coordsIndex,this.uv),this.uvIndex=this.coordsIndex=0,this.statistics.draws++},findActorAtPosition:function(a){for(var b=this.childrenList.length-1;b>=0;b--){var c=this.childrenList[b],d=new CAAT.Math.Point(a.x,a.y,0),c=c.findActorAtPosition(d);if(null!==c)return c}return this},resetStats:function(){this.statistics.size_total=0,this.statistics.size_active=0,this.statistics.draws=0,this.statistics.size_discarded_by_dirty_rects=0},render:function(a){if(!this.currentScene||!this.currentScene.isPaused()){for(this.time+=a,d=0,l=this.childrenList.length;l>d;d++){var b=this.childrenList[d];if(b.isInAnimationFrame(this.time)&&!b.isPaused()){var c=b.time-b.start_time;b.timerManager.checkTimers(c),b.timerManager.removeExpiredTimers()}}this.animate(this,this.time),!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats();var d,e=this.childrenList.length,f=this.ctx;if(this.glEnabled){for(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),d=this.uvIndex=this.coordsIndex=0;e>d;d++)b=this.childrenList[d],b.isInAnimationFrame(this.time)&&(c=b.time-b.start_time,b.onRenderStart&&b.onRenderStart(c),b.paintActorGL(this,c),b.onRenderEnd&&b.onRenderEnd(c),b.isPaused()||(b.time+=a),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=b.size_total,this.statistics.size_active+=b.size_active));this.glFlush()}else{if(f.globalAlpha=1,f.globalCompositeOperation="source-over",f.save(),this.dirtyRectsEnabled)if(this.modelViewMatrix.transformRenderingContext(f),CAAT.DEBUG_DIRTYRECTS)f.clearRect(0,0,this.canvas.width,this.canvas.height);else{for(f.beginPath(),this.nDirtyRects=0,b=this.cDirtyRects,d=0;d<b.length;d++)c=b[d],c.isEmpty()||(f.rect(0|c.x,0|c.y,1+(0|c.width),1+(0|c.height)),this.nDirtyRects++);f.clip()}else this.clear===CAAT.Foundation.Director.CLEAR_ALL&&f.clearRect(0,0,this.canvas.width,this.canvas.height);for(d=0;e>d;d++)b=this.childrenList[d],b.isInAnimationFrame(this.time)&&(c=b.time-b.start_time,f.save(),b.onRenderStart&&b.onRenderStart(c),!CAAT.DEBUG_DIRTYRECTS&&this.dirtyRectsEnabled?this.nDirtyRects&&b.paintActor(this,c):b.paintActor(this,c),b.onRenderEnd&&b.onRenderEnd(c),f.restore(),CAAT.DEBUGAABB&&(f.globalAlpha=1,f.globalCompositeOperation="source-over",this.modelViewMatrix.transformRenderingContextSet(f),b.drawScreenBoundingBox(this,c)),b.isPaused()||(b.time+=a),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_total+=b.size_total,this.statistics.size_active+=b.size_active,this.statistics.size_dirtyRects=this.nDirtyRects));if(0<this.nDirtyRects&&!navigator.isCocoonJS&&CAAT.DEBUG&&CAAT.DEBUG_DIRTYRECTS){for(f.beginPath(),this.nDirtyRects=0,b=this.cDirtyRects,d=0;d<b.length;d++)c=b[d],c.isEmpty()||(f.rect(0|c.x,0|c.y,1+(0|c.width),1+(0|c.height)),this.nDirtyRects++);f.clip(),f.fillStyle="rgba(160,255,150,.4)",f.fillRect(0,0,this.canvas.width,this.canvas.height)}f.restore()}this.frameCounter++}},inDirtyRect:function(a){if(!this.dirtyRectsEnabled||CAAT.DEBUG_DIRTYRECTS)return!0;var b,c=this.cDirtyRects,d=a.AABB;for(b=0;b<c.length;b++)if(c[b].intersects(d))return!0;return this.statistics.size_discarded_by_dirty_rects+=a.size_total,!1},animate:function(a,b){this.timerManager.checkTimers(b),this.setModelViewMatrix(this),this.modelViewMatrixI=this.modelViewMatrix.getInverse(),this.setScreenBounds(),this.invalid=this.dirty=!1,this.dirtyRectsIndex=-1,this.cDirtyRects=[];var c,d,e=this.childrenList;if(this.dirtyRectsEnabled){var f=this.sDirtyRects;if(f.length){for(d=0,c=f.length;c>d;d++)this.addDirtyRect(f[d]);this.sDirtyRects=[]}}for(d=0;d<e.length;d++)c=e[d],c.animate(this,c.time-c.start_time);return this.timerManager.removeExpiredTimers(),this},scheduleDirtyRect:function(a){this.sDirtyRects.push(a)},addDirtyRect:function(a){if(!a.isEmpty()){var b,c,d,e,f=this.cDirtyRects;for(b=0;b<f.length;b++)if(c=f[b],!c.isEmpty()&&c.intersects(a)){for(var g=!0;g;){for(c.unionRectangle(a),d=0;d<f.length;d++)if(d!==b&&(e=f[d],!e.isEmpty()&&e.intersects(c))){c.unionRectangle(e),e.setEmpty();break}d==f.length&&(g=!1)}for(d=0;d<f.length;d++)f[d].isEmpty()&&f.splice(d,1);return}if(this.dirtyRectsIndex++,this.dirtyRectsIndex>=this.dirtyRects.length)for(b=0;32>b;b++)this.dirtyRects.push(new CAAT.Math.Rectangle);b=this.dirtyRects[this.dirtyRectsIndex],b.x=a.x,b.y=a.y,b.x1=a.x1,b.y1=a.y1,b.width=a.width,b.height=a.height,this.cDirtyRects.push(b)}},renderToContext:function(a,b){if(b.isInAnimationFrame(this.time)){a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.globalCompositeOperation="source-over",a.clearRect(0,0,this.width,this.height);var c=this.ctx;this.ctx=a,a.save();var d=this.modelViewMatrix,e=this.worldModelViewMatrix;this.modelViewMatrix=this.worldModelViewMatrix=new CAAT.Math.Matrix,this.wdirty=!0,b.animate(this,b.time),b.onRenderStart&&b.onRenderStart(b.time),b.paintActor(this,b.time),b.onRenderEnd&&b.onRenderEnd(b.time),this.worldModelViewMatrix=e,this.modelViewMatrix=d,a.restore(),this.ctx=c}},addScene:function(a){a.setBounds(0,0,this.width,this.height),this.scenes.push(a),a.setEaseListener(this),null===this.currentScene&&this.setScene(0)},getNumScenes:function(){return this.scenes.length},easeInOut:function(a,b,c,d,e,f,g,h,i,j){a!==this.getCurrentSceneIndex()&&(a=this.scenes[a],d=this.scenes[d],!CAAT.__CSS__&&CAAT.CACHE_SCENE_ON_CHANGE&&(this.renderToContext(this.transitionScene.ctx,d),d=this.transitionScene),a.setExpired(!1),d.setExpired(!1),a.mouseEnabled=!1,d.mouseEnabled=!1,a.resetTransform(),d.resetTransform(),a.setLocation(0,0),d.setLocation(0,0),a.alpha=1,d.alpha=1,b===CAAT.Foundation.Scene.EASE_ROTATION?a.easeRotationIn(g,h,c,i):b===CAAT.Foundation.Scene.EASE_SCALE?a.easeScaleIn(0,g,h,c,i):a.easeTranslationIn(g,h,c,i),e===CAAT.Foundation.Scene.EASE_ROTATION?d.easeRotationOut(g,h,f,j):e===CAAT.Foundation.Scene.EASE_SCALE?d.easeScaleOut(0,g,h,f,j):d.easeTranslationOut(g,h,f,j),this.childrenList=[],d.goOut(a),a.getIn(d),this.addChild(d),this.addChild(a))},easeInOutRandom:function(a,b,c,d){var e,f=Math.random(),g=Math.random();.33>f?(f=CAAT.Foundation.Scene.EASE_ROTATION,e=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):.66>f?(f=CAAT.Foundation.Scene.EASE_SCALE,e=(new CAAT.Behavior.Interpolator).createElasticOutInterpolator(1.1,.4)):(f=CAAT.Foundation.Scene.EASE_TRANSLATE,e=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator());var h;.33>g?(g=CAAT.Foundation.Scene.EASE_ROTATION,h=(new CAAT.Behavior.Interpolator).createExponentialInOutInterpolator(4)):.66>g?(g=CAAT.Foundation.Scene.EASE_SCALE,h=(new CAAT.Behavior.Interpolator).createExponentialOutInterpolator(4)):(g=CAAT.Foundation.Scene.EASE_TRANSLATE,h=(new CAAT.Behavior.Interpolator).createBounceOutInterpolator()),this.easeInOut(a,f,8.99*Math.random()>>0,b,g,8.99*Math.random()>>0,c,d,e,h)},easeIn:function(a,b,c,d,e,f){a=this.scenes[a],b===CAAT.Foundation.Scene.EASE_ROTATION?a.easeRotationIn(c,d,e,f):b===CAAT.Foundation.Scene.EASE_SCALE?a.easeScaleIn(0,c,d,e,f):a.easeTranslationIn(c,d,e,f),this.childrenList=[],this.addChild(a),a.resetTransform(),a.setLocation(0,0),a.alpha=1,a.mouseEnabled=!1,a.setExpired(!1)},setScene:function(a){a=this.scenes[a],this.childrenList=[],this.addChild(a),this.currentScene=a,a.setExpired(!1),a.mouseEnabled=!0,a.resetTransform(),a.setLocation(0,0),a.alpha=1,a.getIn(),a.activated()},switchToScene:function(a,b,c,d){var e=this.getSceneIndex(this.currentScene);d?this.easeInOutRandom(a,e,b,c):this.setScene(a)},switchToPrevScene:function(a,b,c){var d=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||0===d||(c?this.easeInOutRandom(d-1,d,a,b):this.setScene(d-1))},switchToNextScene:function(a,b,c){var d=this.getSceneIndex(this.currentScene);1>=this.getNumScenes()||d===this.getNumScenes()-1||(c?this.easeInOutRandom(d+1,d,a,b):this.setScene(d+1))},mouseEnter:function(){},mouseExit:function(){},mouseMove:function(){},mouseDown:function(){},mouseUp:function(){},mouseDrag:function(){},easeEnd:function(a,b){b?(this.currentScene=a,this.currentScene.activated()):a.setExpired(!0),a.mouseEnabled=!0,a.emptyBehaviorList()},getSceneIndex:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b]===a)return b;return-1},getScene:function(a){return this.scenes[a]},getSceneById:function(a){for(var b=0;b<this.scenes.length;b++)if(this.scenes[b].id===a)return this.scenes[b];return null},getCurrentSceneIndex:function(){return this.getSceneIndex(this.currentScene)},getBrowserName:function(){return this.browserInfo.browser},getBrowserVersion:function(){return this.browserInfo.version},getOSName:function(){return this.browserInfo.OS},getImage:function(a){var b=this.imagesCache[a];if(b)return b;for(var c in this.imagesCache)if(this.imagesCache[c].id===a)return this.imagesCache[c].image;return null},musicPlay:function(a){return this.audioManager.playMusic(a)},musicStop:function(){this.audioManager.stopMusic()},addAudio:function(a,b){return this.audioManager.addAudio(a,b),this},audioPlay:function(a){return this.audioManager.play(a)},audioLoop:function(a){return this.audioManager.loop(a)},endSound:function(){return this.audioManager.endSound()},setSoundEffectsEnabled:function(a){return this.audioManager.setSoundEffectsEnabled(a)},setMusicEnabled:function(a){return this.audioManager.setMusicEnabled(a)},isMusicEnabled:function(){return this.audioManager.isMusicEnabled()},isSoundEffectsEnabled:function(){return this.audioManager.isSoundEffectsEnabled()},setVolume:function(a,b){return this.audioManager.setVolume(a,b)},emptyScenes:function(){this.scenes=[]},addChild:function(a){a.parent=this,this.childrenList.push(a)},loop:function(a,b,c){c?(this.onRenderStart=b,this.onRenderEnd=c):b&&(this.onRenderEnd=b),CAAT.loop()},renderFrame:function(){if(CAAT.currentDirector=this,!this.stopped){var a=(new Date).getTime(),b=a-this.timeline;b>500&&(b=500),this.onRenderStart&&this.onRenderStart(b),this.render(b),this.debugInfo&&this.debugInfo(this.statistics),this.timeline=a,this.onRenderEnd&&this.onRenderEnd(b),this.needsRepaint=!1}},resetTimeline:function(){this.timeline=(new Date).getTime()},endLoop:function(){},setClear:function(a){return this.clear=a,this.dirtyRectsEnabled=this.clear===CAAT.Foundation.Director.CLEAR_DIRTY_RECTS?!0:!1,this},getAudioManager:function(){return this.audioManager},cumulateOffset:function(a,b,c){var d=c+"Left";c+="Top";for(var e,f=0,g=0;"iOS"!==navigator.browser&&a&&a.style&&(e=a.currentStyle?a.currentStyle.position:(e=(a.ownerDocument.defaultView||a.ownerDocument.parentWindow).getComputedStyle(a,null))?e.getPropertyValue("position"):null,!/^(fixed)$/.test(e));)f+=a[d],g+=a[c],a=a[b];return{x:f,y:g,style:e}},getOffset:function(a){var b=this.cumulateOffset(a,"offsetParent","offset");return"fixed"===b.style?(a=this.cumulateOffset(a,a.parentNode?"parentNode":"parentElement","scroll"),{x:b.x+a.x,y:b.y+a.y}):{x:b.x,y:b.y}},getCanvasCoord:function(a,b){var c=new CAAT.Math.Point,d=0,e=0;b||(b=window.event),b.pageX||b.pageY?(d=b.pageX,e=b.pageY):(b.clientX||b.clientY)&&(d=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);var f=this.getOffset(this.canvas),d=d-(f.x+window.scrollX+this.canvas.offsetLeft),e=e-(f.y+window.scrollY+this.canvas.offsetTop),d=d*this.SCREEN_RATIO,e=e*this.SCREEN_RATIO;c.x=d,c.y=e,this.modelViewMatrixI||(this.modelViewMatrixI=this.modelViewMatrix.getInverse()),this.modelViewMatrixI.transformCoord(c),d=c.x,e=c.y,a.set(d,e),this.screenMousePoint.set(d,e)},__mouseDownHandler:function(a){if(this.dragging&&this.lastSelectedActor)this.__mouseUpHandler(a);else{this.getCanvasCoord(this.mousePoint,a),this.isMouseDown=!0;var b=this.findActorAtPosition(this.mousePoint);if(null!==b){var c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0));b.mouseDown((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y)))}this.lastSelectedActor=b}},__mouseUpHandler:function(a){this.isMouseDown=!1,this.getCanvasCoord(this.mousePoint,a);var b=null,c=this.lastSelectedActor;null!==c&&(b=c.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),c.actionPerformed&&c.contains(b.x,b.y)&&c.actionPerformed(a),c.mouseUp((new CAAT.Event.MouseEvent).init(b.x,b.y,a,c,this.screenMousePoint,this.currentScene.time))),this.dragging||null===c||c.contains(b.x,b.y)&&c.mouseClick((new CAAT.Event.MouseEvent).init(b.x,b.y,a,c,this.screenMousePoint,this.currentScene.time)),this.in_=this.dragging=!1},__mouseMoveHandler:function(a){var b,c,d=this.currentScene?this.currentScene.time:0;if(this.isMouseDown&&null!==this.lastSelectedActor){if(b=this.lastSelectedActor,c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.dragging||!(Math.abs(this.prevMousePoint.x-c.x)<CAAT.DRAG_THRESHOLD_X&&Math.abs(this.prevMousePoint.y-c.y)<CAAT.DRAG_THRESHOLD_Y)){this.dragging=!0;var e=b.x,f=b.y;b.mouseDrag((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y),d)),this.prevMousePoint.x=c.x,this.prevMousePoint.y=c.y,e===b.x&&f===b.y&&(e=b.contains(c.x,c.y),this.in_&&!e&&(b.mouseExit((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.in_=!1),!this.in_&&e&&(b.mouseEnter((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.in_=!0))}}else this.in_=!0,b=this.findActorAtPosition(this.mousePoint),b!==this.lastSelectedActor&&(null!==this.lastSelectedActor&&(c=this.lastSelectedActor.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),this.lastSelectedActor.mouseExit((new CAAT.Event.MouseEvent).init(c.x,c.y,a,this.lastSelectedActor,this.screenMousePoint,d))),null!==b&&(c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),b.mouseEnter((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)))),c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),null!==b&&b.mouseMove((new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,d)),this.prevMousePoint.x=c.x,this.prevMousePoint.y=c.y,this.lastSelectedActor=b
},__mouseOutHandler:function(a){if(!this.dragging)if(null!==this.lastSelectedActor){this.getCanvasCoord(this.mousePoint,a);var b=new CAAT.Math.Point(this.mousePoint.x,this.mousePoint.y,0);this.lastSelectedActor.viewToModel(b),a=(new CAAT.Event.MouseEvent).init(b.x,b.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time),this.lastSelectedActor.mouseExit(a),this.lastSelectedActor.mouseOut(a),this.dragging||(this.lastSelectedActor=null)}else this.in_=this.isMouseDown=!1},__mouseOverHandler:function(a){if(!this.dragging){var b,c;null==this.lastSelectedActor?(b=this.findActorAtPosition(this.mousePoint),null!==b&&(c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),a=(new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene?this.currentScene.time:0),b.mouseOver(a),b.mouseEnter(a)),this.lastSelectedActor=b):(b=this.lastSelectedActor,c=b.viewToModel(new CAAT.Math.Point(this.screenMousePoint.x,this.screenMousePoint.y,0)),a=(new CAAT.Event.MouseEvent).init(c.x,c.y,a,b,this.screenMousePoint,this.currentScene.time),b.mouseOver(a),b.mouseEnter(a))}},__mouseDBLClickHandler:function(a){this.getCanvasCoord(this.mousePoint,a),null!==this.lastSelectedActor&&this.lastSelectedActor.mouseDblClick((new CAAT.Event.MouseEvent).init(this.mousePoint.x,this.mousePoint.y,a,this.lastSelectedActor,this.screenMousePoint,this.currentScene.time))},__touchStartHandler:function(a){if(a.target===this.canvas){a.preventDefault(),a.returnValue=!1,a=a.targetTouches[0];var b=this.mousePoint;this.getCanvasCoord(b,a),0>b.x||0>b.y||b.x>=this.width||b.y>=this.height||(this.touching=!0,this.__mouseDownHandler(a))}},__touchEndHandler:function(a){this.touching&&(a.preventDefault(),a.returnValue=!1,a=a.changedTouches[0],this.getCanvasCoord(this.mousePoint,a),this.touching=!1,this.__mouseUpHandler(a))},__touchMoveHandler:function(a){if(this.touching&&(a.preventDefault(),a.returnValue=!1,!this.gesturing))for(var b=0;b<a.targetTouches.length;b++){var c=a.targetTouches[b];this.getCanvasCoord(this.mousePoint,c),this.__mouseMoveHandler(c)}},__gestureStart:function(){this.gesturing=!0,this.__gestureRotation=this.lastSelectedActor.rotationAngle,this.__gestureSX=this.lastSelectedActor.scaleX-1,this.__gestureSY=this.lastSelectedActor.scaleY-1},__gestureChange:function(a,b){"undefined"!=typeof a&&"undefined"!=typeof b&&null!==this.lastSelectedActor&&this.lastSelectedActor.isGestureEnabled()&&(this.lastSelectedActor.setRotation(b*Math.PI/180+this.__gestureRotation),this.lastSelectedActor.setScale(this.__gestureSX+a,this.__gestureSY+a))},__gestureEnd:function(){this.gesturing=!1,this.__gestureScale=this.__gestureRotation=0},__touchEndHandlerMT:function(a){a.preventDefault(),a.returnValue=!1;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b].identifier;c.push(d)}var e={};for(b=0;b<c.length;b++){var f=c[b];this.touches[f]&&(d=this.touches[f].actor,e[d.id]||(e[d.id]={actor:d,touch:(new CAAT.Event.TouchEvent).init(a,d,this.currentScene.time)}),e[d.id].touch.addChangedTouch(this.touches[f].touch))}for(b=0;b<a.changedTouches.length;b++)c=a.changedTouches[b],d=c.identifier,delete this.touches[d];for(var g in e){a=e[g];var h,d=a.actor,c=a.touch;for(h in this.touches)a=this.touches[h],a.actor.id===d.id&&c.addTouch(a.touch);d.touchEnd(c)}},__touchMoveHandlerMT:function(a){a.preventDefault(),a.returnValue=!1;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=d.identifier;if(this.touches[e]){var f=this.mousePoint;this.getCanvasCoord(f,d);var g=this.touches[e].actor,f=g.viewToModel(f);this.touches[e]={actor:g,touch:new CAAT.Event.TouchInfo(e,f.x,f.y,g)},c.push(e)}}for(e={},b=0;b<c.length;b++)d=c[b],g=this.touches[d].actor,e[g.id]||(e[g.id]={actor:g,touch:(new CAAT.Event.TouchEvent).init(a,g,this.currentScene.time)}),g=e[g.id].touch,g.addTouch(this.touches[d].touch),g.addChangedTouch(this.touches[d].touch);for(var h in e){a=e[h];var i,g=a.actor,d=a.touch;for(i in this.touches)a=this.touches[i],a.actor.id===g.id&&d.addTouch(a.touch);g.touchMove(d)}},__touchCancelHandleMT:function(a){this.__touchEndHandlerMT(a)},__touchStartHandlerMT:function(a){a.preventDefault(),a.returnValue=!1;var b,c=[];for(b=0;b<a.changedTouches.length;b++){var d=a.changedTouches[b],e=d.identifier,f=this.mousePoint;if(this.getCanvasCoord(f,d),!(0>f.x||0>f.y||f.x>=this.width||f.y>=this.height)){var g=this.findActorAtPosition(f);null!==g&&(f=g.viewToModel(f),this.touches[e]||(this.touches[e]={actor:g,touch:new CAAT.Event.TouchInfo(e,f.x,f.y,g)},c.push(e)))}}for(e={},b=0;b<c.length;b++)d=c[b],g=this.touches[d].actor,e[g.id]||(e[g.id]={actor:g,touch:(new CAAT.Event.TouchEvent).init(a,g,this.currentScene.time)}),g=e[g.id].touch,g.addTouch(this.touches[d].touch),g.addChangedTouch(this.touches[d].touch);for(var h in e){a=e[h];var i,g=a.actor,d=a.touch;for(i in this.touches)a=this.touches[i],a.actor.id===g.id&&d.addTouch(a.touch);g.touchStart(d)}},__findTouchFirstActor:function(){var a,b=Number.MAX_VALUE,c=null;for(a in this.touches){var d=this.touches[a];d.touch.time&&d.touch.time<b&&d.actor.isGestureEnabled()&&(c=d.actor,b=d.touch.time)}return c},__gesturedActor:null,__touchGestureStartHandleMT:function(a){var b=this.__findTouchFirstActor();null!==b&&b.isGestureEnabled()&&(this.__gesturedActor=b,this.__gestureRotation=b.rotationAngle,this.__gestureSX=b.scaleX-1,this.__gestureSY=b.scaleY-1,b.gestureStart(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY))},__touchGestureEndHandleMT:function(a){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureEnd(a.rotation*Math.PI/180,a.scale+this.__gestureSX,a.scale+this.__gestureSY),this.__gestureScale=this.__gestureRotation=0},__touchGestureChangeHandleMT:function(a){null!==this.__gesturedActor&&this.__gesturedActor.isGestureEnabled()&&this.__gesturedActor.gestureChange(a.rotation*Math.PI/180,this.__gestureSX+a.scale,this.__gestureSY+a.scale)},addHandlers:function(a){var b=this;window.addEventListener("mouseup",function(a){b.touching&&(a.preventDefault(),a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation(),b.getCanvasCoord(b.mousePoint,a),b.__mouseUpHandler(a),b.touching=!1)},!1),window.addEventListener("mousedown",function(c){if(c.target===a){c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c),0>d.x||0>d.y||d.x>=b.width||d.y>=b.height||(b.touching=!0,b.__mouseDownHandler(c))}},!1),window.addEventListener("mouseover",function(c){if(c.target===a&&!b.dragging){c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c),0>d.x||0>d.y||d.x>=b.width||d.y>=b.height||b.__mouseOverHandler(c)}},!1),window.addEventListener("mouseout",function(c){c.target!==a||b.dragging||(c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation(),b.getCanvasCoord(b.mousePoint,c),b.__mouseOutHandler(c))},!1),window.addEventListener("mousemove",function(c){if(c.target===a&&!b.dragging){c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c),!b.dragging&&(0>d.x||0>d.y||d.x>=b.width||d.y>=b.height)||b.__mouseMoveHandler(c)}},!1),window.addEventListener("dblclick",function(c){if(c.target===a){c.preventDefault(),c.cancelBubble=!0,c.stopPropagation&&c.stopPropagation();var d=b.mousePoint;b.getCanvasCoord(d,c),0>d.x||0>d.y||d.x>=b.width||d.y>=b.height||b.__mouseDBLClickHandler(c)}},!1),CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MOUSE?(a.addEventListener("touchstart",this.__touchStartHandler.bind(this),!1),a.addEventListener("touchmove",this.__touchMoveHandler.bind(this),!1),a.addEventListener("touchend",this.__touchEndHandler.bind(this),!1),a.addEventListener("gesturestart",function(c){c.target===a&&(c.preventDefault(),c.returnValue=!1,b.__gestureStart(c.scale,c.rotation))},!1),a.addEventListener("gestureend",function(c){c.target===a&&(c.preventDefault(),c.returnValue=!1,b.__gestureEnd(c.scale,c.rotation))},!1),a.addEventListener("gesturechange",function(c){c.target===a&&(c.preventDefault(),c.returnValue=!1,b.__gestureChange(c.scale,c.rotation))},!1)):CAAT.TOUCH_BEHAVIOR===CAAT.TOUCH_AS_MULTITOUCH&&(a.addEventListener("touchstart",this.__touchStartHandlerMT.bind(this),!1),a.addEventListener("touchmove",this.__touchMoveHandlerMT.bind(this),!1),a.addEventListener("touchend",this.__touchEndHandlerMT.bind(this),!1),a.addEventListener("touchcancel",this.__touchCancelHandleMT.bind(this),!1),a.addEventListener("gesturestart",this.__touchGestureStartHandleMT.bind(this),!1),a.addEventListener("gestureend",this.__touchGestureEndHandleMT.bind(this),!1),a.addEventListener("gesturechange",this.__touchGestureChangeHandleMT.bind(this),!1))},enableEvents:function(a){CAAT.RegisterDirector(this),this.in_=!1,this.createEventHandler(a)},createEventHandler:function(a){this.in_=!1,this.addHandlers(a)}}},onCreate:function(){"undefined"!=typeof CAAT.__CSS__&&(CAAT.Foundation.Director.prototype.clip=!0,CAAT.Foundation.Director.prototype.glEnabled=!1,CAAT.Foundation.Director.prototype.getRenderType=function(){return"CSS"},CAAT.Foundation.Director.prototype.setScaleProportional=function(a,b){var c=Math.min(a/this.referenceWidth,b/this.referenceHeight);this.setScaleAnchored(c,c,0,0),this.eventHandler.style.width=""+this.referenceWidth+"px",this.eventHandler.style.height=""+this.referenceHeight+"px"},CAAT.Foundation.Director.prototype.setBounds=function(a,b,c,d){for(CAAT.Foundation.Director.superclass.setBounds.call(this,a,b,c,d),a=0;a<this.scenes.length;a++)this.scenes[a].setBounds(0,0,c,d);return this.eventHandler.style.width=c+"px",this.eventHandler.style.height=d+"px",this},CAAT.Foundation.Director.prototype.initialize=function(a,b,c){return this.timeline=(new Date).getTime(),this.domElement=c,this.style("position","absolute"),this.style("width",""+a+"px"),this.style("height",""+b+"px"),this.style("overflow","hidden"),this.enableEvents(c),this.setBounds(0,0,a,b),this.checkDebug(),this},CAAT.Foundation.Director.prototype.render=function(a){this.time+=a,this.animate(this,a);var b,c,d;for(!navigator.isCocoonJS&&CAAT.DEBUG&&this.resetStats(),b=0,c=this.childrenList.length;c>b;b++){var e=this.childrenList[b];e.isInAnimationFrame(this.time)&&!e.isPaused()&&(d=e.time-e.start_time,e.timerManager.checkTimers(d),e.timerManager.removeExpiredTimers())}for(b=0,c=this.childrenList.length;c>b;b++)e=this.childrenList[b],e.isInAnimationFrame(this.time)&&(d=e.time-e.start_time,e.onRenderStart&&e.onRenderStart(d),e.paintActor(this,d),e.onRenderEnd&&e.onRenderEnd(d),e.isPaused()||(e.time+=a),!navigator.isCocoonJS&&CAAT.DEBUG&&(this.statistics.size_discarded_by_dirtyRects+=this.drDiscarded,this.statistics.size_total+=e.size_total,this.statistics.size_active+=e.size_active,this.statistics.size_dirtyRects=this.nDirtyRects));this.frameCounter++},CAAT.Foundation.Director.prototype.addScene=function(a){a.setVisible(!0),a.setBounds(0,0,this.width,this.height),this.scenes.push(a),a.setEaseListener(this),null===this.currentScene&&this.setScene(0),this.domElement.appendChild(a.domElement)},CAAT.Foundation.Director.prototype.emptyScenes=function(){this.scenes=[],this.domElement.innerHTML="",this.createEventHandler()},CAAT.Foundation.Director.prototype.setClear=function(){return this},CAAT.Foundation.Director.prototype.createEventHandler=function(){this.eventHandler=document.createElement("div"),this.domElement.appendChild(this.eventHandler),this.eventHandler.style.position="absolute",this.eventHandler.style.left="0",this.eventHandler.style.top="0",this.eventHandler.style.zIndex=999999,this.eventHandler.style.width=""+this.width+"px",this.eventHandler.style.height=""+this.height+"px",this.canvas=this.eventHandler,this.in_=!1,this.addHandlers(this.canvas)},CAAT.Foundation.Director.prototype.inDirtyRect=function(){return!0})}}),CAAT.Module({defines:"CAAT.Foundation.UI.Dock",aliases:["CAAT.Dock"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer","CAAT.Behavior.GenericBehavior"],constants:{OP_LAYOUT_BOTTOM:0,OP_LAYOUT_TOP:1,OP_LAYOUT_LEFT:2,OP_LAYOUT_RIGHT:3},extendsWith:{scene:null,ttask:null,minSize:0,maxSize:0,range:2,layoutOp:0,initialize:function(a){return this.scene=a,this},setApplicationRange:function(a){return this.range=a,this},setLayoutOp:function(a){return this.layoutOp=a,this},setSizes:function(a,b){this.minSize=a,this.maxSize=b;for(var c=0;c<this.childrenList.length;c++)this.childrenList[c].width=a,this.childrenList[c].height=a;return this},layout:function(){var a,b,c=CAAT.Foundation.UI.Dock;if(this.layoutOp===c.OP_LAYOUT_BOTTOM||this.layoutOp===c.OP_LAYOUT_TOP){var d=b=0;for(a=0;a<this.getNumChildren();a++)b+=this.getChildAt(a).width;for(d=(this.width-b)/2,a=0;a<this.getNumChildren();a++)b=this.getChildAt(a),b.x=d,d+=b.width,b.y=this.layoutOp===c.OP_LAYOUT_BOTTOM?this.maxSize-b.height:0}else{for(a=d=b=0;a<this.getNumChildren();a++)b+=this.getChildAt(a).height;for(d=(this.height-b)/2,a=0;a<this.getNumChildren();a++)b=this.getChildAt(a),b.y=d,d+=b.height,b.x=this.layoutOp===c.OP_LAYOUT_LEFT?0:this.width-b.width}},mouseMove:function(){this.actorNotPointed()},mouseExit:function(){this.actorNotPointed()},actorNotPointed:function(){var a,b=this;for(a=0;a<this.getNumChildren();a++){var c=this.getChildAt(a);c.emptyBehaviorList(),c.addBehavior((new CAAT.Behavior.GenericBehavior).setValues(c.width,this.minSize,c,"width").setFrameTime(this.scene.time,250)).addBehavior((new CAAT.Behavior.GenericBehavior).setValues(c.height,this.minSize,c,"height").setFrameTime(this.scene.time,250)),a===this.getNumChildren()-1&&c.behaviorList[0].addListener({behaviorApplied:function(a,b,c,d){d.parent.layout()},behaviorExpired:function(d,e,f){for(a=0;a<b.getNumChildren();a++)c=b.getChildAt(a),c.width=b.minSize,c.height=b.minSize;f.parent.layout()}})}},actorPointed:function(a,b,c){var d=this.findChild(c),e=CAAT.Foundation.UI.Dock,f=0,f=this.layoutOp===e.OP_LAYOUT_BOTTOM||this.layoutOp===e.OP_LAYOUT_TOP?a/c.width:b/c.height;for(a=0;a<this.childrenList.length;a++)b=this.childrenList[a],b.emptyBehaviorList(),c=0,c=a<d-this.range||a>d+this.range?this.minSize:a===d?this.maxSize:d>a?this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-f+1)/this.range*Math.PI)+1)/2:this.minSize+(this.maxSize-this.minSize)*(Math.cos((a-d-f)/this.range*Math.PI)+1)/2,b.height=c,b.width=c;this.layout()},actorMouseExit:function(){null!==this.ttask&&this.ttask.cancel();var a=this;this.ttask=this.scene.createTimer(this.scene.time,100,function(){a.actorNotPointed()},null,null)},actorMouseEnter:function(){null!==this.ttask&&(this.ttask.cancel(),this.ttask=null)},addChild:function(a){var b=this;return a.__Dock_mouseEnter=a.mouseEnter,a.__Dock_mouseExit=a.mouseExit,a.__Dock_mouseMove=a.mouseMove,a.mouseEnter=function(a){b.actorMouseEnter(a),this.__Dock_mouseEnter(a)},a.mouseExit=function(a){b.actorMouseExit(a),this.__Dock_mouseExit(a)},a.mouseMove=function(a){b.actorPointed(a.point.x,a.point.y,a.source),this.__Dock_mouseMove(a)},a.width=this.minSize,a.height=this.minSize,CAAT.Foundation.UI.Dock.superclass.addChild.call(this,a)}}}),CAAT.Module({defines:"CAAT.Foundation.UI.InterpolatorActor",aliases:["CAAT.InterpolatorActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{interpolator:null,contour:null,S:50,gap:5,setGap:function(a){return this.gap=a,this},setInterpolator:function(a,b){return this.interpolator=a,this.contour=a.getContour(b||this.S),this},paint:function(a,b){if(CAAT.InterpolatorActor.superclass.paint.call(this,a,b),this.backgroundImage)return this;if(this.interpolator){var c=a.ctx,d=this.width-2*this.gap,e=this.height-2*this.gap;c.beginPath(),c.moveTo(this.gap+d*this.contour[0].x,-this.gap+this.height-e*this.contour[0].y);for(var f=1;f<this.contour.length;f++)c.lineTo(this.gap+d*this.contour[f].x,-this.gap+this.height-e*this.contour[f].y);c.strokeStyle=this.strokeStyle,c.stroke()}},getInterpolator:function(){return this.interpolator}}}),CAAT.Module({defines:"CAAT.Foundation.UI.Label",depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Foundation.UI.Layout.LayoutManager"],aliases:["CAAT.UI.Label"],extendsClass:"CAAT.Foundation.Actor",extendsWith:function(){var a=function(a){return this.ctx=a,this};a.prototype={ctx:null,defaultFS:null,font:null,fontSize:null,fill:null,stroke:null,filled:null,stroked:null,strokeSize:null,italic:null,bold:null,alignment:null,tabSize:null,shadow:null,shadowBlur:null,shadowColor:null,sfont:null,chain:null,setDefault:function(a){this.defaultFS=24,this.font="Arial",this.fontSize=this.defaultFS,this.fill="#000",this.stroke="#f00",this.filled=!0,this.stroked=!1,this.strokeSize=1,this.bold=this.italic=!1,this.alignment="left",this.tabSize=75,this.shadow=!1,this.shadowBlur=0,this.shadowColor="#000";for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);return this.__setFont(),this},setStyle:function(a){if("undefined"!=typeof a)for(var b in a)this[b]=a[b];return this},applyStyle:function(){return this.__setFont(),this},clone:function(){var b,c=new a(this.ctx);for(b in this)this.hasOwnProperty(b)&&(c[b]=this[b]);for(var d=this;d.chain;)for(b in d=d.chain)null===c[b]&&d.hasOwnProperty(b)&&(c[b]=d[b]);return c.__setFont(),c},__getProperty:function(a){var b,c=this;do{if(b=c[a],null!==b)return b;c=c.chain}while(c);return null},image:function(a){this.__setShadow(a)},text:function(a,b,c,d){this.__setShadow(a),a.font=this.__getProperty("sfont"),this.filled&&this.__fillText(a,b,c,d),this.stroked&&this.__strokeText(a,b,c,d)},__setShadow:function(a){this.__getProperty("shadow")&&(a.shadowBlur=this.__getProperty("shadowBlur"),a.shadowColor=this.__getProperty("shadowColor"))},__fillText:function(a,b,c,d){a.fillStyle=this.__getProperty("fill"),a.fillText(b,c,d)},__strokeText:function(a,b,c,d){a.strokeStyle=this.__getProperty("stroke"),a.lineWidth=this.__getProperty("strokeSize"),a.beginPath(),a.strokeText(b,c,d)},__setFont:function(){var a=this.__getProperty("italic"),b=this.__getProperty("bold"),c=this.__getProperty("fontSize"),d=this.__getProperty("font");this.sfont=(a?"italic ":"")+(b?"bold ":"")+c+"px "+d,this.ctx.font=this.__getProperty("sfont")},setBold:function(a){a!=this.bold&&(this.bold=a,this.__setFont())},setItalic:function(a){a!=this.italic&&(this.italic=a,this.__setFont())},setStroked:function(a){this.stroked=a},setFilled:function(a){this.filled=a},getTabPos:function(a){var b=this.__getProperty("tabSize");return((a/b>>0)+1)*b},setFillStyle:function(a){this.fill=a},setStrokeStyle:function(a){this.stroke=a},setStrokeSize:function(a){this.strokeSize=a},setAlignment:function(a){this.alignment=a},setFontSize:function(a){a!==this.fontSize&&(this.fontSize=a,this.__setFont())}};var b=function(){return this.text="",this};b.prototype={x:0,y:0,width:0,text:null,crcs:null,rcs:null,styles:null,images:null,lines:null,documentHeight:0,anchorStack:null,__nextLine:function(){this.x=0,this.currentLine=new f(CAAT.Module.Font.Font.getFontMetrics(this.crcs.sfont)),this.lines.push(this.currentLine)},__image:function(a,b,c){var e;e="undefined"!=typeof b&&"undefined"!=typeof c?a.getWidth():a instanceof CAAT.Foundation.SpriteImage?a.getWidth():a.getWrappedImageWidth(),this.width&&e+this.x>this.width&&0<this.x&&this.__nextLine(),this.currentLine.addElementImage(new d(this.x,a,b,c,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=e},__text:function(){if(0!==this.text.length){var a=this.ctx.measureText(this.text).width;this.width&&a+this.x>this.width&&0<this.x&&this.__nextLine(),this.currentLine.addElement(new e(this.text,this.x,a,0,this.crcs.clone(),this.__getCurrentAnchor())),this.x+=a,this.text=""}},fchar:function(a){" "===a?(this.__text(),this.x+=this.ctx.measureText(a).width,this.width&&this.x>this.width&&this.__nextLine()):this.text+=a},end:function(){0<this.text.length&&this.__text();for(var a=0,b=0,c=0;c<this.lines.length;c++){var d=this.lines[c].getHeight();0===d&&(d=this.styles["default"].fontSize),a+=d,c===this.lines.length-1&&(b=.25*d>>0),this.lines[c].setY(a)}this.documentHeight=a+b},getDocumentHeight:function(){return this.documentHeight},__getCurrentAnchor:function(){return this.anchorStack.length?this.anchorStack[this.anchorStack.length-1]:null},__resetAppliedStyles:function(){this.rcs=[],this.__pushDefaultStyles()},__pushDefaultStyles:function(){this.crcs=new a(this.ctx).setDefault(this.styles["default"]),this.rcs.push(this.crcs)},__pushStyle:function(b){var c=this.crcs;this.crcs=new a(this.ctx),this.crcs.chain=c,this.crcs.setStyle(b),this.crcs.applyStyle(),this.rcs.push(this.crcs)},__popStyle:function(){1<this.rcs.length&&(this.rcs.pop(),this.crcs=this.rcs[this.rcs.length-1],this.crcs.applyStyle())},__popAnchor:function(){0<this.anchorStack.length&&this.anchorStack.pop()},__pushAnchor:function(a){this.anchorStack.push(a)},start:function(a,b,c,d){this.y=this.x=0,this.width="undefined"!=typeof d?d:0,this.ctx=a,this.lines=[],this.styles=b,this.images=c,this.anchorStack=[],this.__resetAppliedStyles(),this.__nextLine()},setTag:function(a){if(this.__text(),a=a.toLowerCase(),"b"===a)this.crcs.setBold(!0);else if("/b"===a)this.crcs.setBold(!1);else if("i"===a)this.crcs.setItalic(!0);else if("/i"===a)this.crcs.setItalic(!1);else if("stroked"===a)this.crcs.setStroked(!0);else if("/stroked"===a)this.crcs.setStroked(!1);else if("filled"===a)this.crcs.setFilled(!0);else if("/filled"===a)this.crcs.setFilled(!1);else if("tab"===a)this.x=this.crcs.getTabPos(this.x);else if("br"===a)this.__nextLine();else if("/a"===a)this.__popAnchor();else if("/style"===a)1<this.rcs.length&&this.__popStyle();else if(0===a.indexOf("fillcolor"))a=a.split("="),this.crcs.setFillStyle(a[1]);else if(0===a.indexOf("strokecolor"))a=a.split("="),this.crcs.setStrokeStyle(a[1]);else if(0===a.indexOf("strokesize"))a=a.split("="),this.crcs.setStrokeSize(0|a[1]);else if(0===a.indexOf("fontsize"))a=a.split("="),this.crcs.setFontSize(0|a[1]);else if(0===a.indexOf("style"))a=a.split("="),(a=this.styles[a[1]])&&this.__pushStyle(a);else if(0===a.indexOf("image")){a=a.split("=")[1].split(",");var b=a[0];if(this.images[b]){var c=0,d=0;3<=a.length&&(c=0|a[1],d=0|a[2]),this.__image(this.images[b],c,d)}else CAAT.currentDirector.getImage(b)&&this.__image(CAAT.currentDirector.getImage(b))}else 0===a.indexOf("a=")&&(a=a.split("="),this.__pushAnchor(a[1]))}};var c=function(a,b){return this.link=a,this.style=b,this};c.prototype={x:null,y:null,width:null,height:null,style:null,link:null,isLink:function(){return this.link},setLink:function(a){return this.link=a,this},getLink:function(){return this.link},contains:function(){return!1}};var d=function(a,b,c,e,f,g){return d.superclass.constructor.call(this,g,f),this.x=a,this.image=b,this.row=c,this.column=e,this.width=b.getWidth(),this.height=b.getHeight(),(this.image instanceof CAAT.SpriteImage||this.image instanceof CAAT.Foundation.SpriteImage)&&(this.spriteIndex="undefined"==typeof c||"undefined"==typeof e?0:c*b.columns+e,this.paint=this.paintSI),this};d.prototype={image:null,row:null,column:null,spriteIndex:null,paint:function(a){this.style.image(a),a.drawImage(this.image,this.x,-this.height+1)},paintSI:function(a){this.style.image(a),this.image.setSpriteIndex(this.spriteIndex),this.image.paint({ctx:a},0,this.x,-this.height+1)},getHeight:function(){return this.image instanceof CAAT.Foundation.SpriteImage?this.image.getHeight():this.image.height},getFontMetrics:function(){return null},contains:function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<this.y+this.height},setYPosition:function(a){this.y=a-this.height+1}};var e=function(a,b,c,d,f,g){return e.superclass.constructor.call(this,g,f),this.x=b,this.y=0,this.width=c,this.text=a,this.style=f,this.fm=CAAT.Module.Font.Font.getFontMetrics(f.sfont),this.height=this.fm.height,this};e.prototype={text:null,style:null,fm:null,bl:null,paint:function(a){this.style.text(a,this.text,this.x,0)},getHeight:function(){return this.fm.height},getFontMetrics:function(){return this.fm},contains:function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height},setYPosition:function(a){this.bl=a,this.y=a-this.fm.ascent}},extend(d,c),extend(e,c);var f=function(a){return this.elements=[],this.defaultFontMetrics=a,this};return f.prototype={elements:null,width:0,height:0,defaultHeight:0,y:0,x:0,alignment:null,baselinePos:0,addElement:function(a){this.width=Math.max(this.width,a.x+a.width),this.height=Math.max(this.height,a.height),this.elements.push(a),this.alignment=a.style.__getProperty("alignment")},addElementImage:function(a){this.width=Math.max(this.width,a.x+a.width),this.height=Math.max(this.height,a.height),this.elements.push(a)},getHeight:function(){return this.height},setY:function(a){this.y=a},getY:function(){return this.y},paint:function(a){a.save(),a.translate(this.x,this.y+this.baselinePos);for(var b=0;b<this.elements.length;b++)this.elements[b].paint(a);a.restore()},setAlignment:function(a){var b;if("center"===this.alignment)this.x=(a-this.width)/2;else if("right"===this.alignment)this.x=a-this.width;else if("justify"===this.alignment&&.6<=this.width/a&&1<this.elements.length){var c=a-this.width,c=c/(this.elements.length-1)|0;for(b=1;b<this.elements.length;b++)this.elements[b].x+=b*c;for(c=a-this.width-c*(this.elements.length-1),b=0;c>b;b++)this.elements[this.elements.length-1-b].x+=c-b}},adjustHeight:function(){var a,b=null,c=null;for(a=0;a<this.elements.length;a+=1){var d=this.elements[a],e=d.getFontMetrics();null!=e?b?e.ascent>b.ascent&&(b=e):b=e:c?d.getHeight()>d.getHeight()&&(c=d):c=d}for(this.baselinePos=Math.max(b?b.ascent:this.defaultFontMetrics.ascent,c?c.getHeight():this.defaultFontMetrics.ascent),this.height=this.baselinePos+(null!=b?b.descent:this.defaultFontMetrics.descent),a=0;a<this.elements.length;a++)this.elements[a].setYPosition(this.baselinePos);return this.height},__getElementAt:function(a,b){for(var c=0;c<this.elements.length;c++){var d=this.elements[c];if(d.contains(a,b))return d}return null}},{__init:function(){return this.__super(),this.rc=new b,this.lines=[],this.styles={},this.images={},this},halignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.LEFT,valignment:CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.TOP,text:null,rc:null,styles:null,documentWidth:0,documentHeight:0,documentX:0,documentY:0,reflow:!0,lines:null,images:null,clickCallback:null,matchTextSize:!0,setMatchTextSize:function(a){(this.matchTextSize=a)&&(this.width=this.preferredSize.width,this.height=this.preferredSize.height)},setStyle:function(a,b){return this.styles[a]=b,this},addImage:function(a,b){return this.images[a]=b,this},setSize:function(a,b){return CAAT.Foundation.UI.Label.superclass.setSize.call(this,a,b),this.setText(this.text,this.width),this},setBounds:function(a,b,c,d){return CAAT.Foundation.UI.Label.superclass.setBounds.call(this,a,b,c,d),this.setText(this.text,this.width),this},setText:function(a,b){if(null!==a){var c=this.cached;c&&this.stopCacheAsBitmap(),this.documentHeight=this.documentWidth=0,this.text=a;var d,e,f,g,h,i,j=CAAT.currentDirector.ctx;for(j.save(),f=this.text,d=0,e=f.length,this.rc.start(j,this.styles,this.images,b);e>d;)i=f.charAt(d),"\\"===i?(d+=1,this.rc.fchar(f.charAt(d)),d+=1):"<"===i?(g=f.indexOf(">",d+1),-1!==g&&(h=f.substr(d+1,g-d-1),-1!==h.indexOf("<")?(this.rc.fchar(i),d+=1):(this.rc.setTag(h),d=g+1))):(this.rc.fchar(i),d+=1);return this.rc.end(),this.lines=this.rc.lines,this.__calculateDocumentDimension("undefined"==typeof b?0:b),this.setLinesAlignment(),j.restore(),this.setPreferredSize(this.documentWidth,this.documentHeight),this.invalidateLayout(),this.setDocumentPosition(),c&&this.cacheAsBitmap(0,c),this.matchTextSize&&(this.width=this.preferredSize.width,this.height=this.preferredSize.height),this}},setVerticalAlignment:function(a){return this.valignment=a,this.setDocumentPosition(),this},setHorizontalAlignment:function(a){return this.halignment=a,this.setDocumentPosition(),this},setDocumentPosition:function(a,b){"undefined"!=typeof a&&this.setHorizontalAlignment(a),"undefined"!=typeof b&&this.setVerticalAlignment(b);var c=0,d=0;this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?d=(this.height-this.documentHeight)/2:this.valignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.BOTTOM&&(d=this.height-this.documentHeight),this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.CENTER?c=(this.width-this.documentWidth)/2:this.halignment===CAAT.Foundation.UI.Layout.LayoutManager.ALIGNMENT.RIGHT&&(c=this.width-this.documentWidth),this.documentX=c,this.documentY=d},__calculateDocumentDimension:function(a){var b,c=0;for(b=this.documentHeight=this.documentWidth=0;b<this.lines.length;b++)this.lines[b].y=c,this.documentWidth=Math.max(this.documentWidth,this.lines[b].width),this.documentHeight+=this.lines[b].adjustHeight(),c+=this.lines[b].getHeight();return this.documentWidth=Math.max(this.documentWidth,a),this},setLinesAlignment:function(){for(var a=0;a<this.lines.length;a++)this.lines[a].setAlignment(this.documentWidth)},paint:function(a,b){if(this.cached===CAAT.Foundation.Actor.CACHE_NONE){var c=a.ctx;c.save(),c.textBaseline="alphabetic",c.translate(this.documentX,this.documentY);for(var d=0;d<this.lines.length;d++)this.lines[d].paint(a.ctx);c.restore()}else this.backgroundImage&&this.backgroundImage.paint(a,b,0,0)},__getDocumentElementAt:function(a,b){a-=this.documentX,b-=this.documentY;for(var c=0;c<this.lines.length;c++){var d=this.lines[c];if(d.x<=a&&d.y<=b&&d.x+d.width>=a&&d.y+d.height>=b)return d.__getElementAt(a-d.x,b-d.y)}return null},mouseExit:function(){CAAT.setCursor("default")},mouseMove:function(a){(a=this.__getDocumentElementAt(a.x,a.y))&&a.getLink()?CAAT.setCursor("pointer"):CAAT.setCursor("default")},mouseClick:function(a){this.clickCallback&&(a=this.__getDocumentElementAt(a.x,a.y),a.getLink()&&this.clickCallback(a.getLink()))},setClickCallback:function(a){return this.clickCallback=a,this}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.PathActor",aliases:["CAAT.PathActor"],depends:["CAAT.Foundation.Actor"],extendsClass:"CAAT.Foundation.Actor",extendsWith:{path:null,pathBoundingRectangle:null,bOutline:!1,outlineColor:"black",onUpdateCallback:null,interactive:!1,getPath:function(){return this.path},setPath:function(a){return this.path=a,null!=a&&(this.pathBoundingRectangle=a.getBoundingBox(),this.setInteractive(this.interactive)),this},paint:function(a,b){if(CAAT.Foundation.UI.PathActor.superclass.paint.call(this,a,b),this.path){var c=a.ctx;c.strokeStyle="#000",this.path.paint(a,this.interactive),this.bOutline&&(c.strokeStyle=this.outlineColor,c.strokeRect(this.pathBoundingRectangle.x,this.pathBoundingRectangle.y,this.pathBoundingRectangle.width,this.pathBoundingRectangle.height))}},showBoundingBox:function(a,b){return(this.bOutline=a)&&b&&(this.outlineColor=b),this},setInteractive:function(a){return this.interactive=a,this.path&&this.path.setInteractive(a),this},setOnUpdateCallback:function(a){return this.onUpdateCallback=a,this},mouseDrag:function(a){this.path.drag(a.point.x,a.point.y,this.onUpdateCallback)},mouseDown:function(a){this.path.press(a.point.x,a.point.y)},mouseUp:function(){this.path.release()}}}),CAAT.Module({defines:"CAAT.Foundation.UI.ShapeActor",aliases:["CAAT.ShapeActor"],extendsClass:"CAAT.Foundation.ActorContainer",depends:["CAAT.Foundation.ActorContainer"],constants:{SHAPE_CIRCLE:0,SHAPE_RECTANGLE:1},extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this.setShape(CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE),this},shape:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){return this.lineWidth=a,this},setLineCap:function(a){return this.lineCap=a,this},setLineJoin:function(a){return this.lineJoin=a,this},setMiterLimit:function(a){return this.miterLimit=a,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth
},setShape:function(a){return this.shape=a,this.paint=this.shape===CAAT.Foundation.UI.ShapeActor.SHAPE_CIRCLE?this.paintCircle:this.paintRectangle,this},setCompositeOp:function(a){return this.compositeOp=a,this},paint:function(){},paintCircle:function(a,b){if(this.cached)CAAT.Foundation.ActorContainer.prototype.paint.call(this,a,b);else{var c=a.ctx;c.lineWidth=this.lineWidth,c.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(c.fillStyle=this.fillStyle,c.beginPath(),c.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),c.fill()),null!==this.strokeStyle&&(c.strokeStyle=this.strokeStyle,c.beginPath(),c.arc(this.width/2,this.height/2,Math.min(this.width,this.height)/2-this.lineWidth/2,0,2*Math.PI,!1),c.stroke())}},paintRectangle:function(a,b){if(this.cached)CAAT.Foundation.ActorContainer.prototype.paint.call(this,a,b);else{var c=a.ctx;c.lineWidth=this.lineWidth,this.lineCap&&(c.lineCap=this.lineCap),this.lineJoin&&(c.lineJoin=this.lineJoin),this.miterLimit&&(c.miterLimit=this.miterLimit),c.globalCompositeOperation=this.compositeOp,null!==this.fillStyle&&(c.fillStyle=this.fillStyle,c.beginPath(),c.fillRect(0,0,this.width,this.height),c.fill()),null!==this.strokeStyle&&(c.strokeStyle=this.strokeStyle,c.beginPath(),c.strokeRect(0,0,this.width,this.height),c.stroke())}}}}),CAAT.Module({defines:"CAAT.Foundation.UI.StarActor",aliases:["CAAT.StarActor"],depends:["CAAT.Foundation.ActorContainer"],extendsClass:"CAAT.Foundation.ActorContainer",extendsWith:{__init:function(){return this.__super(),this.compositeOp="source-over",this},nPeaks:0,maxRadius:0,minRadius:0,initialAngle:0,compositeOp:null,lineWidth:1,lineCap:null,lineJoin:null,miterLimit:null,setLineWidth:function(a){return this.lineWidth=a,this},setLineCap:function(a){return this.lineCap=a,this},setLineJoin:function(a){return this.lineJoin=a,this},setMiterLimit:function(a){return this.miterLimit=a,this},getLineCap:function(){return this.lineCap},getLineJoin:function(){return this.lineJoin},getMiterLimit:function(){return this.miterLimit},getLineWidth:function(){return this.lineWidth},setFilled:function(){return this},setOutlined:function(){return this},setCompositeOp:function(a){return this.compositeOp=a,this},setInitialAngle:function(a){return this.initialAngle=a,this},initialize:function(a,b,c){return this.setSize(2*b,2*b),this.nPeaks=a,this.maxRadius=b,this.minRadius=c,this},paint:function(a){var b=a.ctx,c=this.width/2,d=this.height/2,e=this.maxRadius,f=this.minRadius,g=c+e*Math.cos(this.initialAngle),h=d+e*Math.sin(this.initialAngle);for(b.lineWidth=this.lineWidth,this.lineCap&&(b.lineCap=this.lineCap),this.lineJoin&&(b.lineJoin=this.lineJoin),this.miterLimit&&(b.miterLimit=this.miterLimit),b.globalCompositeOperation=this.compositeOp,b.beginPath(),b.moveTo(g,h),g=1;g<2*this.nPeaks;g++){var i=Math.PI/this.nPeaks*g+this.initialAngle,j=0===g%2?e:f,h=c+j*Math.cos(i),i=d+j*Math.sin(i);b.lineTo(h,i)}b.lineTo(c+e*Math.cos(this.initialAngle),d+e*Math.sin(this.initialAngle)),b.closePath(),this.fillStyle&&(b.fillStyle=this.fillStyle,b.fill()),this.strokeStyle&&(b.strokeStyle=this.strokeStyle,b.stroke())}}}),CAAT.Module({defines:"CAAT.Foundation.UI.TextActor",aliases:["CAAT.TextActor"],extendsClass:"CAAT.Foundation.Actor",constants:{TRAVERSE_PATH_FORWARD:1,TRAVERSE_PATH_BACKWARD:-1},depends:["CAAT.Foundation.Actor","CAAT.Foundation.SpriteImage","CAAT.Module.Font.Font","CAAT.Math.Point","CAAT.Behavior.Interpolator"],extendsWith:{__init:function(){return this.__super(),this.font="10px sans-serif",this.textAlign="left",this.outlineColor="black",this.clip=!1,this.__calcFontData(),this},font:null,fontData:null,textAlign:null,textBaseline:"top",fill:!0,textFillStyle:"#eee",text:null,textWidth:0,textHeight:0,outline:!1,outlineColor:null,lineWidth:1,path:null,pathInterpolator:null,pathDuration:1e4,sign:1,lx:0,ly:0,setFill:function(a){return this.stopCacheAsBitmap(),this.fill=a,this},setLineWidth:function(a){return this.stopCacheAsBitmap(),this.lineWidth=a,this},setTextFillStyle:function(a){return this.stopCacheAsBitmap(),this.textFillStyle=a,this},setOutline:function(a){return this.stopCacheAsBitmap(),this.outline=a,this},setPathTraverseDirection:function(a){return this.sign=a,this},setOutlineColor:function(a){return this.stopCacheAsBitmap(),this.outlineColor=a,this},setText:function(a){return this.stopCacheAsBitmap(),this.text=a,(null===this.text||""===this.text)&&(this.width=this.height=0),this.calcTextSize(CAAT.currentDirector),this.invalidate(),this},setTextAlign:function(a){return this.textAlign=a,this.__setLocation(),this},setAlign:function(a){return this.setTextAlign(a)},setTextBaseline:function(a){return this.stopCacheAsBitmap(),this.textBaseline=a,this},setBaseline:function(a){return this.stopCacheAsBitmap(),this.setTextBaseline(a)},setFont:function(a){return this.stopCacheAsBitmap(),a||(a="10px sans-serif"),a instanceof CAAT.Module.Font.Font&&a.setAsSpriteImage(),this.font=a,this.__calcFontData(),this.calcTextSize(CAAT.director[0]),this},setLocation:function(a,b){return this.lx=a,this.ly=b,this.__setLocation(),this},setPosition:function(a,b){return this.lx=a,this.ly=b,this.__setLocation(),this},setBounds:function(a,b,c,d){return this.lx=a,this.ly=b,this.setSize(c,d),this.__setLocation(),this},setSize:function(a,b){return CAAT.Foundation.UI.TextActor.superclass.setSize.call(this,a,b),this.__setLocation(),this},__setLocation:function(){CAAT.Foundation.UI.TextActor.superclass.setLocation.call(this,"center"===this.textAlign?this.lx-this.width/2:"right"===this.textAlign||"end"===this.textAlign?this.lx-this.width:this.lx,"bottom"===this.textBaseline?this.ly-this.height:"middle"===this.textBaseline?this.ly-this.height/2:"alphabetic"===this.textBaseline?this.ly-this.fontData.ascent:this.ly)},centerAt:function(a,b){return this.textAlign="left",this.textBaseline="top",CAAT.Foundation.UI.TextActor.superclass.centerAt.call(this,a,b)},calcTextSize:function(a){return"undefined"==typeof this.text||null===this.text||""===this.text?(this.textHeight=this.textWidth=0,this):a.glEnabled?this:this.font instanceof CAAT.Foundation.SpriteImage||this.font instanceof CAAT.Module.Font.Font?(this.textWidth=this.font.stringWidth(this.text),this.textHeight=this.font.stringHeight(),this.width=this.textWidth,this.height=this.textHeight,this.fontData=this.font.getFontData(),this):(a=a.ctx,a.save(),a.font=this.font,this.textWidth=a.measureText(this.text).width,0===this.width&&(this.width=this.textWidth),this.textHeight=this.fontData.height,this.setSize(this.textWidth,this.textHeight),a.restore(),this)},__calcFontData:function(){this.fontData=CAAT.Module.Font.Font.getFontMetrics(this.font)},paint:function(a,b){if(this.text&&(CAAT.Foundation.UI.TextActor.superclass.paint.call(this,a,b),!this.cached&&null!==this.text)){0!==this.textWidth&&0!==this.textHeight||this.calcTextSize(a);var c=a.ctx;if(this.font instanceof CAAT.Module.Font.Font||this.font instanceof CAAT.Foundation.SpriteImage)this.drawSpriteText(a,b);else if(null!==this.font&&(c.font=this.font),c.textBaseline="alphabetic",null===this.path){null!==this.textAlign&&(c.textAlign=this.textAlign);var d=0;"center"===this.textAlign?d=this.width/2|0:"right"===this.textAlign&&(d=this.width),this.fill&&(null!==this.textFillStyle&&(c.fillStyle=this.textFillStyle),c.fillText(this.text,d,this.fontData.ascent)),this.outline&&(null!==this.outlineColor&&(c.strokeStyle=this.outlineColor),c.lineWidth=this.lineWidth,c.beginPath(),c.strokeText(this.text,d,this.fontData.ascent))}else this.drawOnPath(a,b)}},drawOnPath:function(a,b){var c=a.ctx;this.fill&&null!==this.textFillStyle&&(c.fillStyle=this.textFillStyle),this.outline&&null!==this.outlineColor&&(c.strokeStyle=this.outlineColor);for(var d=this.sign*this.pathInterpolator.getPosition(b%this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Math.Point(0,0,0),f=new CAAT.Math.Point(0,0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),i=c.measureText(h).width,f=d,e=this.path.getPositionFromLength(f).clone(),f=this.path.getPositionFromLength(f-.1).clone(),f=Math.atan2(e.y-f.y,e.x-f.x);c.save(),CAAT.CLAMP?c.translate(e.x>>0,e.y>>0):c.translate(e.x,e.y),c.rotate(f),this.fill&&c.fillText(h,0,0),this.outline&&(c.beginPath(),c.lineWidth=this.lineWidth,c.strokeText(h,0,0)),c.restore(),d+=i}},drawSpriteText:function(a,b){null===this.path?this.font.drawText(this.text,a.ctx,0,0):this.drawSpriteTextOnPath(a,b)},drawSpriteTextOnPath:function(a,b){for(var c=a.ctx,d=this.sign*this.pathInterpolator.getPosition(b%this.pathDuration/this.pathDuration).y*this.path.getLength(),e=new CAAT.Math.Point(0,0,0),f=new CAAT.Math.Point(0,0,0),g=0;g<this.text.length;g++){var h=this.text[g].toString(),i=this.font.stringWidth(h),f=i/2+d,e=this.path.getPositionFromLength(f).clone(),f=this.path.getPositionFromLength(f-.1).clone(),f=Math.atan2(e.y-f.y,e.x-f.x);c.save(),CAAT.CLAMP?c.translate(0|e.x,0|e.y):c.translate(e.x,e.y),c.rotate(f),e="bottom"===this.textBaseline?0-this.font.getHeight():0,this.font.drawText(h,c,0,e),c.restore(),d+=i}},setPath:function(a,b,c){return this.path=a,this.pathInterpolator=b||(new CAAT.Behavior.Interpolator).createLinearInterpolator(),this.pathDuration=c||1e4,this.mouseEnabled=!1,this}}}),CAAT.ModuleManager.solveAll();